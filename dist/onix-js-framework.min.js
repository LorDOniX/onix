/**
 * OnixJS framework
 * 2.5.13/13. 6. 2016
 * source: https://gitlab.com/LorDOniX/onix
 * documentation: https://gitlab.com/LorDOniX/onix/tree/master/docs

 * @license MIT
 * - Free for use in both personal and commercial projects
 */
if(function(){Event=Event||window.Event,Event.prototype.stopPropagation=Event.prototype.stopPropagation||function(){this.cancelBubble=!0},Event.prototype.preventDefault=Event.prototype.preventDefault||function(){this.returnValue=!1}}(),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){for(var i=this.length,n=0;i>n;n++)n in this&&t.call(e,this[n],n,this)}),Array.prototype.every||(Array.prototype.every=function(t,e){for(var i=this.length,n=0;i>n;n++)if(n in this&&!t.call(e,this[n],n,this))return!1;return!0}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t,e){var i=this.length,n=e||0;for(0>n&&(n+=i);i>n;n++)if(n in this&&this[n]===t)return n;return-1}),!("console"in window)){var emptyFn=function(){};window.console={},["log","warn","error","clear","info"].forEach(function(t){window.console[t]=emptyFn})}if(Object.keys||(Object.keys=function(){"use strict";var t=Object.prototype.hasOwnProperty,e=!{toString:null}.propertyIsEnumerable("toString"),i=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],n=i.length;return function(s){if("object"!=typeof s&&("function"!=typeof s||null===s))throw new TypeError("Object.keys called on non-object");var o,r,a=[];for(o in s)t.call(s,o)&&a.push(o);if(e)for(r=0;n>r;r++)t.call(s,i[r])&&a.push(i[r]);return a}}()),function(){if(navigator.appVersion.indexOf("MSIE 8")>0){var t=Array.prototype.slice;Array.prototype.slice=function(){if(this instanceof Array)return t.apply(this,arguments);for(var e=[],i=arguments.length>=1?arguments[0]:0,n=arguments.length>=2?arguments[1]:this.length,s=i;n>s;s++)e.push(this[s]);return e}}}(),Object.create||(Object.create=function(t){if(arguments.length>1)throw new Error("Object.create polyfill only accepts the first parameter");var e=function(){};return e.prototype=t,new e}),Function.prototype.bind||(Function.prototype.bind=function(t){var e=this,i=Array.prototype.slice.call(arguments,1);return function(){return e.apply(t,i.concat(Array.prototype.slice.call(arguments)))}}),!("addEventListener"in document)){var w=Window.prototype,h=HTMLDocument.prototype,e=Element.prototype;w.addEventListener=h.addEventListener=e.addEventListener=function(t,e){if("DOMContentLoaded"==t)document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&e()});else{var i=this;this.attachEvent("on"+t,function(){return e.apply(i,arguments)})}},w.removeEventListener=h.removeEventListener=e.removeEventListener=function(t,e){return this.detachEvent("on"+t,e)}}"classList"in document.documentElement||!window.Element||!function(){function t(t){if(this._element=t,t.className!=this._classCache&&(this._classCache=t.className,this._classCache))for(var e=this._classCache.replace(/^\s+|\s+$/g,"").split(/\s+/),i=0;i<e.length;i++)r.call(this,e[i])}function e(t,e){t.className=e.join(" ")}function i(t,e,i){Object.defineProperty?Object.defineProperty(t,e,{get:i}):t.__defineGetter__(e,i)}var n=Array.prototype,s=n.indexOf,o=n.slice,r=n.push,a=n.splice,h=n.join;window.DOMTokenList=t,t.prototype={add:function(t){this.contains(t)||(r.call(this,t),e(this._element,o.call(this,0)))},contains:function(t){return-1!=s.call(this,t)},item:function(t){return this[t]||null},remove:function(t){var i=s.call(this,t);-1!=i&&(a.call(this,i,1),e(this._element,o.call(this,0)))},toString:function(){return h.call(this," ")},toggle:function(t){return-1==s.call(this,t)?(this.add(t),!0):(this.remove(t),!1)}},i(Element.prototype,"classList",function(){return new t(this)})}(),function(){function t(t){return!!t.exifdata}function e(t,e){e=e||t.match(/^data\:([^\;]+)\;base64,/im)[1]||"",t=t.replace(/^data\:([^\;]+)\;base64,/gim,"");for(var i=atob(t),n=i.length,s=new ArrayBuffer(n),o=new Uint8Array(s),r=0;n>r;r++)o[r]=i.charCodeAt(r);return s}function i(t,e){var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="blob",i.onload=function(t){200!=this.status&&0!==this.status||e(this.response)},i.send()}function s(t,n){function s(e){var i=o(e),s=r(e);t.exifdata=i||{},t.iptcdata=s||{},n&&n.call(t)}if(t.src)if(/^data\:/i.test(t.src)){var a=e(t.src);s(a)}else if(/^blob\:/i.test(t.src)){var h=new FileReader;h.onload=function(t){s(t.target.result)},i(t.src,function(t){h.readAsArrayBuffer(t)})}else{var c=new XMLHttpRequest;c.onload=function(){if(200!=this.status&&0!==this.status)throw"Could not load image";s(c.response),c=null},c.open("GET",t.src,!0),c.responseType="arraybuffer",c.send(null)}else if(window.FileReader&&(t instanceof window.Blob||t instanceof window.File)){var h=new FileReader;h.onload=function(t){p&&console.log("Got file of length "+t.target.result.byteLength),s(t.target.result)},h.readAsArrayBuffer(t)}}function o(t){var e=new DataView(t);if(p&&console.log("Got file of length "+t.byteLength),255!=e.getUint8(0)||216!=e.getUint8(1))return p&&console.log("Not a valid JPEG"),!1;for(var i,n=2,s=t.byteLength;s>n;){if(255!=e.getUint8(n))return p&&console.log("Not a valid marker at offset "+n+", found: "+e.getUint8(n)),!1;if(i=e.getUint8(n+1),p&&console.log(i),225==i)return p&&console.log("Found 0xFFE1 marker"),l(e,n+4,e.getUint16(n+2)-2);n+=2+e.getUint16(n+2)}}function r(t){var e=new DataView(t);if(p&&console.log("Got file of length "+t.byteLength),255!=e.getUint8(0)||216!=e.getUint8(1))return p&&console.log("Not a valid JPEG"),!1;for(var i=2,n=t.byteLength,s=function(t,e){return 56===t.getUint8(e)&&66===t.getUint8(e+1)&&73===t.getUint8(e+2)&&77===t.getUint8(e+3)&&4===t.getUint8(e+4)&&4===t.getUint8(e+5)};n>i;){if(s(e,i)){var o=e.getUint8(i+7);o%2!==0&&(o+=1),0===o&&(o=4);var r=i+8+o,h=e.getUint16(i+6+o);return a(t,r,h)}i++}}function a(t,e,i){for(var n,s,o,r,a,h=new DataView(t),c={},l=e;e+i>l;)28===h.getUint8(l)&&2===h.getUint8(l+1)&&(r=h.getUint8(l+2),r in y&&(o=h.getInt16(l+3),a=o+5,s=y[r],n=u(h,l+5,o),c.hasOwnProperty(s)?c[s]instanceof Array?c[s].push(n):c[s]=[c[s],n]:c[s]=n)),l++;return c}function h(t,e,i,n,s){var o,r,a,h=t.getUint16(i,!s),u={};for(a=0;h>a;a++)o=i+12*a+2,r=n[t.getUint16(o,!s)],!r&&p&&console.log("Unknown tag: "+t.getUint16(o,!s)),u[r]=c(t,o,e,i,s);return u}function c(t,e,i,n,s){var o,r,a,h,c,l,p=t.getUint16(e+2,!s),d=t.getUint32(e+4,!s),f=t.getUint32(e+8,!s)+i;switch(p){case 1:case 7:if(1==d)return t.getUint8(e+8,!s);for(o=d>4?f:e+8,r=[],h=0;d>h;h++)r[h]=t.getUint8(o+h);return r;case 2:return o=d>4?f:e+8,u(t,o,d-1);case 3:if(1==d)return t.getUint16(e+8,!s);for(o=d>2?f:e+8,r=[],h=0;d>h;h++)r[h]=t.getUint16(o+2*h,!s);return r;case 4:if(1==d)return t.getUint32(e+8,!s);for(r=[],h=0;d>h;h++)r[h]=t.getUint32(f+4*h,!s);return r;case 5:if(1==d)return c=t.getUint32(f,!s),l=t.getUint32(f+4,!s),a=new Number(c/l),a.numerator=c,a.denominator=l,a;for(r=[],h=0;d>h;h++)c=t.getUint32(f+8*h,!s),l=t.getUint32(f+4+8*h,!s),r[h]=new Number(c/l),r[h].numerator=c,r[h].denominator=l;return r;case 9:if(1==d)return t.getInt32(e+8,!s);for(r=[],h=0;d>h;h++)r[h]=t.getInt32(f+4*h,!s);return r;case 10:if(1==d)return t.getInt32(f,!s)/t.getInt32(f+4,!s);for(r=[],h=0;d>h;h++)r[h]=t.getInt32(f+8*h,!s)/t.getInt32(f+4+8*h,!s);return r}}function u(t,e,i){var s="";for(n=e;n<e+i;n++)s+=String.fromCharCode(t.getUint8(n));return s}function l(t,e){if("Exif"!=u(t,e,4))return p&&console.log("Not valid EXIF data! "+u(t,e,4)),!1;var i,n,s,o,r,a=e+6;if(18761==t.getUint16(a))i=!1;else{if(19789!=t.getUint16(a))return p&&console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),!1;i=!0}if(42!=t.getUint16(a+2,!i))return p&&console.log("Not valid TIFF data! (no 0x002A)"),!1;var c=t.getUint32(a+4,!i);if(8>c)return p&&console.log("Not valid TIFF data! (First offset less than 8)",t.getUint32(a+4,!i)),!1;if(n=h(t,a,a+c,m,i),n.ExifIFDPointer){o=h(t,a,a+n.ExifIFDPointer,_,i);for(s in o){switch(s){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":o[s]=v[s][o[s]];break;case"ExifVersion":case"FlashpixVersion":o[s]=String.fromCharCode(o[s][0],o[s][1],o[s][2],o[s][3]);break;case"ComponentsConfiguration":o[s]=v.Components[o[s][0]]+v.Components[o[s][1]]+v.Components[o[s][2]]+v.Components[o[s][3]]}n[s]=o[s]}}if(n.GPSInfoIFDPointer){r=h(t,a,a+n.GPSInfoIFDPointer,g,i);for(s in r){switch(s){case"GPSVersionID":r[s]=r[s][0]+"."+r[s][1]+"."+r[s][2]+"."+r[s][3]}n[s]=r[s]}}return n}var p=!1,d=this,f=function(t){return t instanceof f?t:this instanceof f?void(this.EXIFwrapped=t):new f(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=f),exports.EXIF=f):d.EXIF=f;var _=f.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},m=f.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},g=f.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},v=f.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}},y={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};f.getData=function(e,i){return(e instanceof Image||e instanceof HTMLImageElement)&&!e.complete?!1:(t(e)?i&&i.call(e):s(e,i),!0)},f.getTag=function(e,i){return t(e)?e.exifdata[i]:void 0},f.getAllTags=function(e){if(!t(e))return{};var i,n=e.exifdata,s={};for(i in n)n.hasOwnProperty(i)&&(s[i]=n[i]);return s},f.pretty=function(e){if(!t(e))return"";var i,n=e.exifdata,s="";for(i in n)n.hasOwnProperty(i)&&(s+="object"==typeof n[i]?n[i]instanceof Number?i+" : "+n[i]+" ["+n[i].numerator+"/"+n[i].denominator+"]\r\n":i+" : ["+n[i].length+" values]\r\n":i+" : "+n[i]+"\r\n");return s},f.readFromBinaryFile=function(t){return o(t)},"function"==typeof define&&define.amd&&define("exif-js",[],function(){return f})}.call(this),onix=function(){var t=function(t,e){this._objects={},this._runs=[],this._configs=[],this._name=t||"",this._dependencies=e||[]};t.CONST={PROVIDER_NAME:"Provider",FILTER_NAME:"$filter",TYPE:{PROVIDER:1,SERVICE:2,FACTORY:3,CONSTANT:4,VALUE:5,FILTER:6,CONFIG:7,RUN:8}},t.parseParam=function(t){var e,i=[];return Array.isArray(t)?t.every(function(t){return"function"==typeof t?(e=t,!1):("string"==typeof t&&i.push(t),!0)},this):e=t,{fn:e,inject:i}},t.getFilterName=function(e){return e=e||"",t.CONST.FILTER_NAME+e[0].toUpperCase()+e.substr(1,e.length-1)},t.prototype.getDependencies=function(){return this._dependencies},t.prototype.getName=function(){return this._name},t.prototype.getConfigs=function(){return this._configs},t.prototype.getRuns=function(){return this._runs},t.prototype.getObjects=function(){return this._objects},t.prototype.provider=function(e,i){if(!e||!i)return this;var n=t.parseParam(i);return this._objects[e+t.CONST.PROVIDER_NAME]={name:e+t.CONST.PROVIDER_NAME,inject:n.inject,fn:n.fn,cache:null,type:t.CONST.TYPE.PROVIDER},this._objects[e]={name:e,inject:null,fn:null,cache:null,provider:e+t.CONST.PROVIDER_NAME,type:t.CONST.TYPE.FACTORY},this},t.prototype.service=function(e,i){if(!e||!i)return this;var n=t.parseParam(i);return this._objects[e]={name:e,inject:n.inject,fn:n.fn,cache:null,type:t.CONST.TYPE.SERVICE},this},t.prototype.factory=function(e,i){if(!e||!i)return this;var n=t.parseParam(i);return this._objects[e]={name:e,inject:n.inject,fn:n.fn,cache:null,type:t.CONST.TYPE.FACTORY},this},t.prototype.constant=function(e,i){return e&&i?(this._objects[e]={name:e,cache:i,type:t.CONST.TYPE.CONSTANT},this):this},t.prototype.value=function(e,i){return e&&i?(this._objects[e]={name:e,cache:i,type:t.CONST.TYPE.VALUE},this):this},t.prototype.filter=function(e,i){if(!e||!i)return this;var n=t.parseParam(i);return this._objects[t.getFilterName(e)]={name:e,inject:n.inject,fn:n.fn,cache:null,type:t.CONST.TYPE.FILTER},this},t.prototype.config=function(e){if(!e)return this;var i=t.parseParam(e);return this._configs.push({fn:i.fn,inject:i.inject,type:t.CONST.TYPE.CONFIG}),this},t.prototype.run=function(e){if(!e)return this;var i=t.parseParam(e);return this._runs.push({fn:i.fn,inject:i.inject,type:t.CONST.TYPE.RUN}),this},t.prototype.controller=function(){return this},t.prototype.directive=function(){return this};var e={_modules:[],_modulesObj:{},_CONST:{MODULE_SEPARATOR:"::"},_noop:function(){},domLoad:function(){var t=[],e=[];this._modules.forEach(function(i){var n=!1,s=i.getDependencies();s.every(function(t){return t in this._modulesObj?!0:(console.error("Module '"+this._name+"' dependency '"+t+"' not found!"),n=!0,!1)},this),n||(t=t.concat(i.getConfigs()),e=e.concat(i.getRuns()))},this),t.forEach(function(t){this.run(t,!0)},this),e.forEach(function(t){this.run(t)},this)},_getObject:function(t){var e=null,i="",n="";if(-1!=t.indexOf(this._CONST.MODULE_SEPARATOR)){var s=t.split(this._CONST.MODULE_SEPARATOR);if(2!=s.length)return console.error("Get object "+t+" error! Wrong module separator use."),null;i=s[0],n=s[1]}else n=t;return this._modules.every(function(t){var s=t.getObjects();return i?t.getName()!=i?!0:n in s?(e=s[n],!1):(console.error("Get object "+n+" error! Cannot find object in the module "+i+"."),!1):n in s?(e=s[n],!1):!0}),e},run:function(e,i,n){if(n=n||[],-1!=n.indexOf(e.name))return console.error("Circular dependency error! Object name: "+e.name+", parents: "+n.join("|")),null;var s=[];if(e.provider){var o=this._getObject(e.provider);if(!o.cache){var r=o.fn||this._noop;o.cache=new r}var a=o.cache.$get||this._noop,h=t.parseParam(a);e.fn=h.fn,e.inject=h.inject,delete e.provider}if(e.inject&&e.inject.length&&e.inject.forEach(function(t){if("string"==typeof t){var o=this._getObject(t);o?s.push(this.run(o,i,e.name?n.concat(e.name):n)):(console.error("Object name: "+t+" not found!"),s.push(null))}else"object"==typeof t&&s.push(t)},this),i)switch(e.type){case t.CONST.TYPE.PROVIDER:if(!e.cache){var c=e.fn||this._noop;e.cache=new c}return e.cache;case t.CONST.TYPE.CONSTANT:return e.cache;case t.CONST.TYPE.CONFIG:var c=e.fn||this._noop;return c.apply(c,s);default:return null}else switch(e.type){case t.CONST.TYPE.FACTORY:case t.CONST.TYPE.FILTER:if(!e.cache){var c=e.fn||this._noop;e.cache=c.apply(c,s)}return e.cache;case t.CONST.TYPE.SERVICE:if(!e.cache){var c=e.fn||this._noop,u=Object.create(c.prototype);c.apply(u,s),e.cache=u}return e.cache;case t.CONST.TYPE.VALUE:return e.cache;case t.CONST.TYPE.CONSTANT:return e.cache;case t.CONST.TYPE.RUN:var c=e.fn||this._noop;return c.apply(c,s);default:return null}},addModule:function(e,i){var n=new t(e,i);return this._modulesObj[e]=n,this._modules.push(n),n}};document.addEventListener("DOMContentLoaded",e.domLoad.bind(e));var i=e.addModule("onix");return i.module=function(t,i){return e.addModule(t,i)},i.noop=function(){},i.info=function(){console.log("OnixJS framework\n2.5.13/13. 6. 2016\nsource: https://gitlab.com/LorDOniX/onix\ndocumentation: https://gitlab.com/LorDOniX/onix/tree/master/docs\n@license MIT\n- Free for use in both personal and commercial projects\n")},i.factory("$di",function(){return{parseParam:t.parseParam,getFilterName:t.getFilterName,run:function(i){return i?(i.fn||(i.fn=function(){}),i.type=t.CONST.TYPE.RUN,e.run(i)):null}}}),i}(),onix.factory("$filter",["$di",function(t){var e=function(t){return t||""};return function(i){return i?(i=t.getFilterName(i),t.run({fn:function(t){return t||e},inject:[i]})):e}}]),onix.service("$common",["$q",function(t){this._objCopy=function(t,e){Object.keys(e).forEach(function(i){e.hasOwnProperty(i)&&(t[i]=this.cloneValue(e[i]))}.bind(this))},this.confirm=function(e){var i=t.defer();return confirm(e)?i.resolve():i.reject(),i},this.merge=function(){var t=arguments.length,e={};if(t>0)for(var i=0;t>i;i++){var n=arguments[i];this._objCopy(e,n)}return e},this.extend=function(t,e){t=t||{},e=e||{},this._objCopy(t,e)},this.cloneValue=function(t,e){if(e=e||1,e>100)return null;switch(typeof t){case"object":if(Array.isArray(t)){var i=[];return t.forEach(function(t){i.push(this.cloneValue(t,e+1))},this),i}if(t instanceof Date)return new Date(t.getTime());if(t instanceof Element)return t;if(t){var n={};return Object.keys(t).forEach(function(i){t.hasOwnProperty(i)&&(n[i]=this.cloneValue(t[i],e+1))}.bind(this)),n}return null;case"undefined":case"function":case"number":case"string":return t}},this.inherit=function(){var t=arguments;if(!(t.length<2)){var e=t[0].prototype,i=Array.prototype.slice.call(t,1);i.forEach(function(t){for(var i in t.prototype)e[i]="object"!=typeof t.prototype[i]?t.prototype[i]:JSON.parse(JSON.stringify(t.prototype[i]))},this)}},this.bindWithoutScope=function(t){var e=Array.prototype.slice.call(arguments,1);return function(){var i=Array.prototype.slice.call(arguments,0),n=Array.prototype.concat(i,e);return t.apply(this,n)}},this.nodesForEach=function(t,e,i){e=e||function(){},t&&Array.prototype.slice.call(t).forEach(function(t,n){e.apply(i||e,[t,n])})},this.reverseForEach=function(t,e,i){t=t||[],e=e||function(){};for(var n=t.length-1;n>=0;n--)e.apply(i||this,[t[n],n])},this.hxToDe=function(t){switch(t=t.toLowerCase()){case"a":return 10;case"b":return 11;case"c":return 12;case"d":return 13;case"e":return 14;case"f":return 15;default:return parseInt(t,10)}},this.hexToRGB=function(t){return"#"==t[0]?(t=t.replace("#",""),3==t.length?{r:16*this.hxToDe(t[0])+this.hxToDe(t[0]),g:16*this.hxToDe(t[1])+this.hxToDe(t[1]),b:16*this.hxToDe(t[2])+this.hxToDe(t[2])}:{r:16*this.hxToDe(t[0])+this.hxToDe(t[1]),g:16*this.hxToDe(t[2])+this.hxToDe(t[3]),b:16*this.hxToDe(t[4])+this.hxToDe(t[5])}):t},this.isElement=function(t){return t instanceof HTMLElement},this.isObject=function(t){return"object"==typeof t&&!Array.isArray(t)&&null!==t},this.col=function(){var t=Array.prototype.slice.call(arguments),e="",i={};t.forEach(function(t,n){0==n?e=t:i["[{]"+(n-1)+"[}]"]=t}),Object.keys(i).forEach(function(t){e=e.replace(new RegExp(t,"g"),i[t])}),e&&console.log(e)},this.formatSize=function(t){if("number"!=typeof t)return"null";var e=t>0?Math.floor(Math.log(t)/Math.log(1e3)):0,i=["","K","M","G","T"];e=Math.min(i.length,e);var n=e>0?(t/Math.pow(1e3,e)).toFixed(2):t;return n+" "+i[e]+"B"}}]),onix.service("$cookie",function(){this.get=function(t){var e=null;if(document.cookie&&""!=document.cookie){var i=document.cookie.split(";");i.every(function(i){return i=i.trim(),i.substring(0,t.length+1)==t+"="?(e=decodeURIComponent(i.substring(t.length+1)),!1):!0})}return e}}),onix.service("$date",function(){this.dateENtoCS=function(t){t=t||"";var e=t.split("-");return 3==e.length?[e[2].replace(/^0/,""),e[1].replace(/^0/,""),e[0]].join(". "):""},this.dateCStoEN=function(t){t=t||"";var e=t.split(".");if(3==e.length){var i=e[2].trim(),n=e[1].trim(),s=e[0].trim();return s=1==s.length?"0"+s:s,n=1==n.length?"0"+n:n,[i,n,s].join("-")}return""},this.isCSdate=function(t){return t=t||"",!!t.match(/([1-9]|[1-3][0-9])\.[ ]*([1-9]|1[0-2])\.[ ]*[1-9][0-9]{3}/)}}),onix.service("$dom",function(){this.create=function(t,e){var i=document.createElement(t.el);return Object.keys(t).forEach(function(n){switch(n){case"el":break;case"attrs":Object.keys(t.attrs).forEach(function(e){i.setAttribute(e,t.attrs[e])});break;case"events":t.events.forEach(function(t){i.addEventListener(t.event,t.fn)});break;case"child":t.child.forEach(function(t){i.appendChild(this.create(t,e))},this);break;case"_exported":e[t._exported]=i;break;case"class":var s=t["class"];"string"==typeof s?i.classList.add(s):Array.isArray(s)&&s.forEach(function(t){i.classList.add(t)});break;default:i[n]=t[n]}},this),i},this.get=function(t,e){var i;return e=e||document,"string"==typeof t&&t?i=e.querySelector(t):Array.isArray(t)&&(i={},t.forEach(function(t){if("string"==typeof t){var n=t.replace(/^[.# ]+/g,"");i[n]=e.querySelector(t)}else{var n=t.sel.replace(/^[.# ]+/g,"");i[t.name||n]=e.querySelector(t.sel)}})),i}}),onix.factory("$event",function(){var t=function(){};return t.prototype._eventInit=function(){this._allEvents=[]},t.prototype.on=function(t,e,i){arguments.length<2||this._allEvents.push({name:t,fn:e,scope:i})},t.prototype.off=function(t,e){if(t)for(var i=this._allEvents.length-1,n=i;n>=0;n--){var s=this._allEvents[n];s.name==t&&(!e||e&&s.fn==e)&&this._allEvents.splice(n,1)}},t.prototype.once=function(t,e,i){arguments.length<2||this._allEvents.push({name:t,fn:e,scope:i,once:!0})},t.prototype.trigger=function(t){if(t)for(var e=Array.prototype.slice.call(arguments,1),i=this._allEvents.length-1,n=i;n>=0;n--){var s=this._allEvents[n];s.name==t&&(s.fn.apply(s.scope||this,e),s.once&&this._allEvents.splice(n,1))}},t}),onix.factory("$resize",["$common","$event",function(t,e){var i=function(){this._eventInit(),this._active=!1,this._resizeObj={id:null,timeout:333},this._binds={resize:this._resize.bind(this),resizeInner:this._resizeInner.bind(this)}};return t.inherit(i,e),i.prototype._resize=function(){this._resizeObj.id&&(clearTimeout(this._resizeObj.id),this._resizeObj.id=null),this._resizeObj.id=setTimeout(this._binds.resizeInner,this._resizeObj.timeout)},i.prototype._resizeInner=function(){this.trigger("resize")},i.prototype.start=function(){this._active||(window.addEventListener("resize",this._binds.resize),this._active=!0)},i.prototype.end=function(){this._active&&(window.removeEventListener("resize",this._binds.resize),this._active=!1)},new i}]),onix.filter("lowercase",function(){return function(t){return"string"==typeof t?t.toLowerCase():t}}),onix.filter("uppercase",function(){return function(t){return"string"==typeof t?t.toUpperCase():t}}),onix.filter("json",function(){return function(t,e){if("object"==typeof t){var i=null;return e&&(e=parseInt(e,10),i=isNaN(e)?null:e),JSON.stringify(t,null,i)}return t}}),onix.service("$http",["$q","$common",function(t,e){this._preparePostData=function(t){var e=new FormData;return t&&(Array.isArray(t)?t.forEach(function(t){e.append(t.name,t.value)}):Object.keys(t).forEach(function(i){e.append(i,t[i])})),e},this._updateURL=function(t,e){if(e){var i=[];Array.isArray(e)&&(e.forEach(function(t){i.push(t.name+"="+encodeURIComponent(t.value))}),t+=(-1==t.indexOf("?")?"?":"")+i.join("&"))}return t},this.POST_TYPES={JSON:1,FORM_DATA:2},this.METHOD={POST:"POST",GET:"GET",DELETE:"DELETE",PATCH:"PATCH"},this.createRequest=function(i){var n=t.defer(),s=new XMLHttpRequest;i=i||{};var o=i.method||this.METHOD.GET,r=i.url||"";if(!r)return n.reject(),n;r=this._updateURL(r,i.getData),s.onerror=function(){n.reject()},s.open(o,r,!0),s.onreadystatechange=function(){if(4==s.readyState){var t=s.responseText||"",e=s.getResponseHeader("Content-Type"),i=null;i="application/json"==e?t.length?JSON.parse(t):{}:t,n[s.status>=200&&s.status<300?"resolve":"reject"]({status:s.status,data:i,url:r,method:o})}};try{var a=i.headers;e.isObject(a)&&Object.keys(a).forEach(function(t){s.setRequestHeader(t,a[t])}),o==this.METHOD.GET&&s.setRequestHeader("Accept","application/json");var h=i.postType||this.POST_TYPES.JSON;i.postData&&h==this.POST_TYPES.JSON?(s.setRequestHeader("Content-Type","application/json; charset=UTF-8"),s.send(JSON.stringify(i.postData))):i.postData&&h==this.POST_TYPES.FORM_DATA?s.send(this._preparePostData(i.postData)):s.send()}catch(c){n.reject()}return n}}]),onix.provider("$i18n",function(){var t={},e="",i=!0,n=function(t,e){t=t||"",e=e||{};var i=t.match(/{[^}]+,.*}|{[^}]*}/g);if(i){var n={};i.forEach(function(t){var i=t;i.length>2&&(i=i.substr(1,i.length-2));var s=i.split(","),o=s[0].trim(),r={};if(2==s.length){var a=s[1].match(/[a-zA-Z0-9_]+{[^}]*}/g);a&&a.forEach(function(t){var e=t.split("{"),i=e[1];i=i.substr(0,i.length-1),r[e[0].trim()]=i})}var h=o in e?e[o]:"";if("number"==typeof h&&Object.keys(r).length){var c;switch(h){case 1:c="one";break;case 2:case 3:case 4:c="few";break;default:c="other"}h=c in r?r[c]:""}n[t]=h}),Object.keys(n).forEach(function(e){t=t.replace(new RegExp(e,"g"),n[e])})}return t},s=function(i,s){i=i||"";var o=t[e],r="";if(o){var a=i.split("."),h=a.length;a.every(function(t,e){return t in o?(o=o[t],e==h-1?(r=o,!1):!0):!1})}return n(r,s)},o=function(e,i){e&&i&&(t[e]||(t[e]={}),Object.keys(i).forEach(function(n){t[e][n]=i[n]}))},r=function(t){e=t||""};this.disableGlobalTranslation=function(){i=!1},this.addLanguage=function(t,e){o(t,e)},this.setLanguage=function(t){r(t)},this.postProcess=function(){i&&(window._=s)},this.$get=["$http","$q",function(i,n){var a={_:function(t,e){return s(t,e)},addLanguage:function(t,e){o(t,e)},setLanguage:function(t){r(t)},getLanguage:function(t){return e},getAllLanguages:function(e){return Object.keys(t)},loadLanguage:function(t,e){var s=n.defer();return i.createRequest({url:e}).then(function(e){o(t,e.data),s.resolve()},function(t){s.resolve()}),s}};return a}]}),onix.config(["$i18nProvider",function(t){t.postProcess()}]),onix.service("$image",["$q",function(t){this._hasFileReader="FileReader"in window,this._hasCanvas=!!document.createElement("canvas").getContext,this.readFromFile=function(e,i){var n=t.defer();if(!this._hasFileReader)return n.reject(),n;var s=new FileReader,o={img:null,exif:null,canvas:null};return s.onload=function(t){var r=s.result,a=new Uint8Array(r),h=null;"png"!=e.type&&(h=this.getEXIF(r));var c=new Image;c.onload=function(){var t=this.getImageDim(c,i),e=this.getCanvas(c,{width:t.width,height:t.height,orientation:h?h.Orientation:0,scaled:1!=t.scale});o.img=c,o.exif=h,o.canvas=e,n.resolve(o)}.bind(this),c.src=this.fileToBase64(e.type,a)}.bind(this),s.readAsArrayBuffer(e),n},this.getImageDim=function(t,e){var e=e||0,i=e>0&&t.width>e,n=e>0&&t.height>e,s={width:t.width,height:t.height,scale:1};if(i||n){var o=t.width,r=t.height;t.width>t.height?(r=e*r/o,o=e):(o=e*o/r,r=e),s.scale=t.width/o,s.width=o,s.height=r}return s},this.getCanvas=function(t,e){var i={width:t.width||0,height:t.height||0,orientation:0,scaled:!1};for(var n in e)i[n]=e[n];if(!this._hasCanvas)return null;var s=document.createElement("canvas"),o=s.getContext("2d"),r=!0;if(s.width=i.width,s.height=i.height,i.orientation)switch(i.orientation){case 2:o.translate(i.width,0),o.scale(-1,1);break;case 3:o.translate(i.width,i.height),o.rotate(Math.PI);break;case 4:o.translate(0,i.height),o.scale(1,-1);break;case 5:s.width=i.height,s.height=i.width,o.rotate(.5*Math.PI),o.scale(1,-1),i.scaled&&(o.clearRect(0,0,s.width,s.height),o.drawImage(t,0,0,t.width,t.height,0,0,s.height,s.width),r=!1);break;case 6:s.width=i.height,s.height=i.width,o.rotate(.5*Math.PI),o.translate(0,-i.height),i.scaled&&(o.clearRect(0,0,s.width,s.height),o.drawImage(t,0,0,t.width,t.height,0,0,s.height,s.width),r=!1);break;case 7:s.width=i.height,s.height=i.width,o.rotate(.5*Math.PI),o.translate(i.width,-i.height),o.scale(-1,1),i.scaled&&(o.clearRect(0,0,s.width,s.height),o.drawImage(t,0,0,t.width,t.height,0,0,s.height,s.width),r=!1);break;case 8:s.width=i.height,s.height=i.width,o.rotate(-.5*Math.PI),o.translate(-i.width,0),
i.scaled&&(o.clearRect(0,0,s.width,s.height),o.drawImage(t,0,0,t.width,t.height,0,0,s.height,s.width),r=!1)}return r&&(o.clearRect(0,0,s.width,s.height),i.scaled?o.drawImage(t,0,0,t.width,t.height,0,0,s.width,s.height):o.drawImage(t,0,0)),s},this.fileToBase64=function(t,e){for(var i=e.length,n="",s=0;i>s;s+=1)n+=String.fromCharCode(e[s]);return"data:"+t+";base64,"+btoa(n)},this.isPicture=function(t){return t?"image/jpeg"==t.type||"image/pjpeg"==t.type||"image/png"==t.type:!1},this.getPictureFiles=function(t){var e=[];if(t&&t.length)for(var i=0;i<t.length;i++){var n=t[i];this.isPicture(n)&&e.push(n)}return e},this.getPicturesCount=function(t){return this.getPictureFiles(t).length},this.getEXIF=function(t){return"EXIF"in window?EXIF.readFromBinaryFile(t):{}}}]),onix.factory("$job",["$q",function(t){var e=function(){this._donePromise=t.defer(),this._tasks=[],this._taskDone={cb:null,scope:null}};return e.prototype.add=function(t,e,i){i=i||[],Array.isArray(i)||(i=[i]),this._tasks.push({task:t,scope:e,args:i})},e.prototype.start=function(){return this._tasks.length?(this._tasks.reverse(),this._doJob(),this._donePromise):void 0},e.prototype.clear=function(){this._tasks=[]},e.prototype.setTaskDone=function(t,e){this._taskDone.cb=t,this._taskDone.scope=e},e.prototype._doJob=function(){var t=this._tasks.length;if(0==t)this._donePromise.resolve();else{var e=this._tasks.pop(),i=function(){if(this._taskDone.cb){var t=Array.prototype.slice.call(arguments,0);this._taskDone.cb.apply(this._taskDone.scope||this._taskDone.cb,t)}this._doJob()}.bind(this);e.task.apply(e.scope||e.task,e.args.concat(i))}},{create:function(){return new e},multipleJobs:function(e,i,n){for(var s=e.length,o=[],r=0;s>r;r++){var a=i>0?r%i:r,h=e[r];o[a]||(o[a]=this.create(),n&&o[a].setTaskDone(n.cb,n.scope)),o[a].add(h.task,h.scope,h.args)}var c=[];return o.forEach(function(t){c.push(t.start())}),t.all(c)}}}]),onix.factory("$localStorage",function(){var t="localStorage"in window?localStorage:{_data:{},setItem:function(t,e){t&&(this._data[t]=e)},getItem:function(t){return t?this._data[t]:null},removeItem:function(t){t&&t in this._data&&delete this._data[t]}};return{set:function(e,i){t.setItem(e,i)},get:function(e){return t.getItem(e)},remove:function(e){t.removeItem(e)}}}),onix.service("$location",function(){this.refresh=function(){window.location.reload()},this.createSearchURL=function(t){var e=[];if(t){var e=[];Object.keys(t).forEach(function(i){e.push(i+"="+encodeURIComponent(t[i]))})}return e.length?"?"+e.join("&"):""},this.search=function(t){if(!t){var e=location.search,i={};return e&&(e=e.replace("?",""),e.split("&").forEach(function(t){var e=t.split("=");i[e[0]]=decodeURIComponent(e[1])})),i}var n=this.createSearchURL(t);n&&(window.location.search=n)},this.get=function(){return window.location.pathname}}),onix.service("$math",function(){this._CONST={ZOOM:156543.034},this.isBBoxIntersection=function(t,e){var i=Math.max(t.x,e.x),n=Math.max(t.y,e.y),s=Math.min(t.x+t.width,e.x+e.width),o=Math.min(t.y+t.height,e.y+e.height),r=Math.abs(s-i),a=Math.abs(o-n);return s>=i&&o>=n&&r*a>0},this.getBBox=function(t){for(var e=1/0,i=1/0,n=-(1/0),s=-(1/0),o=0;o<t.length;o++)e=Math.min(t[o].x,e),i=Math.min(t[o].y,i),n=Math.max(t[o].x,n),s=Math.max(t[o].y,s);return{x:e,y:i,width:Math.abs(n-e),height:Math.abs(s-i)}},this.det2=function(t,e,i,n){return t*n-i*e},this.linesIntersection=function(t,e){var i=1e-6,n=this.det2(t.x1-t.x2,t.y1-t.y2,e.x1-e.x2,e.y1-e.y2);if(Math.abs(n)<i)return null;var s=this.det2(t.x1,t.y1,t.x2,t.y2),o=this.det2(e.x1,e.y1,e.x2,e.y2),r=this.det2(s,t.x1-t.x2,o,e.x1-e.x2)/n,a=this.det2(s,t.y1-t.y2,o,e.y1-e.y2)/n;return r<Math.min(t.x1,t.x2)-i||r>Math.max(t.x1,t.x2)+i?null:a<Math.min(t.y1,t.y2)-i||a>Math.max(t.y1,t.y2)+i?null:r<Math.min(e.x1,e.x2)-i||r>Math.max(e.x1,e.x2)+i?null:a<Math.min(e.y1,e.y2)-i||a>Math.max(e.y1,e.y2)+i?null:{x:Math.round(r),y:Math.round(a)}},this.pointBBoxIntersection=function(t,e){return t.x>=e.x&&t.x<=e.x+e.width&&t.y>=e.y&&t.y<=e.y+e.height},this.log2=function(t){return Math.log(t)/Math.log(2)},this.zoomToDistance=function(t,e,i){var n=this._CONST.ZOOM/Math.pow(2,t),s=i/2,o=Math.floor(n*s),r=e/360*Math.PI;return Math.floor(o/Math.tan(r))},this.distanceToZoom=function(t,e,i){var n=e/360*Math.PI,s=Math.tan(n)*t,o=2*s/i;return Math.floor(this.log2(this._CONST.ZOOM/o))},this.movePointByAngle=function(t,e){var i=(360-e)/180*Math.PI,n=t.x,s=t.y;t.x=n*Math.cos(i)-s*Math.sin(i),t.y=n*Math.sin(i)+s*Math.cos(i)},this.movePointByVector=function(t,e,i){var n={x:e.x,y:e.y};this.movePointByAngle(n,i||0),t.x+=n.x,t.y+=n.y},this.setRange=function(t,e,i){return e>t?e:t>i?i:t}}),onix.factory("$myQuery",function(){var t=function(e,i){return this._els=[],i=i||document,"string"==typeof e?(i instanceof t&&(i=i.getEl()),this._els=i.querySelectorAll(e)):Array.isArray(e)?this._els=e:this._els.push(e),this};return t.prototype._operation=function(t,e){Array.isArray(this._els)||(this._els=Array.prototype.slice.call(this._els)),this._els.forEach(function(i,n){t.apply(e||t,[i,n])})},t.prototype._setGetAll=function(t,e){if(t)return this._operation(function(i){i[e]=t}),this;var i=[];return this._operation(function(t){i.push(t[e])}),i.length?1==i.length?i[0]:i:null},t.prototype.getEl=function(t){return t=t||0,t>this._els.length?null:this._els[t]},t.prototype.attr=function(t,e){if(e)return this._operation(function(i){i.setAttribute(t,e)}),this;var i=[];return this._operation(function(e){i.push(e.getAttribute(t))}),i.length?1==i.length?i[0]:i:null},t.prototype.src=function(t){return this._setGetAll(t,"src")},t.prototype.hide=function(){return this._operation(function(t){t.style.display="none"}),this},t.prototype.show=function(t){return this._operation(function(e){e.style.display=t||""}),this},t.prototype.val=function(t){return this._setGetAll(t,"value")},t.prototype.html=function(t){return this._setGetAll(t,"innerHTML")},t.prototype.append=function(t){return this._operation(function(e){e.appendChild(t)}),this},t.prototype.addClass=function(t){return this._operation(function(e){e.classList.add(t)}),this},t.prototype.removeClass=function(t){return this._operation(function(e){e.classList.remove(t)}),this},t.prototype.toggleClass=function(t){return this._operation(function(e){e.classList.toggle(t)}),this},t.prototype.width=function(){var t=0;return this._operation(function(e){t+=e.offsetWidth}),t},t.prototype.height=function(){var t=0;return this._operation(function(e){t+=e.offsetHeight}),t},t.prototype.click=function(t,e){return this._operation(function(i){i.addEventListener("click",function(n){t.apply(e||t,[n,i])})}),this},t.prototype.change=function(t,e){return this._operation(function(i){i.addEventListener("change",function(n){t.apply(e||t,[n,i])})}),this},t.prototype.forEach=function(t,e){return this._operation(function(i,n){t.apply(e||t,[i,n])}),this},t.prototype.remove=function(){return this._operation(function(t){t.parentNode.removeChild(t)}),this},t.prototype.prepend=function(t){return this._operation(function(e){e.parentNode.insertBefore(t,e)}),this},t.prototype.empty=function(){return this._operation(function(t){for(;t.firstChild;)t.removeChild(t.firstChild)}),this},t.prototype.len=function(){return this._els.length},onix.element=function(e,i){return new t(e,i)},{get:function(e,i){return new t(e,i)}}}),onix.run(["$myQuery",function(){}]),onix.factory("$promise",function(){var t=function(t){this._STATES={IDLE:0,RESOLVED:1,REJECTED:2},this._state=this._STATES.IDLE,this._funcs=[],this._finishData=null,t&&"function"==typeof t&&t.apply(t,[this._resolve.bind(this),this._reject.bind(this)])};return t.prototype._resolve=function(t){this._finishData=t,this._resolveFuncs(!1)},t.prototype._reject=function(t){this._finishData=t,this._resolveFuncs(!0)},t.prototype._resolveFuncs=function(t){this._funcs.forEach(function(e){(e["finally"]||e.isError&&t||!e.isError&&!t)&&e.fn(this._finishData)},this),this._funcs.length=0,this._state=t?this._STATES.REJECTED:this._STATES.RESOLVED},t.prototype._isAlreadyFinished=function(){this._state!=this._STATES.IDLE&&this._resolveFuncs(this._state==this._STATES.REJECTED)},t.prototype.then=function(t,e){return t&&"function"==typeof t&&this._funcs.push({fn:t,isError:!1}),e&&"function"==typeof e&&this._funcs.push({fn:e,isError:!0}),this._isAlreadyFinished(),this},t.prototype.done=function(t){return this._funcs.push({fn:t,isError:!1}),this._isAlreadyFinished(),this},t.prototype.error=function(t){return this._funcs.push({fn:t,isError:!0}),this._isAlreadyFinished(),this},t.prototype["finally"]=function(t){return this._funcs.push({fn:t,"finally":!0}),this._isAlreadyFinished(),this},t.all=function(e){return new t(function(t){if(Array.isArray(e)){var i=e.length,n=function(){i--,0==i&&t()};e.forEach(function(t){t["finally"](n)})}else t()})},t.resolve=function(e){return new t(function(t){t(e)})},t.reject=function(e){return new t(function(t,i){i(e)})},t}),onix.factory("$q",function(){var t=function(){this._STATES={IDLE:0,RESOLVED:1,REJECTED:2},this._state=this._STATES.IDLE,this._funcs=[],this._finishData=null};return t.prototype._resolveFuncs=function(t){this._funcs.forEach(function(e){(e["finally"]||e.isError&&t||!e.isError&&!t)&&e.fn(this._finishData)},this),this._funcs.length=0,this._state=t?this._STATES.REJECTED:this._STATES.RESOLVED},t.prototype._isAlreadyFinished=function(){this._state!=this._STATES.IDLE&&this._resolveFuncs(this._state==this._STATES.REJECTED)},t.prototype.resolve=function(t){this._finishData=t,this._resolveFuncs(!1)},t.prototype.reject=function(t){this._finishData=t,this._resolveFuncs(!0)},t.prototype.then=function(t,e){return t&&"function"==typeof t&&this._funcs.push({fn:t,isError:!1}),e&&"function"==typeof e&&this._funcs.push({fn:e,isError:!0}),this._isAlreadyFinished(),this},t.prototype.done=function(t){return this._funcs.push({fn:t,isError:!1}),this._isAlreadyFinished(),this},t.prototype.error=function(t){return this._funcs.push({fn:t,isError:!0}),this._isAlreadyFinished(),this},t.prototype["finally"]=function(t){return this._funcs.push({fn:t,"finally":!0}),this._isAlreadyFinished(),this},{_chainPromisesInner:function(t,e,i){var n=t.shift();if(n){var s,o=!1;switch(typeof n.method){case"string":n.scope&&n.method in n.scope?(s=n.scope[n.method],"function"!=typeof s&&(o=!0)):o=!0;break;case"function":s=n.method;break;default:o=!0}o?e.resolve(i):s.apply(n.scope||s,n.args||[]).then(function(n){i.push(n),this._chainPromisesInner(t,e,i)}.bind(this),function(n){i.push(n),this._chainPromisesInner(t,e,i)}.bind(this))}else e.resolve(i)},all:function(e){var i=new t;if(Array.isArray(e)){var n=e.length,s=function(){n--,0==n&&i.resolve()};e.forEach(function(t){t["finally"](s)})}else i.resolve();return i},defer:function(){return new t},isPromise:function(e){return e instanceof t},chainPromises:function(t){var e=this.defer();return this._chainPromisesInner(t,e,[]),e}}}),onix.service("$route",["$location","$template","$di","$routeParams",function(t,e,i,n){this._routes=[],this._otherwise=null,this._setRouteParams=function(t){Object.keys(n).forEach(function(t){delete n[t]}),t=t||{},Object.keys(t).forEach(function(e){n[e]=t[e]})},this.when=function(t,e){return this._routes.push({url:t,config:e}),this},this.otherwise=function(t){return this._otherwise={config:t},this},this._runController=function(t,e){var n=i.parseParam(t);this._setRouteParams(e),i.run({fn:n.fn,inject:n.inject})},this.go=function(){var i=t.get(),n=!1,s=null;if(this._routes.every(function(t){return i.match(new RegExp(t.url))?(s=t.config,n=!0,!1):!0}),!n&&this._otherwise&&(s=this._otherwise.config),s){var o="",r=null,a=null,h={};Object.keys(s).forEach(function(t){var e=s[t];switch(t){case"templateId":o=e;break;case"templateUrl":r=e;break;case"controller":a=e;break;default:h[t]=e}}),r?e.load(s.templateId||s.templateUrl,s.templateUrl).done(function(){a&&this._runController(a,h)}.bind(this)):a&&this._runController(a,h)}}}]),onix.factory("$routeParams",function(){return{}}),onix.provider("$template",function(){var t={left:"{{",right:"}}"};this.setConfig=function(e){Object.keys(e).forEach(function(i){t[i]=e[i]})},this.$get=["$common","$q","$http","$filter",function(e,i,n,s){var o={_cache:{},_RE:{VARIABLE:/[$_a-zA-Z][$_a-zA-Z0-9]+/g,NUMBERS:/[-]?[0-9]+[.]?([0-9e]+)?/g,STRINGS:/["'][^"']+["']/g,JSONS:/[{][^}]+[}]/g,ALL:/[-]?[0-9]+[.]?([0-9e]+)?|["'][^"']+["']|[{][^}]+[}]|[$_a-zA-Z][$_a-zA-Z0-9]+/g},_CONST:{FILTER_DELIMETER:"|",FILTER_PARAM_DELIMETER:":",TEMPLATE_SCRIPT_SELECTOR:"script[type='text/template']"},_parseFnName:function(t){return t=t||"",t.match(/[a-zA-Z0-9_]+/)[0]},_parseArgs:function(t,e){argsValue=t?t.replace(/^[^(]+./,"").replace(/\).*$/,""):"";var i=[],n=argsValue.match(this._RE.ALL);if(n){var s=[];n.forEach(function(t){var i;if(t.match(this._RE.STRINGS))i=t.substr(1,t.length-2);else if(t.match(this._RE.NUMBERS))i=parseFloat(t);else if(t.match(this._RE.JSONS))i=JSON.parse(t);else if(t.match(this._RE.VARIABLE)){var n=t.match(this._RE.VARIABLE)[0];i="$event"==n?e.event:"$element"==n?e.el:null}s.push({value:i,pos:argsValue.indexOf(t)})},this),s.length&&s.sort(function(t,e){return t.pos-e.pos}).forEach(function(t){i.push(t.value)})}return i},_bindEvent:function(t,i,n,s){n&&this._parseFnName(n)in s&&t.addEventListener(i,e.bindWithoutScope(function(t,e){var n=this.getAttribute("data-"+i),o=e._parseFnName(n),r=e._parseArgs(n,{el:this,event:t});s[o].apply(s,r)},this))},_init:function(){onix.element(this._CONST.TEMPLATE_SCRIPT_SELECTOR).forEach(function(t){this.add(t.id||"",t.innerHTML)},this)},add:function(t,e){this._cache[t]=e},compile:function(e,i){var n=this.get(e);if(i){var o=n.match(new RegExp(t.left+"(.*?)"+t.right,"g"))||[];o.forEach(function(e){var o=e;if(e=e.replace(new RegExp("^"+t.left),"").replace(new RegExp(t.right+"$"),""),-1!=e.indexOf(this._CONST.FILTER_DELIMETER)){var r;e.split(this._CONST.FILTER_DELIMETER).forEach(function(t,e){if(t=t.trim(),e){var n=[r],o=t.split(this._CONST.FILTER_PARAM_DELIMETER),a="";1==o.length?a=o[0].trim():o.forEach(function(t,e){t=t.trim(),e?n.push(t):a=t});var h=s(a);r=h.apply(h,n)}else t in i&&(r=i[t])},this),n=n.replace(o,r||"")}else{var a="";e=e.trim(),e in i&&(a=i[e]),n=n.replace(o,a)}},this)}return n},get:function(t){return this._cache[t]||""},bindTemplate:function(t,e,i){var n=onix.element("*[data-click], *[data-change], *[data-bind], *[data-keydown]",t);if(n.len()){var s={};n.forEach(function(t){this._bindEvent(t,"click",t.getAttribute("data-click"),e),this._bindEvent(t,"change",t.getAttribute("data-change"),e),this._bindEvent(t,"keydown",t.getAttribute("data-keydown"),e);var i=t.getAttribute("data-bind");i&&(s[i]=t)},this),i&&"function"==typeof i&&i(s)}},load:function(t,e){var s=i.defer();return n.createRequest({url:e}).then(function(e){this.add(t,e.data),s.resolve()}.bind(this),function(t){s.reject()}),s}};return o._init(),o}]}),onix.factory("$anonymizer",["$math","$event","$loader","$q","$common",function(t,e,i,n,s){var o=function(t,e){if(this._hasCanvas=!!document.createElement("canvas").getContext,!this._hasCanvas)return console.error("Canvas is not available!"),null;this._eventInit(),this._parent=t,this._parent.classList.add("anonymizer"),this._opts={canWidth:t.offsetWidth||0,canHeight:t.offsetHeight||0,zoom:100,minZoom:20,maxZoom:100,zoomStep:10,zoomMoveStep:1,curEntity:o.ENTITES.CIRCLE,showPreview:!0,previewLeft:17,previewTop:17,previewWidth:200,entityPreview:null};for(var n in e)this._opts[n]=e[n];this._canWidth=this._opts.canWidth,this._canHeight=this._opts.canHeight,this._zoom=this._opts.zoom,this._zoomStep=this._opts.zoomStep,this._zoomMoveStep=0,this._curWidth=0,this._curHeight=0,this._canvas=document.createElement("canvas"),this._canvas.width=this._canWidth,this._canvas.height=this._canHeight,this._ctx=this._canvas.getContext("2d"),this._img=null,this._imgWidth=0,this._imgHeight=0,this._lineCanvas=null,this._lineCanvasCtx=null,this._entityCanvas=null,this._entityCanvasCtx=null,this._entites=[],this._x=0,this._y=0,this._THRESHOLD={MIN:-1,MAX:1},this._mouse={startXSave:0,startYSave:0,startX:0,startY:0},this._flags={wasRightClick:!1,wasMove:!1,wasPreview:!1,wasLine:!1,wasImgMove:!1},this._binds={mouseWheel:this._mouseWheel.bind(this),mouseDown:this._mouseDown.bind(this),mouseMove:this._mouseMove.bind(this),mouseUp:this._mouseUp.bind(this),mouseMoveLine:this._mouseMoveLine.bind(this),mouseUpLine:this._mouseUpLine.bind(this),mouseUpDocument:this._mouseUpDocument.bind(this),contextMenu:this._contextmenu.bind(this)},this._canvas.addEventListener("DOMMouseScroll",this._binds.mouseWheel),this._canvas.addEventListener("mousewheel",this._binds.mouseWheel),this._canvas.addEventListener("mousedown",this._binds.mouseDown),this._canvas.addEventListener("contextmenu",this._binds.contextMenu),this._spinner=i.getSpinner(),t.appendChild(this._spinner),t.appendChild(this._canvas),this._opts.entityPreview&&(this._entityCanvas=document.createElement("canvas"),this._entityCanvas.width=300,this._entityCanvas.height=150,this._entityCanvasCtx=this._entityCanvas.getContext("2d"),this._opts.entityPreview.appendChild(this._entityCanvas))};return s.inherit(o,e),o.ENTITES={CIRCLE:{min:10,value:50,max:100,id:"CIRCLE",fillStyle:"rgba(0, 0, 255, 0.5)",priority:1},LINE:{min:10,value:20,max:100,id:"LINE",strokeStyle:"rgba(0, 255, 0, 0.5)",priority:2}},o.prototype._redraw=function(){if(this._ctx.clearRect(0,0,this._canWidth,this._canHeight),this._ctx.drawImage(this._img,this._x,this._y,this._img.width,this._img.height,0,0,this._curWidth,this._curHeight),this._entites.length){var t=this._zoom/100,e=this._x*t,i=this._y*t;this._entites.forEach(function(n){switch(n.id){case o.ENTITES.CIRCLE.id:var s=Math.round(n.value*t),r=Math.round(this._curWidth*n.xRatio-e),a=Math.round(this._curHeight*n.yRatio-i);this._drawCircle(this._ctx,r,a,s);break;case o.ENTITES.LINE.id:var h=Math.round(n.value*t),r=Math.round(this._curWidth*n.xRatio-e),a=Math.round(this._curHeight*n.yRatio-i),c=Math.round(this._curWidth*n.x2Ratio-e),u=Math.round(this._curHeight*n.y2Ratio-i);this._drawLine(this._ctx,r,a,c,u,h)}},this)}this._drawPreview()},o.prototype._setWhiteCanvas=function(){this._ctx.clearRect(0,0,this._canWidth,this._canHeight),this._drawFillRect(this._ctx,0,0,this._canWidth,this._canHeight,"#fff")},o.prototype._drawCircle=function(t,e,i,n){t.beginPath(),t.arc(e,i,n,0,2*Math.PI),t.fillStyle=o.ENTITES.CIRCLE.fillStyle,t.closePath(),t.fill()},o.prototype._drawLine=function(t,e,i,n,s,r){t.beginPath(),t.moveTo(e,i),t.lineTo(n,s),t.lineWidth=r,t.strokeStyle=o.ENTITES.LINE.strokeStyle,t.closePath(),t.stroke()},o.prototype._drawFillRect=function(t,e,i,n,s,o){t.beginPath(),t.fillStyle=o||"",t.fillRect(e,i,n,s),t.closePath()},o.prototype._drawRect=function(t,e,i,n,s,o,r){t.beginPath(),t.rect(e,i,n,s),t.lineWidth=r||1,t.strokeStyle=o||"",t.closePath(),t.stroke()},o.prototype._drawPreview=function(){if(this._opts.showPreview){var e=this._imgWidth/this._imgHeight,i=Math.round(this._opts.previewWidth/e);this._drawFillRect(this._ctx,this._opts.previewLeft-1,this._opts.previewTop-1,this._opts.previewWidth+2,i+2,"rgba(255, 255, 255, 0.5)"),this._ctx.drawImage(this._img,0,0,this._img.width,this._img.height,this._opts.previewLeft,this._opts.previewTop,this._opts.previewWidth,i);var n=this._zoom/100,s=this._x*n,o=this._y*n,r=s/this._curWidth,a=o/this._curHeight,h=(s+this._canWidth)/this._curWidth,c=(o+this._canHeight)/this._curHeight;r=t.setRange(r,0,1),a=t.setRange(a,0,1),h=t.setRange(h,0,1),c=t.setRange(c,0,1);var u=Math.round(this._opts.previewLeft+r*this._opts.previewWidth),l=Math.round(this._opts.previewTop+a*i),p=Math.round(this._opts.previewLeft+h*this._opts.previewWidth),d=Math.round(this._opts.previewTop+c*i);this._drawRect(this._ctx,u,l,p-u,d-l,"#C01",1)}},o.prototype._drawEntityPreview=function(){if(this._opts.entityPreview){var t=this._entityCanvas.width,e=this._entityCanvas.height;this._entityCanvasCtx.clearRect(0,0,t,e),this._drawFillRect(this._entityCanvasCtx,0,0,t,e,"#f9f9f9");var i=this._opts.curEntity,n=this._zoom/100;switch(i.id){case o.ENTITES.CIRCLE.id:var s=Math.round(i.value*n),r=Math.round(t/2),a=Math.round(e/2);this._drawCircle(this._entityCanvasCtx,r,a,s);break;case o.ENTITES.LINE.id:var h=Math.round(.2*t),c=Math.round(e/2),u=Math.round(.8*t),l=Math.round(i.value*n);this._drawLine(this._entityCanvasCtx,h,c,u,c,l)}}},o.prototype._getFromPoint=function(t,e){var i={x:t||Math.round(this._canWidth/2),y:e||Math.round(this._canHeight/2)},n=this._zoom/100,t=Math.round(this._x*n)+i.x,e=Math.round(this._y*n)+i.y;return i.xRatio=t/this._curWidth,i.yRatio=e/this._curHeight,i},o.prototype._postZoom=function(){var t=this._zoom/100;this._curWidth=Math.round(this._img.width*t),this._curHeight=Math.round(this._img.height*t),this._zoom<100&&(this._zoomMoveStep=Math.max((100-this._zoom)/10*this._opts.zoomMoveStep/2,1))},o.prototype._setCenter=function(){this._setPosition(.5,.5)},o.prototype._setPosition=function(e,i,n,s){n=n||this._canWidth/2,s=s||this._canHeight/2,e=t.setRange(e,0,1),i=t.setRange(i,0,1);var o=this._zoom/100,r=this._curWidth*e-n,a=this._curHeight*i-s;this._x=Math.max(Math.round(r/o),0),this._y=Math.max(Math.round(a/o),0)},o.prototype._alignImgToCanvas=function(){var t=Math.max(this._curWidth-this._canWidth,0),e=Math.round(this._x*this._zoom/100);this._x<0?this._x=0:e>t&&(this._x=Math.round(100*t/this._zoom));var i=Math.max(this._curHeight-this._canHeight,0),n=Math.round(this._y*this._zoom/100);this._y<0?this._y=0:n>i&&(this._y=Math.round(100*i/this._zoom))},o.prototype._isRightClick=function(t){return!(!t||!(t.which&&3==t.which||t.button&&2==t.button))},o.prototype._contextmenu=function(t){t.stopPropagation(),t.preventDefault()},o.prototype._mouseWheel=function(t){if(this._imgWidth||this._imgHeight){var e=t.wheelDelta||-t.detail;if(e){t.stopPropagation(),t.preventDefault();var i=this._getFromPoint(t.offsetX,t.offsetY);e>0?this._setZoom(this._zoom+this._zoomStep,i):this._setZoom(this._zoom-this._zoomStep,i)}}},o.prototype._mouseDown=function(t){if(this._imgWidth||this._imgHeight)if(t.stopPropagation(),t.preventDefault(),this._mouse.startXSave=t.offsetX,this._mouse.startYSave=t.offsetY,this._mouse.startX=t.offsetX,this._mouse.startY=t.offsetY,this._flags.wasMove=!1,this._flags.wasRightClick=this._isRightClick(t),this._opts.curEntity==o.ENTITES.CIRCLE)this._flags.wasImgMove=!1,this._flags.wasPreview=!1,this._canvas.addEventListener("mousemove",this._binds.mouseMove),this._canvas.addEventListener("mouseup",this._binds.mouseUp),this._canvas.addEventListener("mouseleave",this._binds.mouseUp);else if(this._opts.curEntity==o.ENTITES.LINE){var e=document.createElement("canvas");e.width=this._canWidth,e.height=this._canHeight,e.classList.add("line-canvas"),this._flags.wasPreview=!1,this._flags.wasLine=!1,this._lineCanvas=e,this._lineCanvas.addEventListener("mousemove",this._binds.mouseMoveLine),this._lineCanvas.addEventListener("mouseup",this._binds.mouseUpLine),this._lineCanvas.addEventListener("contextmenu",this._binds.contextMenu),this._flags.wasRightClick&&this._lineCanvas.classList.add("is-dragged"),document.addEventListener("mouseup",this._binds.mouseUpDocument),this._lineCanvasCtx=this._lineCanvas.getContext("2d"),this._parent.appendChild(e)}},o.prototype._imgMove=function(t,e){var i=this._mouse.startX-t,n=this._mouse.startY-e;if(0!=i||0!=n){var s=this._zoomMoveStep>0?this._zoomMoveStep:1;this._x=i*s+this._x,this._y=n*s+this._y,this._alignImgToCanvas(),this._redraw()}},o.prototype._mouseMove=function(t){this._flags.wasMove||this._canvas.classList.add("is-dragged"),this._flags.wasMove=!0;var e=this._isPreview(t.offsetX,t.offsetY);this._flags.wasRightClick||this._flags.wasImgMove||!e?this._flags.wasPreview||(this._flags.wasImgMove=!0,this._imgMove(t.offsetX,t.offsetY)):(this._flags.wasPreview=!0,this._setPosition(e.xRatio,e.yRatio),this._alignImgToCanvas(),this._redraw()),this._mouse.startX=t.offsetX,this._mouse.startY=t.offsetY},o.prototype._isPreview=function(t,e){if(!this._opts.showPreview)return null;var i=this._imgWidth/this._imgHeight,n=this._opts.previewWidth,s=Math.round(this._opts.previewWidth/i),o=this._opts.previewLeft,r=this._opts.previewTop;this._zoom/100;return t=t||0,e=e||0,t>=o&&o+n>=t&&e>=r&&r+s>=e?{xRatio:(t-o)/n,yRatio:(e-r)/s}:null},o.prototype._mouseUp=function(t){var e=!1;if(this._flags.wasMove){var i=this._mouse.startXSave-t.offsetX,n=this._mouse.startYSave-t.offsetY;i>=this._THRESHOLD.MIN&&i<=this._THRESHOLD.MAX&&n>=this._THRESHOLD.MIN&&n<=this._THRESHOLD.MAX&&(e=!0)}if(!this._flags.wasRightClick&&(!this._flags.wasMove||e)){var s=this._isPreview(t.offsetX,t.offsetY);if(s)this._setPosition(s.xRatio,s.yRatio),this._alignImgToCanvas(),this._redraw();else{var o=this._zoom/100,r=Math.round(this._x*o)+t.offsetX,a=Math.round(this._y*o)+t.offsetY;this._entites.push({id:this._opts.curEntity.id,value:this._opts.curEntity.value,xRatio:r/this._curWidth,yRatio:a/this._curHeight}),this._redraw()}}this._canvas.classList.remove("is-dragged"),this._canvas.removeEventListener("mousemove",this._binds.mouseMove),this._canvas.removeEventListener("mouseup",this._binds.mouseUp),this._canvas.removeEventListener("mouseleave",this._binds.mouseUp)},o.prototype._mouseMoveLine=function(t){if(this._flags.wasMove=!0,this._flags.wasRightClick)this._imgMove(t.offsetX,t.offsetY),this._mouse.startX=t.offsetX,this._mouse.startY=t.offsetY;else{var e=this._isPreview(t.offsetX,t.offsetY),i=this._flags.wasPreview;if(!this._flags.wasLine&&e)this._flags.wasPreview=!0,this._setPosition(e.xRatio,e.yRatio),this._alignImgToCanvas(),this._redraw();else if(!this._flags.wasPreview){this._flags.wasLine=!0;var n=Math.round(this._opts.curEntity.value*this._zoom/100);this._lineCanvasCtx.clearRect(0,0,this._canWidth,this._canHeight),this._drawLine(this._lineCanvasCtx,this._mouse.startX,this._mouse.startY,t.offsetX,t.offsetY,n)}!i&&this._flags.wasPreview&&this._lineCanvas.classList.add("is-dragged")}},o.prototype._mouseUpLine=function(t){var e=null;if(this._flags.wasMove||(e=this._isPreview(t.offsetX,t.offsetY)),!this._flags.wasRightClick)if(e)this._setPosition(e.xRatio,e.yRatio),this._alignImgToCanvas(),this._redraw();else if(this._flags.wasLine){var i=this._zoom/100,n=Math.round(this._x*i),s=Math.round(this._y*i),o=n+this._mouse.startX,r=s+this._mouse.startY,a=n+t.offsetX,h=s+t.offsetY;this._entites.push({id:this._opts.curEntity.id,value:this._opts.curEntity.value,xRatio:o/this._curWidth,yRatio:r/this._curHeight,x2Ratio:a/this._curWidth,y2Ratio:h/this._curHeight}),this._redraw()}this._lineCanvas.classList.remove("is-dragged"),this._lineCanvas.removeEventListener("mousemove",this._binds.mouseMoveLine),this._lineCanvas.removeEventListener("mouseup",this._binds.mouseUpLine),this._lineCanvas.removeEventListener("contextmenu",this._binds.contextMenu),document.removeEventListener("mouseup",this._binds.mouseUpDocument),this._parent.removeChild(this._lineCanvas),this._lineCanvas=null},o.prototype._mouseUpDocument=function(t){this._flags.wasLine=!1,this._mouseUpLine(t)},o.prototype._setZoom=function(e,i){var n=this._zoom,s=t.setRange(e,this._opts.minZoom,this._opts.maxZoom);s!=n&&(this._zoom=s,this.trigger("zoom",this._zoom),this._postZoom(),i=i||this._getFromPoint(),this._setPosition(i.xRatio,i.yRatio,i.x,i.y),this._alignImgToCanvas(),this._drawEntityPreview(),this._redraw())},o.prototype.loadImage=function(t){var e=n.defer();this._setWhiteCanvas(),this._spinner.classList.remove("hide");var i=new Image;return i.addEventListener("load",function(){this._spinner.classList.add("hide"),this._img=i,this._imgWidth=i.width,this._imgHeight=i.height,this._zoom=this._opts.zoom,this.trigger("zoom",this._zoom),this._postZoom(),this._setCenter(),this._alignImgToCanvas(),this._drawEntityPreview(),this._redraw(),e.resolve()}.bind(this)),i.addEventListener("error",function(){this._spinner.classList.add("hide"),this._img=null,this._imgWidth=0,this._imgHeight=0,e.reject()}.bind(this)),i.src=t||"",e},o.prototype.zoomPlus=function(){this._setZoom(this._zoom+this._zoomStep)},o.prototype.zoomMinus=function(){this._setZoom(this._zoom-this._zoomStep)},o.prototype.setZoom=function(t){this._setZoom(t)},o.prototype.getEntityId=function(){return this._opts.curEntity.id},o.prototype.switchEntity=function(){var t=Object.keys(o.ENTITES),e=(this._opts.curEntity.priority,null),i=null;t.forEach(function(t){var n=o.ENTITES[t];!e&&n.priority>this._opts.curEntity.priority&&(e=n),(!i||n.priority<i.priority)&&(i=n)},this),e||(e=i),this._opts.curEntity=e,this._drawEntityPreview()},o.prototype.getEntity=function(){return this._opts.curEntity},o.prototype.setEntityValue=function(t){return t=t||0,t>=this._opts.curEntity.min&&t<=this._opts.curEntity.max?(this._opts.curEntity.value=t,this._drawEntityPreview(),!0):!1},o.prototype.setCircleEntity=function(){this._opts.curEntity=o.ENTITES.CIRCLE,this._drawEntityPreview()},o.prototype.setLineEntity=function(){this._opts.curEntity=o.ENTITES.LINE,this._drawEntityPreview()},o.prototype.stepBack=function(){(this._imgWidth||this._imgHeight)&&(this._entites.pop(),this._redraw())},o.prototype.removeAll=function(){(this._imgWidth||this._imgHeight)&&(this._entites=[],this._redraw())},o.prototype.exportEntites=function(){var t={actions:[],image:{width:this._imgWidth,height:this._imgHeight}};return this._entites.forEach(function(e){switch(e.id){case o.ENTITES.CIRCLE.id:t.actions.push({type:e.id.toLowerCase(),x:Math.round(this._imgWidth*e.xRatio),y:Math.round(this._imgHeight*e.yRatio),r:e.value});break;case o.ENTITES.LINE.id:t.actions.push({type:e.id.toLowerCase(),x1:Math.round(this._imgWidth*e.xRatio),y1:Math.round(this._imgHeight*e.yRatio),x2:Math.round(this._imgWidth*e.x2Ratio),y2:Math.round(this._imgHeight*e.y2Ratio),width:e.value})}},this),t},o.prototype.syncPort=function(t,e){t=t||this._parent.offsetWidth,e=e||this._parent.offsetHeight,this._canWidth=t,this._canHeight=e,this._canvas.width=t,this._canvas.height=e,this._img&&(this._postZoom(),this._setCenter(),this._alignImgToCanvas(),this._drawEntityPreview(),this._redraw())},o}]),onix.factory("$loader",["$dom",function(t){var e={_create:function(){this._el=t.create({el:"div","class":"loader"}),document.body.insertBefore(this._el,document.body.firstChild)},_init:function(){this._create()},start:function(){this._el.classList.add("start")},end:function(){this._el.classList.remove("start"),this._el.classList.add("end"),setTimeout(function(){this._el.classList.remove("end"),this._el.classList.add("hide"),setTimeout(function(){this._el.classList.remove("hide")}.bind(this),350)}.bind(this),150)},getSpinner:function(e){for(var i=[],n=1;6>n;n++)i.push({el:"div","class":"rect"+n});var s={el:"div","class":"spinner",child:i};return e?s:t.create(s)}};return e._init(),e}]),onix.service("$notify",["$common","$q",function(t,e){var i=function(t){return this._el=t,this._HIDE_TIMEOUT=1500,this._options={ok:"alert-success",error:"alert-danger",info:"alert-info",warn:"alert-warning"},this};i.prototype._setValue=function(e){t.isElement(e)?onix.element(this._el).empty().append(e):"string"==typeof e&&(this._el.innerHTML=e)},i.prototype.reset=function(){return Object.keys(this._options).forEach(function(t){this._el.classList.remove(this._options[t])}.bind(this)),this},i.prototype.ok=function(t){return this._el.classList.add(this._options.ok),this._setValue(t),this},i.prototype.error=function(t){return this._el.classList.add(this._options.error),this._setValue(t),this},i.prototype.info=function(t){return this._el.classList.add(this._options.info),this._setValue(t),this},i.prototype.warn=function(t){return this._el.classList.add(this._options.warn),this._setValue(t),this},i.prototype.hide=function(t){var i=e.defer();return setTimeout(function(){this.reset(),i.resolve()}.bind(this),t||this._HIDE_TIMEOUT),i},this.get=function(t){return new i(t)}}]),onix.service("$previewImages",["$q","$image","$dom","$job","$loader",function(t,e,i,n,s){this._createPreview=function(t,e){var n={},o=i.create({el:"span","class":["preview-item","preview-loading"],child:[{el:"span","class":"canvas-cover",child:[s.getSpinner(!0)],style:"height: "+(e||100)+"px",_exported:"canvasCover"},{
el:"span","class":"title",innerHTML:t.name.replace(/\..*/g,"")}]},n);return{cont:o,canvasCover:n.canvasCover}},this._createPreviewHolders=function(t,e){if(t&&(4==e||7==e)){var n={};7==e&&t.appendChild(i.create({el:"div",child:[{el:"span",_exported:"img_06"}]},n));for(var s=[],o=7==e?6:4,r=0;o>r;r++)s.push({el:"span",_exported:"img_0"+r});t.appendChild(i.create({el:"div",child:s},n));for(var r=0;e>r;r++)this._dom["img_0"+r]=n["img_0"+r]}},this._jobTask=function(t,i,n){var s=t.file,o=t.previewID,r=this._createPreview(s,i);o in this._dom?this._dom[o].appendChild(r.cont):this._dom.previewItems.appendChild(r.cont),e.readFromFile(s,i).then(function(t){r.cont.classList.remove("preview-loading"),r.canvasCover.innerHTML="",r.canvasCover.appendChild(t.canvas),n()})},this.show=function(t,i,s){t.innerHTML="",t.classList.add("preview-images");var o={maxSize:0,count:0,createHolder:!1};for(var r in s)o[r]=s[r];this._dom={previewItems:t};var a=e.getPictureFiles(i),h=a.length;if(h){o.createHolder&&this._createPreviewHolders(t,h);var c=[];a=a.sort(function(t,e){return t.name<e.name?-1:t.name>e.name?1:0}).forEach(function(t,e){c.push({task:this._jobTask,scope:this,args:[{file:t,previewID:"img_0"+e},o.maxSize]})},this),n.multipleJobs(c,o.count)}}}]),onix.factory("$select",["$common","$event","$dom",function(t,e,i){var n=function(e,i){this._eventInit(),this._opts={addCaption:!1};for(var n in i)this._opts[n]=i[n];this._CONST={CAPTION_SEL:".dropdown-toggle",OPTIONS_SEL:".dropdown-menu a",CARET_SEL:".caret",OPEN_DROPDOWN_SEL:".dropdown.open",OPEN_CLASS:"open",ACTIVE_CLASS:"active"},this._el=e,this._optinsRef=[],this._captionEl=null,this.captionTextEl=null,this._binds={captionClick:t.bindWithoutScope(this._captionClick,this),choiceClick:t.bindWithoutScope(this._choiceClick,this),removeAllOpened:this._removeAllOpened.bind(this),click:this._click.bind(this)},this._bind()};return t.inherit(n,e),n.prototype._bind=function(){this._bindCaption(),this._bindChoices()},n.prototype._bindCaption=function(){var t=this._el.querySelector(this._CONST.CAPTION_SEL);if(t&&(t.addEventListener("click",this._binds.captionClick),this._opts.addCaption)){var e=t.querySelector(this._CONST.CARET_SEL);if(e){var n=i.create({el:"span","class":"add-caption"});t.insertBefore(n,e),this._captionTextEl=n}}this._captionEl=t},n.prototype._removeAllOpened=function(){var t=this._CONST;onix.element(t.OPEN_DROPDOWN_SEL).forEach(function(e){e.classList.remove(t.OPEN_CLASS)})},n.prototype._click=function(){this._removeAllOpened(),window.removeEventListener("click",this._binds.click)},n.prototype._captionClick=function(t,e){t.stopPropagation();var i=e._el.classList.contains(e._CONST.OPEN_CLASS);e._binds.removeAllOpened(),i?window.removeEventListener("click",e._binds.click):(window.addEventListener("click",e._binds.click),e._el.classList.add(e._CONST.OPEN_CLASS))},n.prototype._bindChoices=function(){onix.element(this._CONST.OPTIONS_SEL,this._el).forEach(function(t){t.addEventListener("click",this._binds.choiceClick),this._optinsRef.push({el:t,event:"click",fn:this._binds.choiceClick})},this)},n.prototype._choiceClick=function(t,e){var i=e._CONST;if(t.stopPropagation(),!this.parentNode.classList.contains(i.ACTIVE_CLASS)){var n=this.parentNode.parentNode.querySelector("."+i.ACTIVE_CLASS);n&&n.classList.remove(i.ACTIVE_CLASS),this.parentNode.classList.add(i.ACTIVE_CLASS),e._el.classList.remove(i.OPEN_CLASS),e._opts.addCaption&&e._captionTextEl&&(e._captionTextEl.innerHTML=this.innerHTML);var s=this.getAttribute("data-value")||"";e.trigger("change",s)}},n.prototype.unbindChoices=function(){this._optinsRef.length&&(this._optinsRef.forEach(function(t){t.el.removeEventListener(t.event,t.fn)}),this._optinsRef=[])},n.prototype.rebindChoices=function(){this.unbindChoices(),this._bindChoices()},n.prototype.selectOption=function(t){t=t||0;var e=this._optinsRef.length;if(e>0&&t>=0&&e>t){var i=this._optinsRef[t].el,n=this._optinsRef[t].el.parentNode;if(!n.classList.contains(this._CONST.ACTIVE_CLASS)){n.classList.add(this._CONST.ACTIVE_CLASS),this._opts.addCaption&&this._captionTextEl&&(this._captionTextEl.innerHTML=i.innerHTML);var s=i.getAttribute("data-value")||"";this.trigger("change",s)}}},n.prototype.setAddCaption=function(){this._opts.addCaption&&this._optinsRef.every(function(t){var e=t.el.parentNode;return e.classList.contains(this._CONST.ACTIVE_CLASS)?(this._captionTextEl.innerHTML=t.el.innerHTML,!1):!0},this)},n}]),onix.factory("$slider",["$dom","$event","$common",function(t,e,i){var n=function(t,e){this._eventInit(),this._parent=t,this._root=this._create(),this._opts={min:0,max:100,timeout:333};for(var i in e)this._opts[i]=e[i];this._value=null,this._signalObj={id:null,lastValue:null},this._isKeydown=!1,t.appendChild(this._root),this._binds={keyUp:this._keyUp.bind(this),click:this._click.bind(this),mouseDownCaret:this._mouseDownCaret.bind(this),mouseMoveLineHolder:this._mouseMoveLineHolder.bind(this),mouseUpDocument:this._mouseUpDocument.bind(this),sendSignalInner:this._sendSignalInner.bind(this),mouseWheel:this._mouseWheel.bind(this)},this._els.input.addEventListener("keyup",this._binds.keyUp),this._els.tube.addEventListener("click",this._binds.click),this._els.caret.addEventListener("mousedown",this._binds.mouseDownCaret),this._els.lineHolder.addEventListener("mousemove",this._binds.mouseMoveLineHolder),this._els.lineHolder.addEventListener("DOMMouseScroll",this._binds.mouseWheel),this._els.lineHolder.addEventListener("mousewheel",this._binds.mouseWheel),this.setValue(this._opts.max)};return i.inherit(n,e),n.prototype._create=function(){return this._els={},t.create({el:"div","class":"slider",child:[{el:"input",type:"text",value:"",_exported:"input"},{el:"span","class":"line-holder",_exported:"lineHolder",child:[{el:"span","class":"lh-tube",_exported:"tube"},{el:"span","class":"lh-caret",_exported:"caret"}]}]},this._els)},n.prototype._setCaret=function(t){var e=this._els.lineHolder.offsetWidth;0>t?t=0:t>e&&(t=e),this._els.caret.style.left=t.toFixed(2)+"px"},n.prototype._keyUp=function(){var t=this._els.input,e=parseFloat(t.value),i=0;isNaN(e)?i++:this.setValue(e)?this._sendSignal(!0):i++,t.classList[i?"add":"remove"]("error")},n.prototype._click=function(t){t.stopPropagation(),t.preventDefault();var e=this._els.lineHolder.offsetWidth,i=t.offsetX,n=i/e;.05>=n?i=0:n>=.95&&(i=e),this._isKeydown=!1,this._setCaret(i),this._setValue(i,!0)},n.prototype._mouseDownCaret=function(t){t.stopPropagation(),t.preventDefault(),this._isKeydown=!0,document.addEventListener("mouseup",this._binds.mouseUpDocument)},n.prototype._mouseUpDocument=function(){this._isKeydown=!1,document.removeEventListener("mouseup",this._binds.mouseUpDocument)},n.prototype._mouseMoveLineHolder=function(t){if(this._isKeydown){var e=t.offsetX,i=this._els.caret;t.target==i&&(e+=parseFloat(i.style.left)-i.offsetWidth/2),this._setCaret(e),this._setValue(e)}},n.prototype._getPosFromValue=function(t){t=t||this._value;var e=this._els.lineHolder.offsetWidth,i=this._opts.max-this._opts.min,n=(t-this._opts.min)/i*e;return n},n.prototype._setValue=function(t,e){t=t||0;var i=this._els.lineHolder.offsetWidth,n=this._opts.max-this._opts.min;0>t?t=0:t>i&&(t=i);var s=Math.round(t/i*n+this._opts.min);this._value=s,this._els.input.value=s,this._sendSignal(!e)},n.prototype._sendSignal=function(t){this._signalObj.id&&(clearTimeout(this._signalObj.id),this._signalObj.id=null),t?this._signalObj.id=setTimeout(this._binds.sendSignalInner,this._opts.timeout):this._sendSignalInner()},n.prototype._mouseWheel=function(t){var e=t.wheelDelta||-t.detail;e&&(t.stopPropagation(),t.preventDefault(),e>0?(this.setValue(this._value+1),this._sendSignal()):(this.setValue(this._value-1),this._sendSignal()))},n.prototype._sendSignalInner=function(){this._value!=this._signalObj.lastValue&&(this._signalObj.lastValue=this._value,this.trigger("change",this._value))},n.prototype.setValue=function(t){return"number"==typeof t&&t>=this._opts.min&&t<=this._opts.max?(this._value=t,this._els.input.value=t,this._setCaret(this._getPosFromValue(t)),!0):!1},n.prototype.getValue=function(){return this._value},n.prototype.rewriteOpts=function(t){for(var e in t)this._opts[e]=t[e];(this._value<this._opts.min||this._value>this._opts.max)&&(this._value=this._opts.max),this.setValue(this._value)},n}]),onix.factory("$crop",["$dom","$math",function(t,e){var i=function(t){this._CONST={HIDE_CLASS:"hide"},this._options={width:250,height:250,minWidth:10,minHeight:10,maxWidth:1/0,maxHeight:1/0,resizable:!0,aspectRatio:null};for(var e in t)this._options[e]=t[e];this._dim={areaWidth:0,areaHeight:0,width:this._options.width,height:this._options.height},this._changed=!1,this._backupData=null,this._groups={"point-nw":[{type:"nw",x:!0,y:!0},{type:"sw",x:!0},{type:"ne",y:!0}],"point-ne":[{type:"ne",x:!0,y:!0},{type:"se",x:!0},{type:"nw",y:!0}],"point-sw":[{type:"sw",x:!0,y:!0},{type:"nw",x:!0},{type:"se",y:!0}],"point-se":[{type:"se",x:!0,y:!0},{type:"ne",x:!0},{type:"sw",y:!0}]},this._points={nw:{x:0,y:0},ne:{x:0,y:0},sw:{x:0,y:0},se:{x:0,y:0}},this._type=null,this._mouse={startXSave:0,startYSave:0,startX:0,startY:0},this._binds={mouseDown:this._mouseDown.bind(this),mouseMove:this._mouseMove.bind(this),mouseUp:this._mouseUp.bind(this)},this._dom={},this._create(),this.setCenter(),this.hide()};return i.prototype._create=function(){var e=["crop"];this._options.resizable&&e.push("resizable"),t.create({el:"div","class":e,child:[{el:"div","class":"crop-top",child:[{el:"span","class":"point-nw"},{el:"span","class":"point-ne"}],_exported:"cropTop"},{el:"div","class":"crop-bottom",child:[{el:"span","class":"point-sw"},{el:"span","class":"point-se"}],_exported:"cropBottom"},{el:"div","class":"crop-left",_exported:"cropLeft"},{el:"div","class":"crop-right",_exported:"cropRight"},{el:"div","class":"crop-middle",_exported:"cropMiddle"}],_exported:"container"},this._dom),this._dom.container.addEventListener("mousedown",this._binds.mouseDown)},i.prototype._setCenter=function(){var t=this._dim.width,e=this._dim.height,i=Math.round((this._dim.areaWidth-t)/2),n=Math.round((this._dim.areaHeight-e)/2),s=this._points;s.nw.x=i,s.nw.y=n,s.ne.x=s.nw.x+t,s.ne.y=s.nw.y+e,s.sw.x=this._dim.areaWidth-i,s.sw.y=this._dim.areaHeight-n,s.se.x=s.ne.x,s.se.y=s.ne.y},i.prototype._alignPoints=function(){var t=this._points;t.nw.x=e.setRange(t.nw.x,0,this._dim.areaWidth-this._dim.width),t.sw.x=e.setRange(t.sw.x,0,this._dim.areaWidth-this._dim.width),t.ne.x=e.setRange(t.ne.x,this._dim.width,this._dim.areaWidth),t.se.x=e.setRange(t.se.x,this._dim.width,this._dim.areaWidth),t.nw.y=e.setRange(t.nw.y,0,this._dim.areaHeight-this._dim.height),t.ne.y=e.setRange(t.ne.y,0,this._dim.areaHeight-this._dim.height),t.sw.y=e.setRange(t.sw.y,this._dim.height,this._dim.areaHeight),t.se.y=e.setRange(t.se.y,this._dim.height,this._dim.areaHeight)},i.prototype._redraw=function(){var t=this._points,e=t.nw.x,i=t.nw.y,n=this._getSize();this._dom.cropTop.style.left=e+"px",this._dom.cropTop.style.width=n.width+"px",this._dom.cropTop.style.height=i+"px",this._dom.cropBottom.style.left=e+"px",this._dom.cropBottom.style.width=n.width+"px",this._dom.cropBottom.style.height=this._dim.areaHeight-t.sw.y+"px",this._dom.cropLeft.style.width=e+"px",this._dom.cropLeft.style.height=this._dim.areaHeight+"px",this._dom.cropRight.style.width=this._dim.areaWidth-t.ne.x+"px",this._dom.cropRight.style.height=this._dim.areaHeight+"px",this._dom.cropMiddle.style.width=n.width+"px",this._dom.cropMiddle.style.height=n.height+"px",this._dom.cropMiddle.style.left=e+"px",this._dom.cropMiddle.style.top=i+"px"},i.prototype._mouseDown=function(t){t.stopPropagation(),t.preventDefault();var e=t?t.target:null;switch(this._type=e.getAttribute("class"),this._type){case"crop-top":case"crop-bottom":case"crop-left":case"crop-right":return}this._mouse.startX=t.clientX,this._mouse.startY=t.clientY,this._mouse.startXSave=t.clientX,this._mouse.startYSave=t.clientY,document.addEventListener("mousemove",this._binds.mouseMove),document.addEventListener("mouseup",this._binds.mouseUp)},i.prototype._mouseMove=function(t){t.stopPropagation(),t.preventDefault();var e=t.clientX-this._mouse.startX,i=t.clientY-this._mouse.startY;if("crop-middle"==this._type)Object.keys(this._points).forEach(function(t){this._points[t].x+=e,this._points[t].y+=i},this),this._alignPoints(),this._redraw();else{var n=this._groups[this._type];if(this._options.aspectRatio&&(i=e/this._options.aspectRatio*("point-nw"==this._type||"point-se"==this._type?1:-1)),this._resizeTest(e,i,n)){n.forEach(function(t){var n=this._points[t.type];n.x+=t.x?e:0,n.y+=t.y?i:0},this);var s=this._getSize();this._dim.width=s.width,this._dim.height=s.height,this._redraw()}}this._mouse.startX=t.clientX,this._mouse.startY=t.clientY},i.prototype._mouseUp=function(t){t.stopPropagation(),t.preventDefault(),document.removeEventListener("mousemove",this._binds.mouseMove),document.removeEventListener("mouseup",this._binds.mouseUp),this._mouse.startXSave==t.clientX&&this._mouse.startYSave==t.clientY||(this._changed=!0)},i.prototype._getSize=function(t){return t=t||this._points,{width:Math.abs(t.ne.x-t.nw.x),height:Math.abs(t.sw.y-t.nw.y)}},i.prototype._resizeTest=function(t,e,i){if(!this._options.aspectRatio)return!1;var n={nw:{x:this._points.nw.x,y:this._points.nw.y},ne:{x:this._points.ne.x,y:this._points.ne.y},sw:{x:this._points.sw.x,y:this._points.sw.y},se:{x:this._points.se.x,y:this._points.se.y}};i.forEach(function(i){var s=n[i.type];s.x=this._points[i.type].x+(i.x?t:0),s.y=this._points[i.type].y+(i.y?e:0)},this);var s=this._getSize(n);return!(s.width<this._options.minWidth||s.width>this._options.maxWidth||s.height<this._options.minHeight||s.height>this._options.maxHeight||n.nw.x<0||n.se.x>this._dim.areaWidth||n.nw.y<0||n.sw.y>this._dim.areaHeight)},i.prototype.setCenter=function(){this._setCenter(),this._redraw()},i.prototype.destroy=function(){var t=this.getContainer();t.parentNode&&t.parentNode.removeChild(t)},i.prototype.getContainer=function(){return this._dom.container},i.prototype.setDim=function(t){if(t){var e=t.width,i=t.height;this._dim.areaWidth=e,this._dim.areaHeight=i,this._dom.container.style.width=e+"px",this._dom.container.style.height=i+"px";var n=Math.min(this._dim.width,this._dim.areaWidth),s=Math.min(this._dim.height,this._dim.areaHeight);this._options.aspectRatio&&(s=Math.round(n/this._options.aspectRatio)),this._dim.width=n,this._dim.height=s,this.setCenter()}},i.prototype.show=function(){this._dom.container.classList.remove(this._CONST.HIDE_CLASS)},i.prototype.hide=function(){this._dom.container.classList.add(this._CONST.HIDE_CLASS)},i.prototype.isVisible=function(){return!this._dom.container.classList.contains(this._CONST.HIDE_CLASS)},i.prototype.isChanged=function(){return this._changed},i.prototype.backup=function(){this._backupData={changed:this._changed,aabb:this.getAABB()}},i.prototype.restore=function(){if(this._backupData){this._changed=this._backupData.changed;var t=this._backupData.aabb,e=this._points.nw,i=this._points.ne,n=this._points.sw,s=this._points.se;e.x=t[0],e.y=t[1],s.x=t[2],s.y=t[3],i.x=s.x,i.y=e.y,n.x=e.x,n.y=s.y,this._redraw(),this._backupData=null}},i.prototype.getAABB=function(t){var e=this._points.nw,i=this._points.se;return t=t||1,[Math.round(e.x*t),Math.round(e.y*t),Math.round(i.x*t),Math.round(i.y*t)]},i}]);