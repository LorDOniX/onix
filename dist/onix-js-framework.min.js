/**
 * OnixJS framework; https://gitlab.com/LorDOniX/onix
 */
Onix=function(){var a={_VERSION:"1.1.3",_DATE:"18. 6. 2015",_objects:{},_config:{},_runs:[],_TYPES:{SERVICE:1,FACTORY:2},_init:function(){document.addEventListener("DOMContentLoaded",function(){var a=this._di(this._run);a.fn.apply(this,a.args)}.bind(this))},_di:function(a){var b,c=[];return Array.isArray(a)?a.every(function(a){return"function"==typeof a?(b=a,!1):(c.push(this._objects[a]),!0)},this):b=a,{fn:b,args:c}},_addObject:function(a,b,c){try{var d=this._di(c);this._objects[a]=b==this._TYPES.SERVICE?new(Function.prototype.bind.apply(d.fn,[null].concat(d.args))):d.fn.apply(d.fn,d.args)}catch(e){console.error("Onix._addObject error "+e+" in "+a)}},_run:["i18n","Templates","Loader","Router","MyQuery",function(a,b,c,d,e){this.element=function(a,b){return new e.get(a,b)},c.init(),d.init();var f=function(){this._runs.forEach(function(a){var b=this._di(a);new(Function.prototype.bind.apply(b.fn,[null].concat(b.args)))}.bind(this)),b.init().done(function(){d.go()})}.bind(this);this.config("LOCALIZATION").LANG&&this.config("LOCALIZATION").PATH?(window._=a._.bind(a),a.setLanguage(this.config("LOCALIZATION").LANG),a.loadLanguage(this.config("LOCALIZATION").LANG,this.config("LOCALIZATION").PATH).done(f)):f()}],service:function(a,b){this._addObject(a,this._TYPES.SERVICE,b)},factory:function(a,b){this._addObject(a,this._TYPES.FACTORY,b)},run:function(a){this._runs.push(a)},constant:function(a,b){this._objects[a]=b},config:function(a){return"string"==typeof a?this._config[a]||{}:void Object.keys(a).forEach(function(b){this._config[b]=a[b]}.bind(this))},getObject:function(a){return a=a||"",this._objects[a]}};return a._init(),a}(),Onix.config({LOCALIZATION:{LANG:"cs",PATH:"/js/locale/cs.json"},URLS:{HOME:"/api/home/"},TMPL_DELIMITER:{LEFT:"{{",RIGHT:"}}"},DETAIL_SEL:".detail"}),Onix.factory("Promise",function(){var a=function(){this._E_STATES={IDLE:0,RESOLVED:1,REJECTED:2},this._state=this._E_STATES.IDLE,this._funcs=[],this._finishData=null};return a.prototype._resolveFuncs=function(a){this._funcs.forEach(function(b){(b["finally"]||b.isError&&a||!b.isError&&!a)&&b.fn(this._finishData)},this),this._funcs.length=0,this._state=a?this._E_STATES.REJECTED:this._E_STATES.RESOLVED},a.prototype._isAlreadyFinished=function(){this._state!=this._E_STATES.IDLE&&this._resolveFuncs(this._state==this._E_STATES.REJECTED)},a.prototype.resolve=function(a){this._finishData=a,this._resolveFuncs(!1)},a.prototype.reject=function(a){this._finishData=a,this._resolveFuncs(!0)},a.prototype.then=function(a,b){return a&&"function"==typeof a&&this._funcs.push({fn:a,isError:!1}),b&&"function"==typeof b&&this._funcs.push({fn:b,isError:!0}),this._isAlreadyFinished(),this},a.prototype.done=function(a){return this._funcs.push({fn:a,isError:!1}),this._isAlreadyFinished(),this},a.prototype.error=function(a){return this._funcs.push({fn:a,isError:!0}),this._isAlreadyFinished(),this},a.prototype["finally"]=function(a){return this._funcs.push({fn:a,"finally":!0}),this._isAlreadyFinished(),this},{all:function(b){var c=new a;if(Array.isArray(b)){var d=b.length,e=function(){d--,0==d&&c.resolve()};b.forEach(function(a){a["finally"](e)})}else c.resolve();return c},defer:function(){return new a}}}),Onix.factory("MyQuery",function(){var a=function(a,b){return this._els=[],b=b||document,"string"==typeof a?this._els=b.querySelectorAll(a):Array.isArray(a)?this._els=a:this._els.push(a),this};return a.prototype._operation=function(a,b){Array.isArray(this._els)||(this._els=Array.prototype.slice.call(this._els)),this._els.forEach(function(c,d){a.apply(b||a,[c,d])})},a.prototype._setGetAll=function(a,b){if(a)return this._operation(function(c){c[b]=a}),this;var c=[];return this._operation(function(a){c.push(a[b])}),c.length?1==c.length?c[0]:c:null},a.prototype.getEl=function(a){return a=a||0,a>this._els.length?null:this._els[a]},a.prototype.attr=function(a,b){if(b)return this._operation(function(c){c.setAttribute(a,b)}),this;var c=[];return this._operation(function(b){c.push(b.getAttribute(a))}),c.length?1==c.length?c[0]:c:null},a.prototype.src=function(a){return this._setGetAll(a,"src")},a.prototype.hide=function(){return this._operation(function(a){a.style.display="none"}),this},a.prototype.show=function(a){return this._operation(function(b){b.style.display=a||"block"}),this},a.prototype.val=function(a){return this._setGetAll(a,"value")},a.prototype.html=function(a){return this._setGetAll(a,"innerHTML")},a.prototype.append=function(a){return this._operation(function(b){b.appendChild(a)}),this},a.prototype.addClass=function(a){return this._operation(function(b){b.classList.add(a)}),this},a.prototype.removeClass=function(a){return this._operation(function(b){b.classList.remove(a)}),this},a.prototype.toggleClass=function(a){return this._operation(function(b){b.classList.toggle(a)}),this},a.prototype.width=function(){var a=0;return this._operation(function(b){a+=b.offsetWidth}),a},a.prototype.height=function(){var a=0;return this._operation(function(b){a+=b.offsetHeight}),a},a.prototype.click=function(a,b){return this._operation(function(c){c.addEventListener("click",function(d){a.apply(b||a,[d,c])})}),this},a.prototype.change=function(a,b){return this._operation(function(c){c.addEventListener("change",function(d){a.apply(b||a,[d,c])})}),this},a.prototype.forEach=function(a,b){return this._operation(function(c,d){a.apply(b||a,[c,d])}),this},a.prototype.remove=function(){return this._operation(function(a){a.parentNode.removeChild(a)}),this},a.prototype.prepend=function(a){return this._operation(function(b){b.parentNode.insertBefore(a,b)}),this},a.prototype.len=function(){return this._els.length},{get:function(b,c){return new a(b,c)}}}),Onix.service("DOM",function(){this.create=function(a,b){var c=document.createElement(a.el);return Object.keys(a).forEach(function(d){switch(d){case"el":break;case"attrs":Object.keys(a.attrs).forEach(function(b){c.setAttribute(b,a.attrs[b])});break;case"events":a.events.forEach(function(a){c.addEventListener(a.event,a.fn)});break;case"child":a.child.forEach(function(a){c.appendChild(this.create(a,b))},this);break;case"_exported":b[a._exported]=c;break;case"class":var e=a["class"];"string"==typeof e?c.classList.add(e):Array.isArray(e)&&e.forEach(function(a){c.classList.add(a)});break;default:c[d]=a[d]}},this),c},this.get=function(a,b){var c;return b=b||document,"string"==typeof a&&a?c=b.querySelector(a):Array.isArray(a)&&(c={},a.forEach(function(a){if("string"==typeof a){var d=a.replace(/^[.# ]+/g,"");c[d]=b.querySelector(a)}else{var d=a.sel.replace(/^[.# ]+/g,"");c[a.name||d]=b.querySelector(a.sel)}})),c}}),Onix.service("$location",function(){this.refresh=function(){window.location.reload()},this.createSearchURL=function(a){var b=[];if(a){var b=[];Object.keys(a).forEach(function(c){b.push(c+"="+encodeURIComponent(a[c]))})}return b.length?"?"+b.join("&"):""},this.search=function(a){if(!a){var b=location.search,c={};return b&&(b=b.replace("?",""),b.split("&").forEach(function(a){var b=a.split("=");c[b[0]]=decodeURIComponent(b[1])})),c}var d=this.createSearchURL(a);d&&(window.location.search=d)},this.get=function(){return window.location.pathname}}),Onix.service("Router",["$location",function(a){this._routes=[],this._otherwise=null,this.init=function(){},this.route=function(a,b,c){return this._routes.push({url:a,page:b,fn:c}),this},this.otherwise=function(a,b){return this._otherwise={page:a,fn:b},this},this.go=function(){var b=a.get(),c=!1,d="",e={};if(this._routes.every(function(a){return b.match(new RegExp(a.url))?(d=a.page,e=a.fn(),c=!0,!1):!0}),!c&&this._otherwise&&(d=this._otherwise.page,e=this._otherwise.fn()),d){var f=Onix.getObject(d);f&&(f._setConfig(e),f._init())}}}]),Onix.service("Notify",["Promise",function(a){var b=function(a){return this._el=a,this._HIDE_TIMEOUT=1500,this._options={ok:"alert-success",error:"alert-danger",info:"alert-info"},this};b.prototype.reset=function(){return Object.keys(this._options).forEach(function(a){this._el.classList.remove(this._options[a])}.bind(this)),this},b.prototype.ok=function(a){return this._el.classList.add(this._options.ok),this._el.innerHTML=a,this},b.prototype.error=function(a){return this._el.classList.add(this._options.error),this._el.innerHTML=a,this},b.prototype.info=function(a){return this._el.classList.add(this._options.info),this._el.innerHTML=a,this},b.prototype.hide=function(){var b=a.defer();return setTimeout(function(){this.reset(),b.resolve()}.bind(this),this._HIDE_TIMEOUT),b},this.get=function(a){return new b(a)}}]),Onix.service("Common",["Promise",function(a){this._objCopy=function(a,b){Object.keys(b).forEach(function(c){if(b.hasOwnProperty(c)){var d=b[c],e=typeof d;if(Array.isArray(d)){var f=[];d.forEach(function(a){f.push(a)}),a[c]=f}else d&&"object"===e?(c in a||(a[c]={}),this._objCopy(a[c],d)):a[c]=d}}.bind(this))},this.getCookie=function(a){var b=null;if(document.cookie&&""!=document.cookie){var c=document.cookie.split(";");c.every(function(c){return c=c.trim(),c.substring(0,a.length+1)==a+"="?(b=decodeURIComponent(c.substring(a.length+1)),!1):!0})}return b},this.confirm=function(b){var c=a.defer();return confirm(b)?c.resolve():c.reject(),c},this.create=function(a,b,c){var d=[];return b&&c&&Array.isArray(b)&&b.forEach(function(a){d.push(Onix.getObject(a))}),d.push(a),d.push(c||b),this.merge.apply(this,d)},this.merge=function(){var a=arguments.length,b={};if(a>0)for(var c=0;a>c;c++){var d=arguments[c];this._objCopy(b,d)}return b},this.extend=function(a,b){a=a||{},b=b||{},this._objCopy(a,b)},this.bindWithoutScope=function(a){var b=Array.prototype.slice.call(arguments,1);return function(){var c=Array.prototype.slice.call(arguments,0),d=Array.prototype.concat(c,b);return a.apply(this,d)}},this.nodesForEach=function(a,b,c){b=b||function(){},a&&Array.prototype.slice.call(a).forEach(function(a,d){b.apply(c||b,[a,d])})},this.reverseForEach=function(a,b,c){a=a||[],b=b||function(){};for(var d=a.length-1;d>=0;d--)b.apply(c||this,[a[d],d])},this.hxToDe=function(a){switch(a=a.toLowerCase()){case"a":return 10;case"b":return 11;case"c":return 12;case"d":return 13;case"e":return 14;case"f":return 15;default:return parseInt(a,10)}},this.hexToRGB=function(a){return"#"==a[0]?(a=a.replace("#",""),3==a.length?{r:16*this.hxToDe(a[0])+this.hxToDe(a[0]),g:16*this.hxToDe(a[1])+this.hxToDe(a[1]),b:16*this.hxToDe(a[2])+this.hxToDe(a[2])}:{r:16*this.hxToDe(a[0])+this.hxToDe(a[1]),g:16*this.hxToDe(a[2])+this.hxToDe(a[3]),b:16*this.hxToDe(a[4])+this.hxToDe(a[5])}):a},this.ift=function(a,b,c){a&&b.apply(c||b,[a])}}]),Onix.factory("Events",["Common",function(a){return{_allEvents:[],_getEvents:function(a){var b=[];return this._allEvents.forEach(function(c,d){a==c.name&&b.push({item:c,pos:d})}),b},on:function(a,b,c){this._allEvents.push({name:a,fn:b,scope:c})},off:function(b,c){var d=this._getEvents(b);a.reverseForEach(d,function(a){(!c||c&&a.fn==c)&&this._allEvents.splice(a.pos,1)},this)},once:function(a,b,c){this._allEvents.push({name:a,fn:b,scope:c,once:!0})},trigger:function(b){var c=this._getEvents(b),d=arguments,e=[];c.forEach(function(a){var b=Array.prototype.slice.call(d,0);b.shift();var c=a.item;c.fn.apply(c.scope||this,b),c.once&&e.push(a.pos)},this),a.reverseForEach(e,function(a){this._allEvents.splice(a,1)},this)}}}]),Onix.service("Loader",["DOM",function(a){this._create=function(){this._el=a.create({el:"div","class":"loader"}),document.body.insertBefore(this._el,document.body.firstChild)},this.init=function(){this._create()},this.start=function(){this._el.classList.add("start")},this.end=function(){this._el.classList.remove("start"),this._el.classList.add("end"),setTimeout(function(){this._el.classList.remove("end"),this._el.classList.add("hide"),setTimeout(function(){this._el.classList.remove("hide")}.bind(this),350)}.bind(this),150)}}]),Onix.service("Http",["Promise",function(a){this._preparePostData=function(a){var b=new FormData;return a&&(Array.isArray(a)?a.forEach(function(a){b.append(a.name,a.value)}):Object.keys(a).forEach(function(c){b.append(c,a[c])})),b},this._updateURL=function(a,b){if(b){var c=[];Array.isArray(b)&&(b.forEach(function(a){c.push(a.name+"="+encodeURIComponent(a.value))}),a+=(-1==a.indexOf("?")?"?":"")+c.join("&"))}return a},this.POST_TYPES={JSON:1,FORM_DATA:2},this.METHOD={POST:"POST",GET:"GET",DELETE:"DELETE",PATCH:"PATCH"},this.createRequest=function(b){var c=a.defer(),d=new XMLHttpRequest;b=b||{};var e=b.method||this.METHOD.GET,f=b.url||"";if(!f)return c.reject(),c;f=this._updateURL(f,b.getData),d.onerror=function(){c.reject()},d.open(e,f,!0),d.onreadystatechange=function(){if(4==d.readyState){var a=d.responseText||"",b=d.getResponseHeader("Content-Type"),g=null;g="application/json"==b?a.length?JSON.parse(a):{}:a,c[d.status>=200&&d.status<300?"resolve":"reject"]({status:d.status,data:g,url:f,method:e})}};try{var g=b.headers;g&&Array.isArray(g)&&g.forEach(function(a){d.setRequestHeader(a.type,a.value)}),e==this.METHOD.GET&&d.setRequestHeader("Accept","application/json");var h=b.postType||this.POST_TYPES.JSON;b.postData&&h==this.POST_TYPES.JSON?(d.setRequestHeader("Content-Type","application/json; charset=UTF-8"),d.send(JSON.stringify(b.postData))):b.postData&&h==this.POST_TYPES.FORM_DATA?d.send(this._preparePostData(b.postData)):d.send()}catch(i){c.reject()}return c}}]),Onix.service("i18n",["Http","Promise",function(a,b){this._langs={},this._currentLang="",this.addLanguage=function(a,b){this._langs[a]=b},this.setLanguage=function(a){this._currentLang=a},this._=function(a){a=a||"";var b=this._langs[this._currentLang],c="";if(b){var d=a.split("."),e=d.length;d.every(function(a,d){return a in b?(b=b[a],d==e-1?(c=b,!1):!0):!1})}return c},this.loadLanguage=function(c,d){var e=b.defer();return a.createRequest({url:d}).then(function(a){this.addLanguage(c,a.data),e.resolve()}.bind(this),function(a){e.resolve()}),e}}]),Onix.service("Templates",["Common","Promise","Http",function(a,b,c){this._preloads=[],this._cache={},this._RE={VARIABLE:/[$_a-zA-Z][$_a-zA-Z0-9]+/g,NUMBERS:/[-]?[0-9]+[.]?([0-9e]+)?/g,STRINGS:/["'][^"']+["']/g,JSONS:/[{][^}]+[}]/g,ALL:/[-]?[0-9]+[.]?([0-9e]+)?|["'][^"']+["']|[{][^}]+[}]|[$_a-zA-Z][$_a-zA-Z0-9]+/g},this._parseFnName=function(a){return a=a||"",a.match(/[a-zA-Z0-9_]+/)[0]},this._parseArgs=function(a,b){argsValue=a?a.replace(/^[^(]+./,"").replace(/\).*$/,""):"";var c=[],d=argsValue.match(this._RE.ALL);if(d){var e=[];d.forEach(function(a){var c;if(a.match(this._RE.STRINGS))c=a.substr(1,a.length-2);else if(a.match(this._RE.NUMBERS))c=parseFloat(a);else if(a.match(this._RE.JSONS))c=JSON.parse(a);else if(a.match(this._RE.VARIABLE)){var d=a.match(this._RE.VARIABLE)[0];c="$event"==d?b.event:"$element"==d?b.el:null}e.push({value:c,pos:argsValue.indexOf(a)})},this),e.length&&e.sort(function(a,b){return a.pos-b.pos}).forEach(function(a){c.push(a.value)})}return c},this._bindEvent=function(b,c,d,e){d&&this._parseFnName(d)in e&&b.addEventListener(c,a.bindWithoutScope(function(a,b){var d=this.getAttribute("data-"+c),f=b._parseFnName(d),g=b._parseArgs(d,{el:this,event:a});e[f].apply(e,g)},this))},this.init=function(){var a=b.defer();if(Onix.element("script[type='text/template']").forEach(function(a){this.add(a.id,a.innerHTML)},this),this._preloads.length){var c=[];this._preloads.forEach(function(a){c.push(this.load(a.key,a.path))},this),b.all(c)["finally"](function(){a.resolve()})}else a.resolve();return a},this.add=function(a,b){this._cache[a]=b},this.compile=function(a,b){var c=this.get(a),d=Onix.config("TMPL_DELIMITER");return b&&Object.keys(b).forEach(function(a){c=c.replace(new RegExp(d.LEFT+"[ ]*"+a+"[ ]*"+d.RIGHT,"g"),b[a])}),c},this.get=function(a){return this._cache[a]||""},this.bindTemplate=function(a,b){var c=Onix.element("*[data-click], *[data-change], *[data-keydown], *[data-bind]",a);if(c.len()){var d={};c.forEach(function(a){this._bindEvent(a,"click",a.getAttribute("data-click"),b),this._bindEvent(a,"change",a.getAttribute("data-change"),b),this._bindEvent(a,"keydown",a.getAttribute("data-keydown"),b);var c=a.getAttribute("data-bind");c&&(d[c]=a)},this),"addEls"in b&&"function"==typeof b.addEls&&b.addEls(d)}},this.preload=function(a,b){this._preloads.push({key:a,path:b})},this.load=function(a,d){var e=b.defer();return c.createRequest({url:d}).then(function(b){this.add(a,b.data),e.resolve()}.bind(this),function(a){e.reject()}),e}}]),Onix.factory("Page",["DOM","Templates","Common",function(a,b,c){var d={_setConfig:function(a){this._config=a},_init:function(){var c=this._getConfig();this._els={};var d=a.get(Onix.config("DETAIL_SEL"));c.els&&(this._els=a.get(c.els,d)),b.bindTemplate(d,this),this._afterInit()},_getEl:function(a){return this._els[a]},_getConfig:function(){return this._config||{}},_getPageData:function(){return this._config&&this._config.js_data?this._config.js_data:{}},_afterInit:function(){},addEls:function(a){a=a||{},Object.keys(a).forEach(function(b){this._els[b]=a[b]},this)}};return{create:function(a,b){return c.create(d,a,b)}}}]),Onix.factory("Snippet",["Templates","Common",function(a,b){var c={_getConfig:function(){return this._config},_getEl:function(a){return this._els[a]},_getParent:function(){return this._parent},_create:function(a){return null},_setName:function(a){this._name=a},_setup:function(){},_activate:function(){},_deactivate:function(){},init:function(a,b){return this._config=a||{},this._parent=b,this._els={},this._name="",this._root=this._create(a),this._root},addEls:function(a){a=a||{},Object.keys(a).forEach(function(b){this._els[b]=a[b]},this)},setup:function(){a.bindTemplate(this._root,this),this._setup()},activate:function(){this._activate()},deactivate:function(){this._deactivate()},getName:function(){return this._name}};return{create:function(a,d){return b.create(c,a,d)}}}]),Onix.factory("Select",["Common","Events",function(a,b){var c=function(c){a.extend(this,b),this._CONST={CAPTION_SEL:".dropdown-toggle",OPTIONS_SEL:".dropdown-menu a",OPEN_DROPDOWN_SEL:".dropdown.open",OPEN_CLASS:"open",ACTIVE_CLASS:"active"},this._el=c,this._bind(c)};return c.prototype._bind=function(b){var c=b.querySelector(this._CONST.CAPTION_SEL),d=this._CONST;c.addEventListener("click",function(a){a.stopPropagation();var c=b.classList.contains(d.OPEN_CLASS),e=function(){Onix.element(d.OPEN_DROPDOWN_SEL).forEach(function(a){a.classList.remove("open")})};e(),c?window.removeEventListener("click"):(window.addEventListener("click",function(a){e(),window.removeEventListener("click")}),b.classList.add(d.OPEN_CLASS))}),Onix.element(this._CONST.OPTIONS_SEL,b).forEach(function(c){c.addEventListener("click",a.bindWithoutScope(function(a,c){if(a.stopPropagation(),!this.parentNode.classList.contains(d.ACTIVE_CLASS)){this.parentNode.parentNode.querySelector("."+d.ACTIVE_CLASS).classList.remove(d.ACTIVE_CLASS),this.parentNode.classList.add(d.ACTIVE_CLASS),b.classList.remove(d.OPEN_CLASS);var e=this.getAttribute("data-value")||"";c.trigger("change",e)}},this))},this)},c}]);
