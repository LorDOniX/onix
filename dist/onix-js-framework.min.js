/**
 * OnixJS framework
 * 2.2.2/27. 4. 2016
 * source: https://gitlab.com/LorDOniX/onix
 * documentation: https://gitlab.com/LorDOniX/onix/tree/master/docs
 */
if(function(){Event=Event||window.Event,Event.prototype.stopPropagation=Event.prototype.stopPropagation||function(){this.cancelBubble=!0},Event.prototype.preventDefault=Event.prototype.preventDefault||function(){this.returnValue=!1}}(),Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){for(var n=this.length,i=0;n>i;i++)i in this&&t.call(e,this[i],i,this)}),Array.prototype.every||(Array.prototype.every=function(t,e){for(var n=this.length,i=0;n>i;i++)if(i in this&&!t.call(e,this[i],i,this))return!1;return!0}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t,e){var n=this.length,i=e||0;for(0>i&&(i+=n);n>i;i++)if(i in this&&this[i]===t)return i;return-1}),!("console"in window)){var emptyFn=function(){};window.console={},["log","warn","error","clear","info"].forEach(function(t){window.console[t]=emptyFn})}if(Object.keys||(Object.keys=function(){"use strict";var t=Object.prototype.hasOwnProperty,e=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],i=n.length;return function(r){if("object"!=typeof r&&("function"!=typeof r||null===r))throw new TypeError("Object.keys called on non-object");var o,s,a=[];for(o in r)t.call(r,o)&&a.push(o);if(e)for(s=0;i>s;s++)t.call(r,n[s])&&a.push(n[s]);return a}}()),function(){if(navigator.appVersion.indexOf("MSIE 8")>0){var t=Array.prototype.slice;Array.prototype.slice=function(){if(this instanceof Array)return t.apply(this,arguments);for(var e=[],n=arguments.length>=1?arguments[0]:0,i=arguments.length>=2?arguments[1]:this.length,r=n;i>r;r++)e.push(this[r]);return e}}}(),Object.create||(Object.create=function(t){if(arguments.length>1)throw new Error("Object.create polyfill only accepts the first parameter");var e=function(){};return e.prototype=t,new e}),Function.prototype.bind||(Function.prototype.bind=function(t){var e=this,n=Array.prototype.slice.call(arguments,1);return function(){return e.apply(t,n.concat(Array.prototype.slice.call(arguments)))}}),!("addEventListener"in document)){var w=Window.prototype,h=HTMLDocument.prototype,e=Element.prototype;w.addEventListener=h.addEventListener=e.addEventListener=function(t,e){if("DOMContentLoaded"==t)document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&e()});else{var n=this;this.attachEvent("on"+t,function(){return e.apply(n,arguments)})}},w.removeEventListener=h.removeEventListener=e.removeEventListener=function(t,e){return this.detachEvent("on"+t,e)}}"classList"in document.documentElement||!window.Element||!function(){function t(t){if(this._element=t,t.className!=this._classCache&&(this._classCache=t.className,this._classCache))for(var e=this._classCache.replace(/^\s+|\s+$/g,"").split(/\s+/),n=0;n<e.length;n++)s.call(this,e[n])}function e(t,e){t.className=e.join(" ")}function n(t,e,n){Object.defineProperty?Object.defineProperty(t,e,{get:n}):t.__defineGetter__(e,n)}var i=Array.prototype,r=i.indexOf,o=i.slice,s=i.push,a=i.splice,c=i.join;window.DOMTokenList=t,t.prototype={add:function(t){this.contains(t)||(s.call(this,t),e(this._element,o.call(this,0)))},contains:function(t){return-1!=r.call(this,t)},item:function(t){return this[t]||null},remove:function(t){var n=r.call(this,t);-1!=n&&(a.call(this,n,1),e(this._element,o.call(this,0)))},toString:function(){return c.call(this," ")},toggle:function(t){return-1==r.call(this,t)?(this.add(t),!0):(this.remove(t),!1)}},n(Element.prototype,"classList",function(){return new t(this)})}(),function(){function t(t){return!!t.exifdata}function e(t,e){e=e||t.match(/^data\:([^\;]+)\;base64,/im)[1]||"",t=t.replace(/^data\:([^\;]+)\;base64,/gim,"");for(var n=atob(t),i=n.length,r=new ArrayBuffer(i),o=new Uint8Array(r),s=0;i>s;s++)o[s]=n.charCodeAt(s);return r}function i(t,e){var n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="blob",n.onload=function(t){200!=this.status&&0!==this.status||e(this.response)},n.send()}function r(t,n){function r(e){var i=o(e),r=s(e);t.exifdata=i||{},t.iptcdata=r||{},n&&n.call(t)}if(t.src)if(/^data\:/i.test(t.src)){var a=e(t.src);r(a)}else if(/^blob\:/i.test(t.src)){var c=new FileReader;c.onload=function(t){r(t.target.result)},i(t.src,function(t){c.readAsArrayBuffer(t)})}else{var h=new XMLHttpRequest;h.onload=function(){if(200!=this.status&&0!==this.status)throw"Could not load image";r(h.response),h=null},h.open("GET",t.src,!0),h.responseType="arraybuffer",h.send(null)}else if(window.FileReader&&(t instanceof window.Blob||t instanceof window.File)){var c=new FileReader;c.onload=function(t){f&&console.log("Got file of length "+t.target.result.byteLength),r(t.target.result)},c.readAsArrayBuffer(t)}}function o(t){var e=new DataView(t);if(f&&console.log("Got file of length "+t.byteLength),255!=e.getUint8(0)||216!=e.getUint8(1))return f&&console.log("Not a valid JPEG"),!1;for(var n,i=2,r=t.byteLength;r>i;){if(255!=e.getUint8(i))return f&&console.log("Not a valid marker at offset "+i+", found: "+e.getUint8(i)),!1;if(n=e.getUint8(i+1),f&&console.log(n),225==n)return f&&console.log("Found 0xFFE1 marker"),l(e,i+4,e.getUint16(i+2)-2);i+=2+e.getUint16(i+2)}}function s(t){var e=new DataView(t);if(f&&console.log("Got file of length "+t.byteLength),255!=e.getUint8(0)||216!=e.getUint8(1))return f&&console.log("Not a valid JPEG"),!1;for(var n=2,i=t.byteLength,r=function(t,e){return 56===t.getUint8(e)&&66===t.getUint8(e+1)&&73===t.getUint8(e+2)&&77===t.getUint8(e+3)&&4===t.getUint8(e+4)&&4===t.getUint8(e+5)};i>n;){if(r(e,n)){var o=e.getUint8(n+7);o%2!==0&&(o+=1),0===o&&(o=4);var s=n+8+o,c=e.getUint16(n+6+o);return a(t,s,c)}n++}}function a(t,e,n){for(var i,r,o,s,a,c=new DataView(t),h={},l=e;e+n>l;)28===c.getUint8(l)&&2===c.getUint8(l+1)&&(s=c.getUint8(l+2),s in m&&(o=c.getInt16(l+3),a=o+5,r=m[s],i=u(c,l+5,o),h.hasOwnProperty(r)?h[r]instanceof Array?h[r].push(i):h[r]=[h[r],i]:h[r]=i)),l++;return h}function c(t,e,n,i,r){var o,s,a,c=t.getUint16(n,!r),u={};for(a=0;c>a;a++)o=n+12*a+2,s=i[t.getUint16(o,!r)],!s&&f&&console.log("Unknown tag: "+t.getUint16(o,!r)),u[s]=h(t,o,e,n,r);return u}function h(t,e,n,i,r){var o,s,a,c,h,l,f=t.getUint16(e+2,!r),p=t.getUint32(e+4,!r),d=t.getUint32(e+8,!r)+n;switch(f){case 1:case 7:if(1==p)return t.getUint8(e+8,!r);for(o=p>4?d:e+8,s=[],c=0;p>c;c++)s[c]=t.getUint8(o+c);return s;case 2:return o=p>4?d:e+8,u(t,o,p-1);case 3:if(1==p)return t.getUint16(e+8,!r);for(o=p>2?d:e+8,s=[],c=0;p>c;c++)s[c]=t.getUint16(o+2*c,!r);return s;case 4:if(1==p)return t.getUint32(e+8,!r);for(s=[],c=0;p>c;c++)s[c]=t.getUint32(d+4*c,!r);return s;case 5:if(1==p)return h=t.getUint32(d,!r),l=t.getUint32(d+4,!r),a=new Number(h/l),a.numerator=h,a.denominator=l,a;for(s=[],c=0;p>c;c++)h=t.getUint32(d+8*c,!r),l=t.getUint32(d+4+8*c,!r),s[c]=new Number(h/l),s[c].numerator=h,s[c].denominator=l;return s;case 9:if(1==p)return t.getInt32(e+8,!r);for(s=[],c=0;p>c;c++)s[c]=t.getInt32(d+4*c,!r);return s;case 10:if(1==p)return t.getInt32(d,!r)/t.getInt32(d+4,!r);for(s=[],c=0;p>c;c++)s[c]=t.getInt32(d+8*c,!r)/t.getInt32(d+4+8*c,!r);return s}}function u(t,e,i){var r="";for(n=e;n<e+i;n++)r+=String.fromCharCode(t.getUint8(n));return r}function l(t,e){if("Exif"!=u(t,e,4))return f&&console.log("Not valid EXIF data! "+u(t,e,4)),!1;var n,i,r,o,s,a=e+6;if(18761==t.getUint16(a))n=!1;else{if(19789!=t.getUint16(a))return f&&console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),!1;n=!0}if(42!=t.getUint16(a+2,!n))return f&&console.log("Not valid TIFF data! (no 0x002A)"),!1;var h=t.getUint32(a+4,!n);if(8>h)return f&&console.log("Not valid TIFF data! (First offset less than 8)",t.getUint32(a+4,!n)),!1;if(i=c(t,a,a+h,_,n),i.ExifIFDPointer){o=c(t,a,a+i.ExifIFDPointer,g,n);for(r in o){switch(r){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":o[r]=v[r][o[r]];break;case"ExifVersion":case"FlashpixVersion":o[r]=String.fromCharCode(o[r][0],o[r][1],o[r][2],o[r][3]);break;case"ComponentsConfiguration":o[r]=v.Components[o[r][0]]+v.Components[o[r][1]]+v.Components[o[r][2]]+v.Components[o[r][3]]}i[r]=o[r]}}if(i.GPSInfoIFDPointer){s=c(t,a,a+i.GPSInfoIFDPointer,y,n);for(r in s){switch(r){case"GPSVersionID":s[r]=s[r][0]+"."+s[r][1]+"."+s[r][2]+"."+s[r][3]}i[r]=s[r]}}return i}var f=!1,p=this,d=function(t){return t instanceof d?t:this instanceof d?void(this.EXIFwrapped=t):new d(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=d),exports.EXIF=d):p.EXIF=d;var g=d.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},_=d.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},y=d.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},v=d.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}},m={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};d.getData=function(e,n){return(e instanceof Image||e instanceof HTMLImageElement)&&!e.complete?!1:(t(e)?n&&n.call(e):r(e,n),!0)},d.getTag=function(e,n){return t(e)?e.exifdata[n]:void 0},d.getAllTags=function(e){if(!t(e))return{};var n,i=e.exifdata,r={};for(n in i)i.hasOwnProperty(n)&&(r[n]=i[n]);return r},d.pretty=function(e){if(!t(e))return"";var n,i=e.exifdata,r="";for(n in i)i.hasOwnProperty(n)&&(r+="object"==typeof i[n]?i[n]instanceof Number?n+" : "+i[n]+" ["+i[n].numerator+"/"+i[n].denominator+"]\r\n":n+" : ["+i[n].length+" values]\r\n":n+" : "+i[n]+"\r\n");return r},d.readFromBinaryFile=function(t){return o(t)},"function"==typeof define&&define.amd&&define("exif-js",[],function(){return d})}.call(this),onix=function(){var t=function(){this._objects={},this._runs=[],this._configs=[],this._CONST={PROVIDER_NAME:"Provider",TYPE:{PROVIDER:1,SERVICE:2,FACTORY:3,CONSTANT:4,VALUE:5,CONFIG:6,RUN:7}},document.addEventListener("DOMContentLoaded",this._domLoad.bind(this))};return t.prototype._parseParam=function(t){var e,n=[];return Array.isArray(t)?t.every(function(t){return"function"==typeof t?(e=t,!1):("string"==typeof t&&n.push(t),!0)},this):e=t,{fn:e,inject:n}},t.prototype._domLoad=function(){this._configs.forEach(function(t){this._run(t,!0)},this),this._runs.forEach(function(t){this._run(t)},this)},t.prototype._run=function(t,e){var n=[];if(t.provider){var i=this._objects[t.provider];if(!i.cache){var r=i.fn||this.noop;i.cache=new r}var o=i.cache.$get||this.noop,s=this._parseParam(o);t.fn=s.fn,t.inject=s.inject,delete t.provider}if(t.inject&&t.inject.length&&t.inject.forEach(function(t){var i=this._objects[t];n.push(this._run(i,e))},this),e)switch(t.type){case this._CONST.TYPE.PROVIDER:if(!t.cache){var a=t.fn||this.noop;t.cache=new a}return t.cache;case this._CONST.TYPE.CONSTANT:return t.cache;case this._CONST.TYPE.CONFIG:var a=t.fn||this.noop;t.cache=a.apply(a,n);break;default:return null}else switch(t.type){case this._CONST.TYPE.FACTORY:if(!t.cache){var a=t.fn||this.noop;t.cache=a.apply(a,n)}return t.cache;case this._CONST.TYPE.SERVICE:if(!t.cache){var a=t.fn||this.noop,c=Object.create(a.prototype);a.apply(c,n),t.cache=c}return t.cache;case this._CONST.TYPE.VALUE:return t.cache;case this._CONST.TYPE.CONSTANT:return t.cache;case this._CONST.TYPE.RUN:var a=t.fn||this.noop;t.cache=a.apply(a,n);break;default:return null}},t.prototype.provider=function(t,e){var n=this._parseParam(e);this._objects[t+this._CONST.PROVIDER_NAME]={name:t+this._CONST.PROVIDER_NAME,inject:n.inject,fn:n.fn,cache:null,type:this._CONST.TYPE.PROVIDER},this._objects[t]={name:t,inject:null,fn:null,cache:null,provider:t+this._CONST.PROVIDER_NAME,type:this._CONST.TYPE.FACTORY}},t.prototype.service=function(t,e){var n=this._parseParam(e);this._objects[t]={name:t,inject:n.inject,fn:n.fn,cache:null,type:this._CONST.TYPE.SERVICE}},t.prototype.factory=function(t,e){var n=this._parseParam(e);this._objects[t]={name:t,inject:n.inject,fn:n.fn,cache:null,type:this._CONST.TYPE.FACTORY}},t.prototype.constant=function(t,e){this._objects[t]={name:t,cache:e,type:this._CONST.TYPE.CONSTANT}},t.prototype.value=function(t,e){this._objects[t]={name:t,cache:e,type:this._CONST.TYPE.VALUE}},t.prototype.config=function(t){var e=this._parseParam(t);this._configs.push({fn:e.fn,inject:e.inject,type:this._CONST.TYPE.CONFIG})},t.prototype.run=function(t){var e=this._parseParam(t);this._runs.push({fn:e.fn,inject:e.inject,type:this._CONST.TYPE.RUN})},t.prototype.noop=function(){},t.prototype.info=function(){console.log("OnixJS framework\n2.2.2/27. 4. 2016\nsource: https://gitlab.com/LorDOniX/onix\ndocumentation: https://gitlab.com/LorDOniX/onix/tree/master/docs")},new t}(),onix.service("$localStorage",function(){this._disable=!("localStorage"in window),this.set=function(t,e){!this._disable&&t&&localStorage.setItem(t,e)},this.get=function(t){return this._disable||!t?null:localStorage.getItem(t)},this.remove=function(t){return this._disable||!t?null:localStorage.removeItem(t)}}),onix.factory("$q",function(){var t=function(){this._E_STATES={IDLE:0,RESOLVED:1,REJECTED:2},this._state=this._E_STATES.IDLE,this._funcs=[],this._finishData=null};return t.prototype._resolveFuncs=function(t){this._funcs.forEach(function(e){(e["finally"]||e.isError&&t||!e.isError&&!t)&&e.fn(this._finishData)},this),this._funcs.length=0,this._state=t?this._E_STATES.REJECTED:this._E_STATES.RESOLVED},t.prototype._isAlreadyFinished=function(){this._state!=this._E_STATES.IDLE&&this._resolveFuncs(this._state==this._E_STATES.REJECTED)},t.prototype.resolve=function(t){this._finishData=t,this._resolveFuncs(!1)},t.prototype.reject=function(t){this._finishData=t,this._resolveFuncs(!0)},t.prototype.then=function(t,e){return t&&"function"==typeof t&&this._funcs.push({fn:t,isError:!1}),e&&"function"==typeof e&&this._funcs.push({fn:e,isError:!0}),this._isAlreadyFinished(),this},t.prototype.done=function(t){return this._funcs.push({fn:t,isError:!1}),this._isAlreadyFinished(),this},t.prototype.error=function(t){return this._funcs.push({fn:t,isError:!0}),this._isAlreadyFinished(),this},t.prototype["finally"]=function(t){return this._funcs.push({fn:t,"finally":!0}),this._isAlreadyFinished(),this},{all:function(e){var n=new t;if(Array.isArray(e)){var i=e.length,r=function(){i--,0==i&&n.resolve()};e.forEach(function(t){t["finally"](r)})}else n.resolve();return n},defer:function(){return new t},isPromise:function(e){return e instanceof t}}}),onix.factory("$job",["$q",function(t){var e=function(){this._donePromise=t.defer(),this._tasks=[],this._taskDone={cb:null,scope:null}};return e.prototype.add=function(t,e,n){n=n||[],Array.isArray(n)||(n=[n]),this._tasks.push({task:t,scope:e,args:n})},e.prototype.start=function(){return this._tasks.length?(this._tasks.reverse(),this._doJob(),this._donePromise):void 0},e.prototype.clear=function(){this._tasks=[]},e.prototype.setTaskDone=function(t,e){this._taskDone.cb=t,this._taskDone.scope=e},e.prototype._doJob=function(){var t=this._tasks.length;if(0==t)this._donePromise.resolve();else{var e=this._tasks.pop(),n=function(){if(this._taskDone.cb){var t=Array.prototype.slice.call(arguments,0);this._taskDone.cb.apply(this._taskDone.scope||this._taskDone.cb,t)}this._doJob()}.bind(this);e.task.apply(e.scope||e.task,e.args.concat(n))}},{create:function(){return new e}}}]),onix.factory("$myQuery",function(){var t=function(t,e){return this._els=[],e=e||document,"string"==typeof t?this._els=e.querySelectorAll(t):Array.isArray(t)?this._els=t:this._els.push(t),this};return t.prototype._operation=function(t,e){Array.isArray(this._els)||(this._els=Array.prototype.slice.call(this._els)),this._els.forEach(function(n,i){t.apply(e||t,[n,i])})},t.prototype._setGetAll=function(t,e){if(t)return this._operation(function(n){n[e]=t}),this;var n=[];return this._operation(function(t){n.push(t[e])}),n.length?1==n.length?n[0]:n:null},t.prototype.getEl=function(t){return t=t||0,t>this._els.length?null:this._els[t]},t.prototype.attr=function(t,e){if(e)return this._operation(function(n){n.setAttribute(t,e)}),this;var n=[];return this._operation(function(e){n.push(e.getAttribute(t))}),n.length?1==n.length?n[0]:n:null},t.prototype.src=function(t){return this._setGetAll(t,"src")},t.prototype.hide=function(){return this._operation(function(t){t.style.display="none"}),this},t.prototype.show=function(t){return this._operation(function(e){e.style.display=t||""}),this},t.prototype.val=function(t){return this._setGetAll(t,"value")},t.prototype.html=function(t){return this._setGetAll(t,"innerHTML")},t.prototype.append=function(t){return this._operation(function(e){e.appendChild(t)}),this},t.prototype.addClass=function(t){return this._operation(function(e){e.classList.add(t)}),this},t.prototype.removeClass=function(t){return this._operation(function(e){e.classList.remove(t)}),this},t.prototype.toggleClass=function(t){return this._operation(function(e){e.classList.toggle(t)}),this},t.prototype.width=function(){var t=0;return this._operation(function(e){t+=e.offsetWidth}),t},t.prototype.height=function(){var t=0;return this._operation(function(e){t+=e.offsetHeight}),t},t.prototype.click=function(t,e){return this._operation(function(n){n.addEventListener("click",function(i){t.apply(e||t,[i,n])})}),this},t.prototype.change=function(t,e){return this._operation(function(n){n.addEventListener("change",function(i){t.apply(e||t,[i,n])})}),this},t.prototype.forEach=function(t,e){return this._operation(function(n,i){t.apply(e||t,[n,i])}),this},t.prototype.remove=function(){return this._operation(function(t){t.parentNode.removeChild(t)}),this},t.prototype.prepend=function(t){return this._operation(function(e){e.parentNode.insertBefore(t,e)}),this},t.prototype.empty=function(){return this._operation(function(t){for(;t.firstChild;)t.removeChild(t.firstChild)}),this},t.prototype.len=function(){return this._els.length},onix.element=function(e,n){return new t(e,n)},{get:function(e,n){return new t(e,n)}}}),onix.run(["$myQuery",function(t){}]),onix.service("$dom",function(){this.create=function(t,e){var n=document.createElement(t.el);return Object.keys(t).forEach(function(i){switch(i){case"el":break;case"attrs":Object.keys(t.attrs).forEach(function(e){n.setAttribute(e,t.attrs[e])});break;case"events":t.events.forEach(function(t){n.addEventListener(t.event,t.fn)});break;case"child":t.child.forEach(function(t){n.appendChild(this.create(t,e))},this);break;case"_exported":e[t._exported]=n;break;case"class":var r=t["class"];"string"==typeof r?n.classList.add(r):Array.isArray(r)&&r.forEach(function(t){n.classList.add(t)});break;default:n[i]=t[i]}},this),n},this.get=function(t,e){var n;return e=e||document,"string"==typeof t&&t?n=e.querySelector(t):Array.isArray(t)&&(n={},t.forEach(function(t){if("string"==typeof t){var i=t.replace(/^[.# ]+/g,"");n[i]=e.querySelector(t)}else{var i=t.sel.replace(/^[.# ]+/g,"");n[t.name||i]=e.querySelector(t.sel)}})),n}}),onix.service("$location",function(){this.refresh=function(){window.location.reload()},this.createSearchURL=function(t){var e=[];if(t){var e=[];Object.keys(t).forEach(function(n){e.push(n+"="+encodeURIComponent(t[n]))})}return e.length?"?"+e.join("&"):""},this.search=function(t){if(!t){var e=location.search,n={};return e&&(e=e.replace("?",""),e.split("&").forEach(function(t){var e=t.split("=");n[e[0]]=decodeURIComponent(e[1])})),n}var i=this.createSearchURL(t);i&&(window.location.search=i)},this.get=function(){return window.location.pathname}}),onix.service("$common",["$q",function(t){this._objCopy=function(t,e){Object.keys(e).forEach(function(n){if(e.hasOwnProperty(n)){var i=e[n],r=typeof i;if(Array.isArray(i)){var o=[];i.forEach(function(t){o.push(t)}),t[n]=o}else i&&"object"===r?(n in t||(t[n]={}),this._objCopy(t[n],i)):t[n]=i}}.bind(this))},this.getCookie=function(t){var e=null;if(document.cookie&&""!=document.cookie){var n=document.cookie.split(";");n.every(function(n){return n=n.trim(),n.substring(0,t.length+1)==t+"="?(e=decodeURIComponent(n.substring(t.length+1)),!1):!0})}return e},this.confirm=function(e){var n=t.defer();return confirm(e)?n.resolve():n.reject(),n},this.create=function(t,e,n){var i=[];return e&&n&&Array.isArray(e)&&e.forEach(function(t){i.push(onix.getObject(t))}),i.push(t),i.push(n||e),this.merge.apply(this,i)},this.merge=function(){var t=arguments.length,e={};if(t>0)for(var n=0;t>n;n++){var i=arguments[n];this._objCopy(e,i)}return e},this.extend=function(t,e){t=t||{},e=e||{},this._objCopy(t,e)},this.bindWithoutScope=function(t){var e=Array.prototype.slice.call(arguments,1);return function(){var n=Array.prototype.slice.call(arguments,0),i=Array.prototype.concat(n,e);return t.apply(this,i)}},this.nodesForEach=function(t,e,n){e=e||function(){},t&&Array.prototype.slice.call(t).forEach(function(t,i){e.apply(n||e,[t,i])})},this.reverseForEach=function(t,e,n){t=t||[],e=e||function(){};for(var i=t.length-1;i>=0;i--)e.apply(n||this,[t[i],i])},this.hxToDe=function(t){switch(t=t.toLowerCase()){case"a":return 10;case"b":return 11;case"c":return 12;case"d":return 13;case"e":return 14;case"f":return 15;default:return parseInt(t,10)}},this.hexToRGB=function(t){return"#"==t[0]?(t=t.replace("#",""),3==t.length?{r:16*this.hxToDe(t[0])+this.hxToDe(t[0]),g:16*this.hxToDe(t[1])+this.hxToDe(t[1]),b:16*this.hxToDe(t[2])+this.hxToDe(t[2])}:{r:16*this.hxToDe(t[0])+this.hxToDe(t[1]),g:16*this.hxToDe(t[2])+this.hxToDe(t[3]),b:16*this.hxToDe(t[4])+this.hxToDe(t[5])}):t},this.isElement=function(t){return t instanceof HTMLElement},this.isObject=function(t){return"object"==typeof t&&!Array.isArray(t)&&null!==t},this.col=function(){var t=Array.prototype.slice.call(arguments),e="",n={};t.forEach(function(t,i){0==i?e=t:n["[{]"+(i-1)+"[}]"]=t}),Object.keys(n).forEach(function(t){e=e.replace(new RegExp(t,"g"),n[t])}),e&&console.log(e)},this.humanLength=function(t){t=t||0;var e=t/1024,n=t/1048576;return 1024>e?e.toFixed(2)+" KB":n.toFixed(2)+" MB"},this.chainPromises=function(e){var n=t.defer();return this._chainPromisesInner(e,n,[]),n},this._chainPromisesInner=function(t,e,n){var i=t.shift();if(i){var r,o=!1;switch(typeof i.method){case"string":i.scope&&i.method in i.scope?(r=i.scope[i.method],"function"!=typeof r&&(o=!0)):o=!0;break;case"function":r=i.method;break;default:o=!0}o?e.resolve(n):r.apply(i.scope||r,i.args||[]).then(function(i){n.push(i),this._chainPromisesInner(t,e,n)}.bind(this),function(i){n.push(i),this._chainPromisesInner(t,e,n)}.bind(this))}else e.resolve(n)}}]),onix.service("$notify",["$common","$q",function(t,e){var n=function(t){return this._el=t,this._HIDE_TIMEOUT=1500,this._options={ok:"alert-success",error:"alert-danger",info:"alert-info",warn:"alert-warning"},this};n.prototype._setValue=function(e){t.isElement(e)?onix.element(this._el).empty().append(e):"string"==typeof e&&(this._el.innerHTML=e)},n.prototype.reset=function(){return Object.keys(this._options).forEach(function(t){this._el.classList.remove(this._options[t])}.bind(this)),this},n.prototype.ok=function(t){return this._el.classList.add(this._options.ok),this._setValue(t),this},n.prototype.error=function(t){return this._el.classList.add(this._options.error),this._setValue(t),this},n.prototype.info=function(t){return this._el.classList.add(this._options.info),this._setValue(t),this},n.prototype.warn=function(t){return this._el.classList.add(this._options.warn),this._setValue(t),this},n.prototype.hide=function(){var t=e.defer();return setTimeout(function(){this.reset(),t.resolve()}.bind(this),this._HIDE_TIMEOUT),t},this.get=function(t){return new n(t)}}]),onix.factory("$event",["$common",function(t){return{_allEvents:[],_getEvents:function(t){var e=[];return this._allEvents.forEach(function(n,i){t==n.name&&e.push({item:n,pos:i})}),e},on:function(t,e,n){this._allEvents.push({name:t,fn:e,scope:n})},off:function(e,n){var i=this._getEvents(e);t.reverseForEach(i,function(t){(!n||n&&t.fn==n)&&this._allEvents.splice(t.pos,1)},this)},once:function(t,e,n){this._allEvents.push({name:t,fn:e,scope:n,once:!0})},trigger:function(e){var n=this._getEvents(e),i=arguments,r=[];n.forEach(function(t){var e=Array.prototype.slice.call(i,0);e.shift();var n=t.item;n.fn.apply(n.scope||this,e),n.once&&r.push(t.pos)},this),t.reverseForEach(r,function(t){this._allEvents.splice(t,1)},this)}}}]),onix.factory("$loader",["$dom",function(t){var e={_create:function(){this._el=t.create({el:"div","class":"loader"}),document.body.insertBefore(this._el,document.body.firstChild)},_init:function(){this._create()},start:function(){this._el.classList.add("start")},end:function(){this._el.classList.remove("start"),this._el.classList.add("end"),setTimeout(function(){this._el.classList.remove("end"),this._el.classList.add("hide"),setTimeout(function(){this._el.classList.remove("hide")}.bind(this),350)}.bind(this),150)}};return e._init(),e}]),onix.service("$http",["$q","$common",function(t,e){this._preparePostData=function(t){var e=new FormData;return t&&(Array.isArray(t)?t.forEach(function(t){e.append(t.name,t.value)}):Object.keys(t).forEach(function(n){e.append(n,t[n])})),e},this._updateURL=function(t,e){if(e){var n=[];Array.isArray(e)&&(e.forEach(function(t){n.push(t.name+"="+encodeURIComponent(t.value))}),t+=(-1==t.indexOf("?")?"?":"")+n.join("&"))}return t},this.POST_TYPES={JSON:1,FORM_DATA:2},this.METHOD={POST:"POST",GET:"GET",DELETE:"DELETE",PATCH:"PATCH"},this.createRequest=function(n){var i=t.defer(),r=new XMLHttpRequest;n=n||{};var o=n.method||this.METHOD.GET,s=n.url||"";if(!s)return i.reject(),i;s=this._updateURL(s,n.getData),r.onerror=function(){i.reject()},r.open(o,s,!0),r.onreadystatechange=function(){if(4==r.readyState){var t=r.responseText||"",e=r.getResponseHeader("Content-Type"),n=null;n="application/json"==e?t.length?JSON.parse(t):{}:t,i[r.status>=200&&r.status<300?"resolve":"reject"]({status:r.status,data:n,url:s,method:o})}};try{var a=n.headers;e.isObject(a)&&Object.keys(a).forEach(function(t){r.setRequestHeader(t,a[t])}),o==this.METHOD.GET&&r.setRequestHeader("Accept","application/json");var c=n.postType||this.POST_TYPES.JSON;n.postData&&c==this.POST_TYPES.JSON?(r.setRequestHeader("Content-Type","application/json; charset=UTF-8"),r.send(JSON.stringify(n.postData))):n.postData&&c==this.POST_TYPES.FORM_DATA?r.send(this._preparePostData(n.postData)):r.send()}catch(h){i.reject()}return i}}]),onix.factory("$i18n",["$http","$q",function(t,e){var n={_langs:{},_currentLang:"",addLanguage:function(t,e){this._langs[t]=e},setLanguage:function(t){this._currentLang=t},_:function(t,e){t=t||"";var n=this._langs[this._currentLang],i="";if(n){var r=t.split("."),o=r.length;r.every(function(t,e){return t in n?(n=n[t],e==o-1?(i=n,!1):!0):!1})}return this._transReplace(i,e)},_transReplace:function(t,e){
t=t||"",e=e||{};var n=t.match(/{[^}]+,.*}|{[^}]*}/g);if(n){var i={};n.forEach(function(t){var n=t;n.length>2&&(n=n.substr(1,n.length-2));var r=n.split(","),o=r[0].trim(),s={};if(2==r.length){var a=r[1].match(/[a-zA-Z0-9_]+{[^}]*}/g);a&&a.forEach(function(t){var e=t.split("{"),n=e[1];n=n.substr(0,n.length-1),s[e[0].trim()]=n})}var c=o in e?e[o]:"";if("number"==typeof c&&Object.keys(s).length){var h;switch(c){case 1:h="one";break;case 2:case 3:case 4:h="few";break;default:h="other"}c=h in s?s[h]:""}i[t]=c}),Object.keys(i).forEach(function(e){t=t.replace(new RegExp(e,"g"),i[e])})}return t},loadLanguage:function(n,i){var r=e.defer();return t.createRequest({url:i}).then(function(t){this.addLanguage(n,t.data),r.resolve()}.bind(this),function(t){r.resolve()}),r}};return window._=n._.bind(n),n}]),onix.provider("$template",function(){var t={left:"{{",right:"}}"};this.setConfig=function(e){Object.keys(e).forEach(function(n){t[n]=e[n]})},this.$get=["$common","$q","$http",function(e,n,i){var r={_cache:{},_RE:{VARIABLE:/[$_a-zA-Z][$_a-zA-Z0-9]+/g,NUMBERS:/[-]?[0-9]+[.]?([0-9e]+)?/g,STRINGS:/["'][^"']+["']/g,JSONS:/[{][^}]+[}]/g,ALL:/[-]?[0-9]+[.]?([0-9e]+)?|["'][^"']+["']|[{][^}]+[}]|[$_a-zA-Z][$_a-zA-Z0-9]+/g},_parseFnName:function(t){return t=t||"",t.match(/[a-zA-Z0-9_]+/)[0]},_parseArgs:function(t,e){argsValue=t?t.replace(/^[^(]+./,"").replace(/\).*$/,""):"";var n=[],i=argsValue.match(this._RE.ALL);if(i){var r=[];i.forEach(function(t){var n;if(t.match(this._RE.STRINGS))n=t.substr(1,t.length-2);else if(t.match(this._RE.NUMBERS))n=parseFloat(t);else if(t.match(this._RE.JSONS))n=JSON.parse(t);else if(t.match(this._RE.VARIABLE)){var i=t.match(this._RE.VARIABLE)[0];n="$event"==i?e.event:"$element"==i?e.el:null}r.push({value:n,pos:argsValue.indexOf(t)})},this),r.length&&r.sort(function(t,e){return t.pos-e.pos}).forEach(function(t){n.push(t.value)})}return n},_bindEvent:function(t,n,i,r){i&&this._parseFnName(i)in r&&t.addEventListener(n,e.bindWithoutScope(function(t,e){var i=this.getAttribute("data-"+n),o=e._parseFnName(i),s=e._parseArgs(i,{el:this,event:t});r[o].apply(r,s)},this))},_init:function(){onix.element("script[type='text/template']").forEach(function(t){this.add(t.id,t.innerHTML)},this)},add:function(t,e){this._cache[t]=e},compile:function(e,n){var i=this.get(e);return n&&Object.keys(n).forEach(function(e){i=i.replace(new RegExp(t.left+"[ ]*"+e+"[ ]*"+t.right,"g"),n[e])}),i},get:function(t){return this._cache[t]||""},bindTemplate:function(t,e){var n=onix.element("*[data-click], *[data-change], *[data-bind], *[data-keydown]",t);if(n.len()){var i={};n.forEach(function(t){this._bindEvent(t,"click",t.getAttribute("data-click"),e),this._bindEvent(t,"change",t.getAttribute("data-change"),e),this._bindEvent(t,"keydown",t.getAttribute("data-keydown"),e);var n=t.getAttribute("data-bind");n&&(i[n]=t)},this),"addEls"in e&&"function"==typeof e.addEls&&e.addEls(i)}},load:function(t,e){var r=n.defer();return i.createRequest({url:e}).then(function(e){this.add(t,e.data),r.resolve()}.bind(this),function(t){r.reject()}),r}};return r._init(),r}]}),onix.service("$route",["$location","$template",function(t,e){this._routes=[],this._otherwise=null,this.when=function(t,e){return this._routes.push({url:t,config:e}),this},this.otherwise=function(t){return this._otherwise={config:t},this},this._runController=function(t,e){if("string"==typeof t){var n=onix.getObject(t);onix.bindDI(n,e)()}else Array.isArray(t)?onix.bindDI(t,e)():"function"==typeof t&&t.apply(t,[e])},this.go=function(){var n=t.get(),i=!1,r=null;if(this._routes.every(function(t){return n.match(new RegExp(t.url))?(r=t.config,i=!0,!1):!0}),!i&&this._otherwise&&(r=this._otherwise.config),r){var o=null,s=null,a={};Object.keys(r).forEach(function(t){var e=r[t];switch(t){case"templateUrl":o=e;break;case"controller":s=e;break;default:a[t]=e}}),o?e.load(r.templateUrl,r.templateUrl).done(function(){s&&this._runController(s,a)}.bind(this)):s&&this._runController(s,a)}}}]),onix.factory("$select",["$common","$event","$dom",function(t,e,n){var i=function(n,i){t.extend(this,e),this._opts={addCaption:!1};for(var r in i)this._opts[r]=i[r];this._const={CAPTION_SEL:".dropdown-toggle",OPTIONS_SEL:".dropdown-menu a",CARET_SEL:".caret",OPEN_DROPDOWN_SEL:".dropdown.open",OPEN_CLASS:"open",ACTIVE_CLASS:"active"},this._el=n,this._optinsRef=[],this._captionEl=null,this.captionTextEl=null,this._binds={captionClick:t.bindWithoutScope(this._captionClick,this),choiceClick:t.bindWithoutScope(this._choiceClick,this)},this._bind()};return i.prototype._bind=function(){this._bindCaption(),this._bindChoices()},i.prototype._bindCaption=function(){var t=this._el.querySelector(this._const.CAPTION_SEL);if(t&&(t.addEventListener("click",this._binds.captionClick),this._opts.addCaption)){var e=t.querySelector(this._const.CARET_SEL);if(e){var i=n.create({el:"span","class":"add-caption"});t.insertBefore(i,e),this._captionTextEl=i}}this._captionEl=t},i.prototype._captionClick=function(t,e){var n=e._const;t.stopPropagation();var i=e._el.classList.contains(n.OPEN_CLASS),r=function(){onix.element(n.OPEN_DROPDOWN_SEL).forEach(function(t){t.classList.remove("open")})},o=function(){r(),window.removeEventListener("click",o)};r(),i?window.removeEventListener("click",o):(window.addEventListener("click",o),e._el.classList.add(n.OPEN_CLASS))},i.prototype._bindChoices=function(){onix.element(this._const.OPTIONS_SEL,this._el).forEach(function(t){t.addEventListener("click",this._binds.choiceClick),this._optinsRef.push({el:t,event:"click",fn:this._binds.choiceClick})},this)},i.prototype._choiceClick=function(t,e){var n=e._const;if(t.stopPropagation(),!this.parentNode.classList.contains(n.ACTIVE_CLASS)){var i=this.parentNode.parentNode.querySelector("."+n.ACTIVE_CLASS);i&&i.classList.remove(n.ACTIVE_CLASS),this.parentNode.classList.add(n.ACTIVE_CLASS),e._el.classList.remove(n.OPEN_CLASS),e._opts.addCaption&&e._captionTextEl&&(e._captionTextEl.innerHTML=this.innerHTML);var r=this.getAttribute("data-value")||"";e.trigger("change",r)}},i.prototype.unbindChoices=function(){this._optinsRef.length&&(this._optinsRef.forEach(function(t){t.el.removeEventListener(t.event,t.fn)}),this._optinsRef=[])},i.prototype.rebindChoices=function(){this.unbindChoices(),this._bindChoices()},i.prototype.selectOption=function(t){"undefined"==typeof t&&(t=0);var e=this._optinsRef.length;if(e>0&&t>=0&&e>t){var n=this._optinsRef[t].el,i=this._optinsRef[t].el.parentNode;if(!i.classList.contains(this._const.ACTIVE_CLASS)){i.classList.add(this._const.ACTIVE_CLASS),this._opts.addCaption&&this._captionTextEl&&(this._captionTextEl.innerHTML=n.innerHTML);var r=n.getAttribute("data-value")||"";this.trigger("change",r)}}},i.prototype.setAddCaption=function(){this._opts.addCaption&&this._optinsRef.every(function(t){var e=t.el.parentNode;return e.classList.contains(this._const.ACTIVE_CLASS)?(this._captionTextEl.innerHTML=t.el.innerHTML,!1):!0},this)},i}]),onix.service("$uploadImages",["$job","$q","$dom",function(t,e,n){this._disable=!("FileReader"in window),this._const={previewMaxSize:180},this._doJobs=function(n,i,r,o){for(var s=n.length,a=[],c=0;s>c;c++){var h=c%r;a[h]||(a[h]=t.create(),o&&a[h].setTaskDone(o.cb,o.scope)),a[h].add(i,this,n[c])}var u=[];return a.forEach(function(t){u.push(t.start())}),e.all(u)},this._isPicture=function(t){return t?"image/jpeg"==t.type||"image/pjpeg"==t.type||"image/png"==t.type:!1},this._readFile=function(t,e){var n=t.file,i=t.previewID,t={file:n,exif:null,img:null},r=this._createPreview(n);i in this._dom?this._dom[i].appendChild(r.cont):this._dom.previewItems.appendChild(r.cont);var o=new FileReader;o.onload=function(i){var s=o.result,a=new Uint8Array(s),c=null;"png"!=n.type&&(c=EXIF.readFromBinaryFile(s));var h=new Image;h.onload=function(){var n=this._getImageDim(h),i=this._processInputImage(h,n,c.Orientation);r.cont.classList.remove("preview-loading"),r.canvasCover.innerHTML="",r.canvasCover.appendChild(i),t.exif=c,t.img=h,e()}.bind(this),h.src=this._fileToBase64(n.type,a)}.bind(this),o.readAsArrayBuffer(n)},this._createPreview=function(t){var e={},i=n.create({el:"span","class":["preview-item","preview-loading"],child:[{el:"span","class":"canvas-cover",child:[{el:"img","class":"preview-loader",src:"/static/img/loading.gif"}],_exported:"canvasCover"},{el:"span","class":"title",innerHTML:t.name.replace(/\..*/g,"")}]},e);return{cont:i,canvasCover:e.canvasCover}},this._getImageDim=function(t){var e=this._const.previewMaxSize,n=t.width>e,i=t.height>e,r={width:t.width,height:t.height,scale:1,large:!1};if(n||i){var o=t.width,s=t.height;t.width>t.height?(s=e*s/o,o=e):(o=e*o/s,s=e),r.scale=t.width/o,r.width=o,r.height=s,r.large=!0}return r},this._processInputImage=function(t,e,n){var i=document.createElement("canvas"),r=i.getContext("2d"),o=!0;if(i.width=e.width,i.height=e.height,n)switch(n){case 2:r.translate(e.width,0),r.scale(-1,1);break;case 3:r.translate(e.width,e.height),r.rotate(Math.PI);break;case 4:r.translate(0,e.height),r.scale(1,-1);break;case 5:i.width=e.height,i.height=e.width,r.rotate(.5*Math.PI),r.scale(1,-1),e.large&&(r.clearRect(0,0,i.width,i.height),r.drawImage(t,0,0,t.width,t.height,0,0,i.height,i.width),o=!1);break;case 6:i.width=e.height,i.height=e.width,r.rotate(.5*Math.PI),r.translate(0,-e.height),e.large&&(r.clearRect(0,0,i.width,i.height),r.drawImage(t,0,0,t.width,t.height,0,0,i.height,i.width),o=!1);break;case 7:i.width=e.height,i.height=e.width,r.rotate(.5*Math.PI),r.translate(e.width,-e.height),r.scale(-1,1),e.large&&(r.clearRect(0,0,i.width,i.height),r.drawImage(t,0,0,t.width,t.height,0,0,i.height,i.width),o=!1);break;case 8:i.width=e.height,i.height=e.width,r.rotate(-.5*Math.PI),r.translate(-e.width,0),e.large&&(r.clearRect(0,0,i.width,i.height),r.drawImage(t,0,0,t.width,t.height,0,0,i.height,i.width),o=!1)}return o&&(r.clearRect(0,0,i.width,i.height),e.large?r.drawImage(t,0,0,t.width,t.height,0,0,i.width,i.height):r.drawImage(t,0,0)),i},this._fileToBase64=function(t,e){for(var n=e.length,i="",r=0;n>r;r+=1)i+=String.fromCharCode(e[r]);return"data:"+t+";base64,"+btoa(i)},this._createPreviewHolders=function(t,e){if(t&&(4==e||7==e)){var i={};7==e&&t.appendChild(n.create({el:"div",child:[{el:"span",_exported:"img_06"}]},i));for(var r=[],o=7==e?6:4,s=0;o>s;s++)r.push({el:"span",_exported:"img_0"+s});t.appendChild(n.create({el:"div",child:r},i));for(var s=0;e>s;s++)this._dom["img_0"+s]=i["img_0"+s]}},this.show=function(t,e){if(!this._disable&&t&&e){t.innerHTML="",this._dom={previewItems:t};var n=this.getPictureFiles(e),i=n.length;i&&(this._createPreviewHolders(t,i),n=n.sort(function(t,e){return t.name<e.name?-1:t.name>e.name?1:0}).map(function(t,e){return{file:t,previewID:"img_0"+e}}),this._doJobs(n,this._readFile,2))}},this.getPictureFiles=function(t){var e=[];if(t&&t.length)for(var n=0;n<t.length;n++){var i=t[n];this._isPicture(i)&&e.push(i)}return e},this.getPicturesCount=function(t){return this.getPictureFiles(t).length}}]);