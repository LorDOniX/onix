/**
 * OnixJS framework
 * 3.0.1/9. 11. 2016
 * source: https://gitlab.com/LorDOniX/onix
 * documentation: https://gitlab.com/LorDOniX/onix/tree/master/docs
 * 
 * @license MIT
 * - Free for use in both personal and commercial projects
 */

function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(){"use strict";var e=Array.prototype.slice;try{e.call(document.documentElement)}catch(t){Array.prototype.slice=function(t,i){if(i="undefined"!=typeof i?i:this.length,"[object Array]"===Object.prototype.toString.call(this))return e.call(this,t,i);var n,s,o=[],r=this.length,a=t||0;a=a>=0?a:Math.max(0,r+a);var h="number"==typeof i?Math.min(i,r):r;if(i<0&&(h=r+i),s=h-a,s>0)if(o=new Array(s),this.charAt)for(n=0;n<s;n++)o[n]=this.charAt(a+n);else for(n=0;n<s;n++)o[n]=this[a+n];return o}}}(),function(){Event=Event||window.Event,Event.prototype.stopPropagation=Event.prototype.stopPropagation||function(){this.cancelBubble=!0},Event.prototype.preventDefault=Event.prototype.preventDefault||function(){this.returnValue=!1},"btoa"in window||(window.btoa=function(e){return e}),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){for(var i=this.length,n=0;n<i;n++)n in this&&e.call(t,this[n],n,this)}),Array.prototype.every||(Array.prototype.every=function(e,t){for(var i=this.length,n=0;n<i;n++)if(n in this&&!e.call(t,this[n],n,this))return!1;return!0}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var i=this.length,n=t||0;for(n<0&&(n+=i);n<i;n++)if(n in this&&this[n]===e)return n;return-1}),Object.keys||(Object.keys=function(){"use strict";var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),i=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],n=i.length;return function(s){if("object"!=typeof s&&("function"!=typeof s||null===s))throw new TypeError("Object.keys called on non-object");var o,r,a=[];for(o in s)e.call(s,o)&&a.push(o);if(t)for(r=0;r<n;r++)e.call(s,i[r])&&a.push(i[r]);return a}}());try{Object.defineProperty({},"a",{value:3})}catch(e){var t=Object.defineProperty;Object.defineProperty=function(e,i,n){try{return t.apply(Object,arguments)}catch(s){return e[i]=n.value,e}},Object.defineProperties=function(e,t){for(var i in t)Object.defineProperty(e,i,t[i]);return e}}Object.create||(Object.create=function(e,t){var i=function(){};i.prototype=e;var n=new i;return Object.defineProperties(n,t),n});var i={};if(!Object.setPrototypeOf&&!i.__proto__){var n=Object.getPrototypeOf;Object.getPrototypeOf=function(e){return e.__proto__?e.__proto__:n.call(Object,e)}}if(Date.now||(Date.now=function(){return+new Date}),Function.prototype.bind||(Function.prototype.bind=function(e){var t=this,i=Array.prototype.slice.call(arguments,1);return function(){return t.apply(e,i.concat(Array.prototype.slice.call(arguments)))}}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),String.prototype.replaceAll||(String.prototype.replaceAll=function(e,t){return this.split(e).join(t)}),String.prototype.format||(String.prototype.format=function(){var e=Array.prototype.slice.call(arguments),t=this.toString();return e.forEach(function(e,i){t=t.replace(new RegExp("{\\s*"+i+"\\s*}","g"),e)}),t}),!("console"in window)){var s=function(){};window.console={},["log","warn","error","clear","info"].forEach(function(e){window.console[e]=s})}if(!("addEventListener"in document)){var o=Window.prototype,r=HTMLDocument.prototype,e=Element.prototype;document.addEventListener=o.addEventListener=r.addEventListener=e.addEventListener=function(e,t){if(this.__eventListeners||(this.__eventListeners={}),"DOMContentLoaded"==e)this.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&t()});else{this.__eventListeners[e]||(this.__eventListeners[e]=[]);var i=function(){return t.apply(this,arguments)}.bind(this);this.__eventListeners[e].push({fn:i,listener:t}),this.attachEvent("on"+e,i)}},document.removeEventListener=o.removeEventListener=r.removeEventListener=e.removeEventListener=function(e,t){for(var i=this.__eventListeners||{},n=i[e]||[],s=null,o=-1,r=0;r<n.length;r++){var a=n[r];if(a.listener==t){s=a.fn,o=r;break}}return s?(n.splice(o,1),n.length||delete i[e],this.detachEvent("on"+e,s)):null}}"classList"in document.documentElement||!window.Element||!function(){function e(e){if(this._element=e,e.className!=this._classCache&&(this._classCache=e.className,this._classCache))for(var t=this._classCache.replace(/^\s+|\s+$/g,"").split(/\s+/),i=0;i<t.length;i++)r.call(this,t[i])}function t(e,t){e.className=t.join(" ")}function i(e,t,i){Object.defineProperty?Object.defineProperty(e,t,{get:i}):e.__defineGetter__(t,i)}var n=Array.prototype,s=n.indexOf,o=n.slice,r=n.push,a=n.splice,h=n.join;window.DOMTokenList=e,e.prototype={add:function(e){this.contains(e)||(r.call(this,e),t(this._element,o.call(this,0)))},contains:function(e){return s.call(this,e)!=-1},item:function(e){return this[e]||null},remove:function(e){var i=s.call(this,e);i!=-1&&(a.call(this,i,1),t(this._element,o.call(this,0)))},toString:function(){return h.call(this," ")},toggle:function(e){return s.call(this,e)==-1?(this.add(e),!0):(this.remove(e),!1)}},i(Element.prototype,"classList",function(){return new e(this)})}()}(),function(){function e(e){return!!e.exifdata}function t(e,t){t=t||e.match(/^data\:([^\;]+)\;base64,/im)[1]||"",e=e.replace(/^data\:([^\;]+)\;base64,/gim,"");for(var i=atob(e),n=i.length,s=new ArrayBuffer(n),o=new Uint8Array(s),r=0;r<n;r++)o[r]=i.charCodeAt(r);return s}function i(e,t){var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="blob",i.onload=function(e){200!=this.status&&0!==this.status||t(this.response)},i.send()}function s(e,n){function s(t){var i=o(t),s=r(t);e.exifdata=i||{},e.iptcdata=s||{},n&&n.call(e)}if(e.src)if(/^data\:/i.test(e.src)){var a=t(e.src);s(a)}else if(/^blob\:/i.test(e.src)){var h=new FileReader;h.onload=function(e){s(e.target.result)},i(e.src,function(e){h.readAsArrayBuffer(e)})}else{var c=new XMLHttpRequest;c.onload=function(){if(200!=this.status&&0!==this.status)throw"Could not load image";s(c.response),c=null},c.open("GET",e.src,!0),c.responseType="arraybuffer",c.send(null)}else if(window.FileReader&&(e instanceof window.Blob||e instanceof window.File)){var h=new FileReader;h.onload=function(e){d&&console.log("Got file of length "+e.target.result.byteLength),s(e.target.result)},h.readAsArrayBuffer(e)}}function o(e){var t=new DataView(e);if(d&&console.log("Got file of length "+e.byteLength),255!=t.getUint8(0)||216!=t.getUint8(1))return d&&console.log("Not a valid JPEG"),!1;for(var i,n=2,s=e.byteLength;n<s;){if(255!=t.getUint8(n))return d&&console.log("Not a valid marker at offset "+n+", found: "+t.getUint8(n)),!1;if(i=t.getUint8(n+1),d&&console.log(i),225==i)return d&&console.log("Found 0xFFE1 marker"),l(t,n+4,t.getUint16(n+2)-2);n+=2+t.getUint16(n+2)}}function r(e){var t=new DataView(e);if(d&&console.log("Got file of length "+e.byteLength),255!=t.getUint8(0)||216!=t.getUint8(1))return d&&console.log("Not a valid JPEG"),!1;for(var i=2,n=e.byteLength,s=function(e,t){return 56===e.getUint8(t)&&66===e.getUint8(t+1)&&73===e.getUint8(t+2)&&77===e.getUint8(t+3)&&4===e.getUint8(t+4)&&4===e.getUint8(t+5)};i<n;){if(s(t,i)){var o=t.getUint8(i+7);o%2!==0&&(o+=1),0===o&&(o=4);var r=i+8+o,h=t.getUint16(i+6+o);return a(e,r,h)}i++}}function a(e,t,i){for(var n,s,o,r,a,h=new DataView(e),c={},l=t;l<t+i;)28===h.getUint8(l)&&2===h.getUint8(l+1)&&(r=h.getUint8(l+2),r in g&&(o=h.getInt16(l+3),a=o+5,s=g[r],n=u(h,l+5,o),c.hasOwnProperty(s)?c[s]instanceof Array?c[s].push(n):c[s]=[c[s],n]:c[s]=n)),l++;return c}function h(e,t,i,n,s){var o,r,a,h=e.getUint16(i,!s),u={};for(a=0;a<h;a++)o=i+12*a+2,r=n[e.getUint16(o,!s)],!r&&d&&console.log("Unknown tag: "+e.getUint16(o,!s)),u[r]=c(e,o,t,i,s);return u}function c(e,t,i,n,s){var o,r,a,h,c,l,d=e.getUint16(t+2,!s),_=e.getUint32(t+4,!s),f=e.getUint32(t+8,!s)+i;switch(d){case 1:case 7:if(1==_)return e.getUint8(t+8,!s);for(o=_>4?f:t+8,r=[],h=0;h<_;h++)r[h]=e.getUint8(o+h);return r;case 2:return o=_>4?f:t+8,u(e,o,_-1);case 3:if(1==_)return e.getUint16(t+8,!s);for(o=_>2?f:t+8,r=[],h=0;h<_;h++)r[h]=e.getUint16(o+2*h,!s);return r;case 4:if(1==_)return e.getUint32(t+8,!s);for(r=[],h=0;h<_;h++)r[h]=e.getUint32(f+4*h,!s);return r;case 5:if(1==_)return c=e.getUint32(f,!s),l=e.getUint32(f+4,!s),a=new Number(c/l),a.numerator=c,a.denominator=l,a;for(r=[],h=0;h<_;h++)c=e.getUint32(f+8*h,!s),l=e.getUint32(f+4+8*h,!s),r[h]=new Number(c/l),r[h].numerator=c,r[h].denominator=l;return r;case 9:if(1==_)return e.getInt32(t+8,!s);for(r=[],h=0;h<_;h++)r[h]=e.getInt32(f+4*h,!s);return r;case 10:if(1==_)return e.getInt32(f,!s)/e.getInt32(f+4,!s);for(r=[],h=0;h<_;h++)r[h]=e.getInt32(f+8*h,!s)/e.getInt32(f+4+8*h,!s);return r}}function u(e,t,i){var s="";for(n=t;n<t+i;n++)s+=String.fromCharCode(e.getUint8(n));return s}function l(e,t){if("Exif"!=u(e,t,4))return d&&console.log("Not valid EXIF data! "+u(e,t,4)),!1;var i,n,s,o,r,a=t+6;if(18761==e.getUint16(a))i=!1;else{if(19789!=e.getUint16(a))return d&&console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),!1;i=!0}if(42!=e.getUint16(a+2,!i))return d&&console.log("Not valid TIFF data! (no 0x002A)"),!1;var c=e.getUint32(a+4,!i);if(c<8)return d&&console.log("Not valid TIFF data! (First offset less than 8)",e.getUint32(a+4,!i)),!1;if(n=h(e,a,a+c,v,i),n.ExifIFDPointer){o=h(e,a,a+n.ExifIFDPointer,p,i);for(s in o){switch(s){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":o[s]=y[s][o[s]];break;case"ExifVersion":case"FlashpixVersion":o[s]=String.fromCharCode(o[s][0],o[s][1],o[s][2],o[s][3]);break;case"ComponentsConfiguration":o[s]=y.Components[o[s][0]]+y.Components[o[s][1]]+y.Components[o[s][2]]+y.Components[o[s][3]]}n[s]=o[s]}}if(n.GPSInfoIFDPointer){r=h(e,a,a+n.GPSInfoIFDPointer,m,i);for(s in r){switch(s){case"GPSVersionID":r[s]=r[s][0]+"."+r[s][1]+"."+r[s][2]+"."+r[s][3]}n[s]=r[s]}}return n}var d=!1,_=this,f=function(e){return e instanceof f?e:this instanceof f?void(this.EXIFwrapped=e):new f(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=f),exports.EXIF=f):_.EXIF=f;var p=f.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},v=f.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},m=f.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},y=f.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}},g={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};f.getData=function(t,i){return!((t instanceof Image||t instanceof HTMLImageElement)&&!t.complete)&&(e(t)?i&&i.call(t):s(t,i),!0)},f.getTag=function(t,i){if(e(t))return t.exifdata[i]},f.getAllTags=function(t){if(!e(t))return{};var i,n=t.exifdata,s={};for(i in n)n.hasOwnProperty(i)&&(s[i]=n[i]);return s},f.pretty=function(t){if(!e(t))return"";var i,n=t.exifdata,s="";for(i in n)n.hasOwnProperty(i)&&(s+="object"==typeof n[i]?n[i]instanceof Number?i+" : "+n[i]+" ["+n[i].numerator+"/"+n[i].denominator+"]\r\n":i+" : ["+n[i].length+" values]\r\n":i+" : "+n[i]+"\r\n");return s},f.readFromBinaryFile=function(e){return o(e)},"function"==typeof define&&define.amd&&define("exif-js",[],function(){return f})}.call(this);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();onix=function(){var e=function(){function e(t,i){_classCallCheck(this,e),this._objects={},this._runs=[],this._configs=[],this._name=t||"",this._dependencies=i||[]}return _createClass(e,[{key:"getDependencies",value:function(){return this._dependencies}},{key:"getName",value:function(){return this._name}},{key:"getConfigs",value:function(){return this._configs}},{key:"getRuns",value:function(){return this._runs}},{key:"getObjects",value:function(){return this._objects}},{key:"provider",value:function(t,i){if(!t||!i)return this;var n=e.parseParam(i);return this._objects[t+e.CONST.PROVIDER_NAME]={name:t+e.CONST.PROVIDER_NAME,inject:n.inject,fn:n.fn,cache:null,type:e.CONST.TYPE.PROVIDER},this._objects[t]={name:t,inject:null,fn:null,cache:null,provider:t+e.CONST.PROVIDER_NAME,type:e.CONST.TYPE.FACTORY},this}},{key:"service",value:function(t,i){if(!t||!i)return this;var n=e.parseParam(i);return this._objects[t]={name:t,inject:n.inject,fn:n.fn,cache:null,type:e.CONST.TYPE.SERVICE},this}},{key:"factory",value:function(t,i){if(!t||!i)return this;var n=e.parseParam(i);return this._objects[t]={name:t,inject:n.inject,fn:n.fn,cache:null,type:e.CONST.TYPE.FACTORY},this}},{key:"constant",value:function(t,i){return t&&i?(this._objects[t]={name:t,cache:i,type:e.CONST.TYPE.CONSTANT},this):this}},{key:"value",value:function(t,i){return t&&i?(this._objects[t]={name:t,cache:i,type:e.CONST.TYPE.VALUE},this):this}},{key:"filter",value:function(t,i){if(!t||!i)return this;var n=e.parseParam(i);return this._objects[e.getFilterName(t)]={name:t,inject:n.inject,fn:n.fn,cache:null,type:e.CONST.TYPE.FILTER},this}},{key:"config",value:function(t){if(!t)return this;var i=e.parseParam(t);return this._configs.push({fn:i.fn,inject:i.inject,type:e.CONST.TYPE.CONFIG}),this}},{key:"run",value:function(t){if(!t)return this;var i=e.parseParam(t);return this._runs.push({fn:i.fn,inject:i.inject,type:e.CONST.TYPE.RUN}),this}},{key:"controller",value:function(){return this}},{key:"directive",value:function(){return this}}],[{key:"parseParam",value:function(e){var t=void 0,i=[];return Array.isArray(e)?e.every(function(e){return"function"==typeof e?(t=e,!1):("string"==typeof e&&i.push(e),!0)}):t=e,{fn:t,inject:i}}},{key:"getFilterName",value:function(t){return t=t||"",e.CONST.FILTER_NAME+t[0].toUpperCase()+t.substr(1)}}]),e}();e.CONST={PROVIDER_NAME:"Provider",FILTER_NAME:"$filter",TYPE:{PROVIDER:1,SERVICE:2,FACTORY:3,CONSTANT:4,VALUE:5,FILTER:6,CONFIG:7,RUN:8}};var t=function(){function t(){var e=this;_classCallCheck(this,t),this._modules=[],this._modulesObj={},this._objectsCache={},this._CONST={MODULE_SEPARATOR:"::"},document.addEventListener("DOMContentLoaded",function(){e._domLoad()})}return _createClass(t,[{key:"_domLoad",value:function(){var e=this,t=[],i=[];this._modules.forEach(function(n){var s=!1,o=n.getDependencies();o.every(function(t){return t in e._modulesObj||(console.error("Module '"+e._name+"' dependency '"+t+"' not found!"),s=!0,!1)}),s||(t=t.concat(n.getConfigs()),i=i.concat(n.getRuns()))}),t.forEach(function(t){e.run(t,!0)}),i.forEach(function(t){e.run(t)})}},{key:"_getObject",value:function(e){var t=this,i=null;if(e in this._objectsCache)i=this._objectsCache[e];else{var n=function(){var n="",s="";if(e.indexOf(t._CONST.MODULE_SEPARATOR)!=-1){var o=e.split(t._CONST.MODULE_SEPARATOR);if(2!=o.length)return console.error("Get object "+e+" error! Wrong module separator use."),{v:null};n=o[0],s=o[1]}else s=e;t._modules.every(function(e){var t=e.getObjects();return n?e.getName()!=n||(s in t?(i=t[s],!1):(console.error("Get object "+s+" error! Cannot find object in the module "+n+"."),!1)):!(s in t)||(i=t[s],!1)}),t._objectsCache[e]=i}();if("object"===("undefined"==typeof n?"undefined":_typeof(n)))return n.v}return i}},{key:"noop",value:function(){}},{key:"run",value:function(t,i,n){var s=this;if(n=n||[],n.indexOf(t.name)!=-1)return console.error("Circular dependency error! Object name: "+t.name+", parents: "+n.join("|")),null;var o=[];if(t.provider){var r=this._getObject(t.provider);if(!r.cache){var a=r.fn||this.noop;r.cache=new a}var h=r.cache.$get||this.noop,c=e.parseParam(h);t.fn=c.fn,t.inject=c.inject,delete t.provider}if(t.inject&&t.inject.length&&t.inject.forEach(function(e){if("string"==typeof e){var r=s._getObject(e);r?o.push(s.run(r,i,t.name?n.concat(t.name):n)):(console.error("Object name: "+e+" not found!"),o.push(null))}else"object"===("undefined"==typeof e?"undefined":_typeof(e))&&o.push(e)}),i)switch(t.type){case e.CONST.TYPE.PROVIDER:if(!t.cache){var u=t.fn||this.noop;t.cache=new u}return t.cache;case e.CONST.TYPE.CONSTANT:return t.cache;case e.CONST.TYPE.CONFIG:var l=t.fn||this.noop;return l.apply(l,o);default:return null}else switch(t.type){case e.CONST.TYPE.FACTORY:case e.CONST.TYPE.FILTER:if(!t.cache){var d=t.fn||this.noop;t.cache=d.apply(d,o)}return t.cache;case e.CONST.TYPE.SERVICE:if(!t.cache){var _=t.fn||this.noop,f=Object.create(_.prototype);_.apply(f,o),t.cache=f}return t.cache;case e.CONST.TYPE.VALUE:return t.cache;case e.CONST.TYPE.CONSTANT:return t.cache;case e.CONST.TYPE.RUN:var p=t.fn||this.noop;return p.apply(p,o);default:return null}}},{key:"addModule",value:function(t,i){var n=new e(t,i);return this._modulesObj[t]=n,this._modules.push(n),n}}]),t}(),i=new t,n=i.addModule("onix");return n.module=function(e,t){return i.addModule(e,t)},n.noop=i.noop,n.match=function(e,t,i){for(var n=[],s=0,o=t.length,r=i.length,a="",h=0;h<e.length;h++){var c=e[h],u=h-o+1,l=h-r+1;(1==o&&c==t||o>1&&(u>=0?e.substr(u,o):"")==t)&&(s++,1==s)||((1==r&&c==i||r>1&&(l>=0?e.substr(l,r):"")==i)&&(s--,r>1&&(a=a.substr(0,a.length-r+1))),s>0&&(a+=c),!s&&a.length&&(n.push(a),a=""))}return n},n.split=function(e,t){e=e||"",t=t||",";for(var i=0,n=[],s="",o=!1,r=e.length,a=0;a<r;a++){var h=e[a];switch(h){case"'":case'"':o?(o=!1,i--):(o=!0,i++);break;case"{":case"[":i++;break;case"}":case"]":i--}h!=t||i?s+=h:(s.length&&n.push(s),s=""),a==r-1&&s.length&&n.push(s)}return n},n.info=function(){console.log('OnixJS framework\n'+'3.0.1/9. 11. 2016\n'+'source: https://gitlab.com/LorDOniX/onix\n'+'documentation: https://gitlab.com/LorDOniX/onix/tree/master/docs\n'+'\n'+'@license MIT\n'+'- Free for use in both personal and commercial projects\n')},n.factory("$di",function(){return{parseParam:e.parseParam,getFilterName:e.getFilterName,run:function(t){return t?(t.fn||(t.fn=function(){}),t.type=e.CONST.TYPE.RUN,i.run(t)):null}}}),n}(),onix.factory("$filter",["$di",function(e){return function(t){var i=function(e){return e||""};return t?e.run({fn:function(e){return e||i},inject:[e.getFilterName(t)]}):i}}]),onix.service("$common",["$promise",function(e){this._objCopy=function(e,t){var i=this;Object.keys(t).forEach(function(n){t.hasOwnProperty(n)&&(e[n]=i.cloneValue(t[n]))})},this._chainPromisesInner=function(e,t,i,n){var s=this,o=e.shift();if(o){var r=void 0,a=!1;switch(_typeof(o.method)){case"string":o.scope&&o.method in o.scope?(r=o.scope[o.method],"function"!=typeof r&&(a=!0)):a=!0;break;case"function":r=o.method;break;default:a=!0}a?t({output:i,rejected:n}):r.apply(o.scope||r,o.args||[]).then(function(o){i.push(o),s._chainPromisesInner(e,t,i,n)},function(o){i.push(o),s._chainPromisesInner(e,t,i,n+1)})}else t({output:i,rejected:n})},this._cloneValue=function(e,t){var i=this;if(t=t||0,t>100)return null;switch("undefined"==typeof e?"undefined":_typeof(e)){case"object":if(Array.isArray(e)){var n=function(){var n=[];return e.forEach(function(e){n.push(i._cloneValue(e,t+1))}),{v:n}}();if("object"===("undefined"==typeof n?"undefined":_typeof(n)))return n.v}else{if(e&&e instanceof Date)return new Date(e.getTime());if(this.isElement(e))return e;if(!e)return null;var s=function(){var n={};return Object.keys(e).forEach(function(s){e.hasOwnProperty(s)&&(n[s]=i._cloneValue(e[s],t+1))}),{v:n}}();if("object"===("undefined"==typeof s?"undefined":_typeof(s)))return s.v}case"undefined":case"boolean":case"function":case"number":case"string":return e}},this._compare=function(e,t,i,n){var s=this;return i=i||[],n=n||[],Object.keys(e).forEach(function(o){var r=e[o],a=t[o],h=i.concat(o).join(".");s.isObject(r)?s.isObject(a)?s._compare(r,a,i.concat(o),n):n.push('missing object at path "{0}"'.format(h)):"string"==typeof r&&"string"!=typeof a&&n.push('wrong type at path "{0}"'.format(h))}),n},this.confirm=function(t){return new e(function(e,i){confirm(t)?e():i()})},this.merge=function(){var e=arguments.length,t={};if(e>0)for(var i=0;i<e;i++){var n=arguments[i];this._objCopy(t,n)}return t},this.extend=function(e,t){e=e||{},t=t||{},this._objCopy(e,t)},this.cloneValue=function(e){return this._cloneValue(e,0)},this.inherit=function(){var e=arguments;if(!(e.length<2)){var t=e[0].prototype,i=Array.prototype.slice.call(e,1);i.forEach(function(e){for(var i in e.prototype)t[i]="object"!=_typeof(e.prototype[i])?e.prototype[i]:JSON.parse(JSON.stringify(e.prototype[i]))})}},this.bindWithoutScope=function(e){var t=Array.prototype.slice.call(arguments,1);return function(){var i=Array.prototype.slice.call(arguments,0),n=Array.prototype.concat(i,t);return e.apply(this,n)}},this.nodesForEach=function(e,t,i){"function"==typeof t&&e&&Array.prototype.slice.call(e).forEach(function(e,n){t.apply(i||t,[e,n])})},this.reverseForEach=function(e,t,i){if("function"==typeof t){e=e||[];for(var n=e.length-1;n>=0;n--)t.apply(i||this,[e[n],n])}},this.hexToD=function(e){switch(e=e.toLowerCase()){case"a":return 10;case"b":return 11;case"c":return 12;case"d":return 13;case"e":return 14;case"f":return 15;default:return parseInt(e,10)}},this.hexToRGB=function(e){return"#"==e[0]?(e=e.replace("#",""),3==e.length?{r:16*this.hexToD(e[0])+this.hexToD(e[0]),g:16*this.hexToD(e[1])+this.hexToD(e[1]),b:16*this.hexToD(e[2])+this.hexToD(e[2])}:{r:16*this.hexToD(e[0])+this.hexToD(e[1]),g:16*this.hexToD(e[2])+this.hexToD(e[3]),b:16*this.hexToD(e[4])+this.hexToD(e[5])}):e},this.isElement=function(e){return e&&e instanceof Element},this.isObject=function(e){return"object"===("undefined"==typeof e?"undefined":_typeof(e))&&!Array.isArray(e)&&null!==e},this.col=function(){var e=arguments;if(e.length){var t=e[0];console.log(t.format.apply(t,Array.prototype.slice.call(e,1)))}},this.formatSize=function(e){if("number"!=typeof e)return"null";var t=e>0?Math.floor(Math.log(e)/Math.log(1024)):0,i=["","K","M","G","T"];t=Math.min(i.length,t);var n=t>0?(e/Math.pow(1024,t)).toFixed(2):e;return n+" "+i[t]+"B"},this.chainPromises=function(t){var i=this;return new e(function(e){i._chainPromisesInner(t,e,[],0)})},this.cancelEvents=function(e){e&&(e.stopPropagation(),e.preventDefault())},this.cssNameToJS=function(e){var t=e.split("-"),i="";return t.forEach(function(e,t){i+=t?e[0].toUpperCase()+e.substr(1):e}),i},this.valueFromObject=function(e,t,i){var n=this;if(arguments.length<2)return null;var s=e,o=t.split(".");return o.every(function(e){e=e.trim();var t=e.match(/\[\s*(\d+)\s*\]/),o=!1;if(t){var r=s[e.replace(t[0],"")],a=parseFloat(t[1]);Array.isArray(r)&&a>=0&&a<r.length&&(s=r[a],o=!0)}else n.isObject(s)&&(s=s[e],o=!0);return!(!o||"undefined"==typeof s)||(s=i||null,!1)}),s},this.timeDuration=function(e){e=e||0;var t="",i=Math.floor(e/86400);e-=3600*i*24,i&&(t+=i+"d ");var n=Math.floor(e/3600);e-=3600*n,t+=(n<10?"0"+n:n)+":";var s=Math.floor(e/60);return t+=(s<10?"0"+s:s)+":",e-=60*s,t+=e<10?"0"+e:e},this.compareObjects=function(e,t){return e=e||{},t=t||{},this._compare(e,t)}}]),onix.service("$cookie",["$date",function(e){this._CONST={EXPIRES:{MAX:"Fri, 31 Dec 9999 23:59:59 GMT",MIN:"Thu, 01 Jan 1970 00:00:00 GMT"}},this.set=function(t,i,n){if(!t||/^(?:expires|max\-age|path|domain|secure)$/i.test(t))return!1;var s={expiration:e.addDays(new Date,30),path:"",domain:"",secure:""},o="";if(s.expiration)switch(s.expiration.constructor){case Number:o=s.expiration===1/0?"; expires="+this._CONST.EXPIRES.MAX:"; max-age="+s.expiration;break;case String:o="; expires="+s.expiration;break;case Date:o="; expires="+s.expiration.toUTCString()}return document.cookie=encodeURIComponent(t)+"="+encodeURIComponent(i)+o+(s.domain?"; domain="+s.domain:"")+(s.path?"; path="+s.path:"")+(s.secure?"; secure":""),!0},this.get=function(e){e=e||"";var t=null;if(document.cookie&&""!=document.cookie){var i=document.cookie.split(";");i.every(function(i){return i=i.trim(),i.substring(0,e.length+1)!=e+"="||(t=decodeURIComponent(i.substring(e.length+1)),!1)})}return t},this.remove=function(e,t,i){return!!this.contains(e)&&(document.cookie=encodeURIComponent(e)+"=; expires="+this._CONST.EXPIRES.MIN+(t?"; domain="+t:"")+(i?"; path="+i:""),!0)},this.contains=function(e){return!!e&&new RegExp("(?:^|;\\s*)"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)}}]),onix.service("$date",function(){this.dateENtoCS=function(e){e=e||"";var t=e.split("-");return 3==t.length?[t[2].replace(/^0/,""),t[1].replace(/^0/,""),t[0]].join(". "):""},this.dateCStoEN=function(e){e=e||"";var t=e.split(".");if(3==t.length){var i=t[2].trim(),n=t[1].trim(),s=t[0].trim();return s=1==s.length?"0"+s:s,n=1==n.length?"0"+n:n,[i,n,s].join("-")}return""},this.isCSdate=function(e){return e=e||"",!!e.match(/([1-9]|[1-3][0-9])\.[ ]*([1-9]|1[0-2])\.[ ]*[1-9][0-9]{3}/)},this.addDays=function(e,t){t=t||0;var i=864e5*t;return new Date(e.getTime()+i)},this.format=function(e,t){t=t||"d. m. yyyy hh:MM:ss";var i=e.getDate(),n=e.getMonth()+1,s=e.getFullYear(),o=e.getSeconds(),r=e.getMinutes(),a=e.getHours(),h={yyyy:s,m:n,mm:n<10?"0"+n:n,d:i,dd:i<10?"0"+i:i,s:o,ss:o<10?"0"+o:o,M:r,MM:r<10?"0"+r:r,h:a,hh:a<10?"0"+a:a},c=Object.keys(h).sort(function(e,t){return t.length-e.length});return c.forEach(function(e){t=t.replace(new RegExp(e,"g"),h[e])}),t}}),onix.service("$dom",["$common",function(e){this.create=function(t,i){var n=this,s=t.el||"div",o=void 0;return o="text"==s?document.createTextNode(""):document.createElement(s),Object.keys(t).forEach(function(s){var r=void 0;switch(s){case"el":break;case"attrs":r=t.attrs,r&&"object"===("undefined"==typeof r?"undefined":_typeof(r))&&!Array.isArray(r)&&Object.keys(r).forEach(function(e){o.setAttribute(e,r[e])});break;case"css":r=t.css,r&&"object"===("undefined"==typeof r?"undefined":_typeof(r))&&!Array.isArray(r)&&Object.keys(r).forEach(function(t){o.style[e.cssNameToJS(t)]=r[t]});break;case"events":r=t.events,Array.isArray(r)||(r=[r]),r.forEach(function(e){o.addEventListener(e.event,e.fn)});break;case"child":r=t.child,Array.isArray(r)||(r=[r]),r.forEach(function(e){o.appendChild(n.create(e,i))});break;case"_exported":i[t._exported]=o;break;case"class":r=t["class"],"string"==typeof r?o.classList.add(r):Array.isArray(r)&&r.forEach(function(e){o.classList.add(e)});break;default:o[s]=t[s]}}),o},this.get=function(e,t){t=t||document;
var i=void 0,n=/^[.# ]+/g;return"string"==typeof e&&e?i=t.querySelector(e):Array.isArray(e)&&(i={},e.forEach(function(e){var s=void 0;"string"==typeof e?(s=e.replace(n,""),i[s]=t.querySelector(e)):(s=e.sel.replace(n,""),i[e.name||s]=t.querySelector(e.sel))})),i}}]),onix.factory("$event",function(){var e=function(){function e(){_classCallCheck(this,e),this._allEvents=[]}return _createClass(e,[{key:"on",value:function(e,t,i){e&&t&&this._allEvents.push({name:e,fn:t,scope:i})}},{key:"off",value:function(e,t,i){if(e)for(var n=this._allEvents.length-1,s=n;s>=0;s--){var o=this._allEvents[s];o.name==e&&(t&&t!=o.fn||i&&i!=o.scope||this._allEvents.splice(s,1))}}},{key:"once",value:function(e,t,i){e&&t&&this._allEvents.push({name:e,fn:t,scope:i,once:!0})}},{key:"trigger",value:function(e){if(e)for(var t=Array.prototype.slice.call(arguments,1),i=this._allEvents.length-1,n=i;n>=0;n--){var s=this._allEvents[n];s.name==e&&(s.fn.apply(s.scope||this,t),s.once&&this._allEvents.splice(n,1))}}}]),e}();return e}),onix.factory("$resize",["$event",function(e){var t=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this));return e._active=!1,e._resizeObj={id:null,timeout:333},e._binds={resize:e._resize.bind(e),resizeInner:e._resizeInner.bind(e)},e}return _inherits(t,e),_createClass(t,[{key:"_resize",value:function(){this._resizeObj.id&&(clearTimeout(this._resizeObj.id),this._resizeObj.id=null),this._resizeObj.id=setTimeout(this._binds.resizeInner,this._resizeObj.timeout)}},{key:"_resizeInner",value:function(){this.trigger("resize")}},{key:"start",value:function(){this._active||(window.addEventListener("resize",this._binds.resize),this._active=!0)}},{key:"end",value:function(){this._active&&(window.removeEventListener("resize",this._binds.resize),this._active=!1)}},{key:"isActive",value:function(){return this._active}}]),t}(e);return new t}]),onix.filter("lowercase",function(){return function(e){return"string"==typeof e?e.toLowerCase():e}}),onix.filter("uppercase",function(){return function(e){return"string"==typeof e?e.toUpperCase():e}}),onix.filter("json",function(){return function(e,t){if("object"===("undefined"==typeof e?"undefined":_typeof(e))){var i=null;return t&&(t=parseInt(t,10),i=isNaN(t)?null:t),JSON.stringify(e,null,i)}return e}}),onix.service("$http",["$promise","$common","$location",function(e,t,i){this._preparePostData=function(e){var t=new FormData;return e&&(Array.isArray(e)?e.forEach(function(e){t.append(e.name,e.value)}):Object.keys(e).forEach(function(i){t.append(i,e[i])})),t},this._updateURL=function(e,t){var n=i.objToURL(t);return n&&(e+=(e.indexOf("?")==-1?"?":"")+n),e},this.POST_TYPES={JSON:1,FORM_DATA:2},this.METHOD={POST:"POST",GET:"GET",DELETE:"DELETE",PATCH:"PATCH"},this.createRequest=function(i){var n=this;return new e(function(e,s){i=i||{};var o=new XMLHttpRequest,r=i.method||n.METHOD.GET,a=i.url||"";if(!a)return void s();a=n._updateURL(a,i.getData),o.onerror=function(e){s(e)},o.open(r,a,!0),o.onreadystatechange=function(){if(4==o.readyState){var t=o.responseText||"",i=o.getResponseHeader("Content-Type")||"",n=null;n=i.indexOf("application/json")!=-1?t.length?JSON.parse(t):{}:t;var h={status:o.status,data:n,url:a,method:r};o.status>=200&&o.status<300?e(h):s(h)}};try{!function(){var e=i.headers;t.isObject(e)&&Object.keys(e).forEach(function(t){o.setRequestHeader(t,e[t])}),r==n.METHOD.GET&&o.setRequestHeader("Accept","application/json");var s=i.postType||n.POST_TYPES.JSON;i.postData&&s==n.POST_TYPES.JSON?(o.setRequestHeader("Content-Type","application/json; charset=UTF-8"),o.send(JSON.stringify(i.postData))):i.postData&&s==n.POST_TYPES.FORM_DATA?o.send(n._preparePostData(i.postData)):o.send()}()}catch(h){s(h)}})}}]),onix.provider("$i18n",function(){var e={},t="",i=!0,n=function(e,t){e=e||"",t=t||{};var i="{",n="}",s=onix.match(e,i,n);return s.length&&!function(){var o={};s.forEach(function(e){var s=e.split(",");if(s.length){var r=s.shift().trim(),a={},h=s.join(" ").match(/[a-zA-Z0-9_]+{[^}]*}/g);h&&h.forEach(function(e){var t=e.match(/([a-zA-Z0-9_]+){([^}]*)/);a[t[1].trim()]=t[2].trim()});var c=r in t?t[r]:"";if("number"==typeof c&&Object.keys(a).length){var u=void 0;switch(c){case 1:u="one";break;case 2:case 3:case 4:u="few";break;default:u="other"}c=u in a?a[u]:""}o[i+e+n]=c}}),Object.keys(o).forEach(function(t){e=e.replaceAll(t,o[t])})}(),e},s=function(i,s){var o=e[t],r=i||"";return o&&!function(){var e=i.split("."),t=e.length;e.every(function(e,i){return e in o&&(o=o[e],i!=t-1||(r=o,!1))})}(),n(r,s)},o=function(t,i){t&&i&&(e[t]||(e[t]={}),Object.keys(i).forEach(function(n){e[t][n]=i[n]}))},r=function(e){t=e||""};this.disableGlobalTranslation=function(){i=!1},this.addLanguage=function(e,t){o(e,t)},this.setLanguage=function(e){r(e)},this.postProcess=function(){i&&(window._=s)},this.$get=["$http","$promise",function(i,n){var a=function(){function a(){_classCallCheck(this,a)}return _createClass(a,[{key:"_",value:function(e,t){return s(e,t)}},{key:"addLanguage",value:function(e,t){o(e,t)}},{key:"setLanguage",value:function(e){r(e)}},{key:"getLanguage",value:function(e){return t}},{key:"getAllLanguages",value:function(t){return Object.keys(e)}},{key:"loadLanguage",value:function(e,t){return new n(function(n,s){i.createRequest({url:t}).then(function(t){o(e,t.data),n()},function(e){s(e)})})}}]),a}();return new a}]}),onix.config(["$i18nProvider",function(e){e.postProcess()}]),onix.service("$image",["$promise","$features",function(e,t){this.readFromFile=function(i,n){var s=this;return new e(function(e,o){if(!t.FILE_READER)return void o();var r=new FileReader,a={img:null,exif:null,canvas:null};r.onload=function(t){var o=r.result,h=new Uint8Array(o),c=null;"image/jpeg"!=i.type&&"image/pjpeg"!=i.type||(c=s.getEXIF(o));var u=new Image;u.onload=function(){var t=s.getImageDim(u,n),i=s.getCanvas(u,{width:t.width,height:t.height,orientation:c?c.Orientation:0,scaled:1!=t.scale});a.img=u,a.exif=c,a.canvas=i,e(a)},u.src=s.fileToBase64(i.type,h)},r.readAsArrayBuffer(i)})},this.getImageDim=function(e,t){t=t||0;var i=t>0&&e.width>t,n=t>0&&e.height>t,s={width:e.width,height:e.height,scale:1};if(i||n){var o=e.width,r=e.height;e.width>e.height?(r=t*r/o,o=t):(o=t*o/r,r=t),s.scale=e.width/o,s.width=o,s.height=r}return s},this.getCanvas=function(e,i){var n={width:e.width||0,height:e.height||0,orientation:0,scaled:!1,canvas:null};for(var s in i)n[s]=i[s];if(!t.CANVAS)return null;var o=n.canvas||document.createElement("canvas");o.width=n.width,o.height=n.height;var r=o.getContext("2d"),a=!0;if(n.orientation)switch(n.orientation){case 2:r.translate(n.width,0),r.scale(-1,1);break;case 180:case 3:r.translate(n.width,n.height),r.rotate(Math.PI);break;case 4:r.translate(0,n.height),r.scale(1,-1);break;case 5:o.width=n.height,o.height=n.width,r.rotate(.5*Math.PI),r.scale(1,-1),n.scaled&&(r.clearRect(0,0,o.width,o.height),r.drawImage(e,0,0,e.width,e.height,0,0,o.height,o.width),a=!1);break;case 90:case 6:o.width=n.height,o.height=n.width,r.rotate(.5*Math.PI),r.translate(0,-n.height),n.scaled&&(r.clearRect(0,0,o.width,o.height),r.drawImage(e,0,0,e.width,e.height,0,0,o.height,o.width),a=!1);break;case 7:o.width=n.height,o.height=n.width,r.rotate(.5*Math.PI),r.translate(n.width,-n.height),r.scale(-1,1),n.scaled&&(r.clearRect(0,0,o.width,o.height),r.drawImage(e,0,0,e.width,e.height,0,0,o.height,o.width),a=!1);break;case 270:case 8:o.width=n.height,o.height=n.width,r.rotate(-.5*Math.PI),r.translate(-n.width,0),n.scaled&&(r.clearRect(0,0,o.width,o.height),r.drawImage(e,0,0,e.width,e.height,0,0,o.height,o.width),a=!1)}return a&&(r.clearRect(0,0,o.width,o.height),n.scaled?r.drawImage(e,0,0,e.width,e.height,0,0,o.width,o.height):r.drawImage(e,0,0)),o},this.fileToBase64=function(e,t){for(var i=t.length,n="",s=0;s<i;s+=1)n+=String.fromCharCode(t[s]);return"data:"+e+";base64,"+btoa(n)},this.isPicture=function(e){return e&&("image/jpeg"==e.type||"image/pjpeg"==e.type||"image/png"==e.type)},this.getPictureFiles=function(e){var t=[];if(e&&e.length)for(var i=0;i<e.length;i++){var n=e[i];this.isPicture(n)&&t.push(n)}return t},this.getPicturesCount=function(e){return this.getPictureFiles(e).length},this.getEXIF=function(e){return"EXIF"in window?EXIF.readFromBinaryFile(e):{}}}]),onix.factory("$job",["$promise",function(e){var t=function(){function t(){_classCallCheck(this,t),this._isRunning=!1,this._tasks=[],this._taskDone={cb:null,scope:null}}return _createClass(t,[{key:"add",value:function(e,t,i){i=i||[],Array.isArray(i)||(i=[i]),this._tasks.push({task:e,scope:t,args:i})}},{key:"start",value:function(){var t=this;return new e(function(e,i){return t._isRunning||!t._tasks.length?void i():(t._isRunning=!0,t._tasks.reverse(),void t._doJob(e))})}},{key:"clear",value:function(){this._tasks=[]}},{key:"setTaskDone",value:function(e,t){this._taskDone.cb=e,this._taskDone.scope=t}},{key:"_doJob",value:function(e){var t=this._tasks.length;if(0==t)this._isRunning=!1,e();else{var i=this._tasks.pop();i.task.apply(i.scope||i.task,i.args.concat(function(){if(this._taskDone.cb){var t=Array.prototype.slice.call(arguments,0);this._taskDone.cb.apply(this._taskDone.scope||this._taskDone.cb,t)}this._doJob(e)}.bind(this)))}}}]),t}();return{create:function(){return new t},multipleJobs:function(t,i,n){for(var s=t.length,o=[],r=0;r<s;r++){var a=i>0?r%i:r,h=t[r];o[a]||(o[a]=this.create(),n&&o[a].setTaskDone(n.cb,n.scope)),o[a].add(h.task,h.scope,h.args)}var c=[];return o.forEach(function(e){c.push(e.start())}),e.all(c)}}}]),onix.factory("$localStorage",["$features",function(e){var t=e.LOCAL_STORAGE?window.localStorage:{_data:{},setItem:function(e,t){e&&(this._data[e]=t)},getItem:function(e){return e?this._data[e]:null},removeItem:function(e){e&&e in this._data&&delete this._data[e]}};return{set:function(e,i){t.setItem(e,i)},get:function(e){return t.getItem(e)},remove:function(e){t.removeItem(e)}}}]),onix.service("$location",function(){this.refresh=function(){location.reload()},this.createSearchURL=function(e){var t=this.objToURL(e);return t?"?"+t:""},this.objToURL=function(e){var t=[];return Array.isArray(e)?e.forEach(function(e){t.push(encodeURIComponent(e.name)+"="+encodeURIComponent(e.value))}):"object"===("undefined"==typeof e?"undefined":_typeof(e))&&Object.keys(e).forEach(function(i){t.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]))}),t.join("&")},this.search=function(e){if(!e)return this.parseSearch();var t=this.createSearchURL(e);t&&(location.search=t)},this.get=function(){return location.pathname+location.search},this.decodeSearchValue=function(e){return decodeURIComponent(e.replace(/\+/g," "))},this.parseSearch=function(e){e=e||location.search.substring(1);for(var t=void 0,i=/([^&=]+)=?([^&]*)/g,n={};t=i.exec(e);){var s=this.decodeSearchValue(t[1]),o=this.decodeSearchValue(t[2]);s in n?(Array.isArray(n[s])||(n[s]=[n[s]]),n[s].push(o)):n[s]=o}return n},this.parseURL=function(e,t){var i=this,n={autoNumber:!1,hints:{}},s={protocol:"",host:"",port:null,path:"",search:null,hash:""};for(var o in t)n[o]=t[o];e=(e||"").trim();var r=e.match(/([a-zA-Z0-9]+):\/\//);return r&&(s.protocol=r[1],e=e.replace(r[0],"")),r=e.match(/^[^?:#\/]+/),r&&(s.host=r[0],e=e.replace(s.host,"")),r=e.match(/^:([0-9]+)[\/?#]?/),r&&(s.port=parseFloat(r[1]),e=e.replace(":"+r[1],"")),r=e.match(/^[^?#]+/),r&&(s.path=r[0],e=e.replace(s.path,"")),r=e.match(/\?([^#]+)/),r&&!function(){var t=i.parseSearch(r[1]);Object.keys(t).forEach(function(e){var i=t[e];if(e in n.hints){var s=n.hints[e];if("string"==typeof s)switch(n.hints[e]){case"json":try{t[e]=JSON.parse(i)}catch(o){console.error(o)}break;case"number":t[e]=parseFloat(i)}else"function"==typeof s&&(t[e]=s(i))}else if(n.autoNumber){var r=i.match(/^[-]?[0-9]+\.?[0-9e]*$/);if(r){var a=parseFloat(r[0]);t[e]=isNaN(a)?i:a}}}),s.search=t,e=e.replace(r[0],"")}(),r=e.match(/#(.*)$/),r&&(s.hash=r[1]),s}}),onix.service("$math",function(){this._CONST={ZOOM:156543.034},this.isBBoxIntersection=function(e,t){var i=Math.max(e.x,t.x),n=Math.max(e.y,t.y),s=Math.min(e.x+e.width,t.x+t.width),o=Math.min(e.y+e.height,t.y+t.height),r=Math.abs(s-i),a=Math.abs(o-n);return i<=s&&n<=o&&r*a>0},this.getBBox=function(e){for(var t=1/0,i=1/0,n=-(1/0),s=-(1/0),o=0;o<e.length;o++)t=Math.min(e[o].x,t),i=Math.min(e[o].y,i),n=Math.max(e[o].x,n),s=Math.max(e[o].y,s);return{x:t,y:i,width:Math.abs(n-t),height:Math.abs(s-i)}},this.det2=function(e,t,i,n){return e*n-i*t},this.linesIntersection=function(e,t){var i=1e-6,n=this.det2(e.x1-e.x2,e.y1-e.y2,t.x1-t.x2,t.y1-t.y2);if(Math.abs(n)<i)return null;var s=this.det2(e.x1,e.y1,e.x2,e.y2),o=this.det2(t.x1,t.y1,t.x2,t.y2),r=this.det2(s,e.x1-e.x2,o,t.x1-t.x2)/n,a=this.det2(s,e.y1-e.y2,o,t.y1-t.y2)/n;return r<Math.min(e.x1,e.x2)-i||r>Math.max(e.x1,e.x2)+i?null:a<Math.min(e.y1,e.y2)-i||a>Math.max(e.y1,e.y2)+i?null:r<Math.min(t.x1,t.x2)-i||r>Math.max(t.x1,t.x2)+i?null:a<Math.min(t.y1,t.y2)-i||a>Math.max(t.y1,t.y2)+i?null:{x:Math.round(r),y:Math.round(a)}},this.pointBBoxIntersection=function(e,t){return e.x>=t.x&&e.x<=t.x+t.width&&e.y>=t.y&&e.y<=t.y+t.height},this.log2=function(e){return Math.log(e)/Math.log(2)},this.zoomToDistance=function(e,t,i){var n=this._CONST.ZOOM/Math.pow(2,e),s=i/2,o=Math.floor(n*s),r=t/360*Math.PI;return Math.floor(o/Math.tan(r))},this.distanceToZoom=function(e,t,i){var n=t/360*Math.PI,s=Math.tan(n)*e,o=2*s/i;return Math.floor(this.log2(this._CONST.ZOOM/o))},this.movePointByAngle=function(e,t){var i=(360-t)/180*Math.PI,n=e.x,s=e.y;e.x=n*Math.cos(i)-s*Math.sin(i),e.y=n*Math.sin(i)+s*Math.cos(i)},this.movePointByVector=function(e,t,i){var n={x:t.x,y:t.y};this.movePointByAngle(n,i||0),e.x+=n.x,e.y+=n.y},this.setRange=function(e,t,i){return e<t?t:e>i?i:e},this.getMiddleAngle=function(e,t){e=e||0,t=t||0;var i=(e+t)/2%180;return i<0?360+i:i}}),onix.factory("$myQuery",["$common",function(e){var t=function(){function t(e,i){return _classCallCheck(this,t),this._els=this._getElementsFromValue(e,i),this._eventsCache={},this}return _createClass(t,[{key:"_getElementsFromValue",value:function(i,n){i=Array.isArray(i)?i:[i];var s=[];return i.forEach(function(i){if("string"!=typeof i)i&&i instanceof t&&(i=i.getEl()),(e.isElement(i)||i==document||i==window)&&s.push(i);else if(i.match(/[<]\s*[a-zA-Z0-9]+[^>]*[>]/)){var o=document.createDocumentFragment(),r=document.createElement("div");for(r.insertAdjacentHTML("afterbegin",i);r.firstChild;)o.appendChild(r.firstChild);s.push(o)}else{n&&n instanceof t&&(n=n.getEl()),n=n&&n instanceof Element||n==window||n==document?n:document;var a=n.querySelectorAll(i);a&&(s=s.concat(Array.prototype.slice.call(a)))}}),s}},{key:"_operation",value:function(e,t){Array.isArray(this._els)||(this._els=Array.prototype.slice.call(this._els)),this._els.forEach(function(i,n){e.apply(t||e,[i,n])})}},{key:"_setGetAll",value:function(e,t){var i=this;if("undefined"==typeof e)return this;if("undefined"!=typeof t)return this._operation(function(i){i[e]=t}),this;var n=function(){var t=[];return i._operation(function(i){t.push(i[e])}),t.length?1==t.length?{v:t[0]}:{v:t}:{v:null}}();return"object"===("undefined"==typeof n?"undefined":_typeof(n))?n.v:void 0}},{key:"_bindEvent",value:function(e,t,i){var n=this;return this._operation(function(s){n._eventsCache[e]||(n._eventsCache[e]=[]);var o={item:s,cb:t,bindFn:function(e){t.apply(i||s,[e,s,n])}};n._eventsCache[e].push(o),s.addEventListener(e,o.bindFn)}),this}},{key:"get",value:function(e){return e=e||0,e>this._els.length?null:this._els[e]}},{key:"getEl",value:function(e){return this.get(e)}},{key:"attr",value:function(e,t){var i=this;if("undefined"==typeof e)return this;if("undefined"!=typeof t)return this._operation(function(i){i.setAttribute(e,t)}),this;var n=function(){var t=[];return i._operation(function(i){t.push(i.getAttribute(e))}),t.length?1==t.length?{v:t[0]}:{v:t}:{v:null}}();return"object"===("undefined"==typeof n?"undefined":_typeof(n))?n.v:void 0}},{key:"css",value:function(t,i){var n=this;if("undefined"!=typeof t){if("undefined"!=typeof i)return this._operation(function(n){n.style[e.cssNameToJS(t)]=i}),this;if("object"!==("undefined"==typeof t?"undefined":_typeof(t))||Array.isArray(t)){var s=this.getEl();return s?s.style[e.cssNameToJS(t)]:null}return Object.keys(t).forEach(function(i){n._operation(function(n){n.style[e.cssNameToJS(i)]=t[i]})}),this}return this}},{key:"src",value:function(e){return this._setGetAll("src",e)}},{key:"hide",value:function(){return this.css("display","none")}},{key:"show",value:function(e){return this.css("display",e||"")}},{key:"val",value:function(e){return this._setGetAll("value",e)}},{key:"html",value:function(e){return this._setGetAll("innerHTML",e)}},{key:"addClass",value:function(e){return this._operation(function(t){t.classList.add(e)}),this}},{key:"removeClass",value:function(e){return this._operation(function(t){t.classList.remove(e)}),this}},{key:"toggleClass",value:function(e){return this._operation(function(t){t.classList.toggle(e)}),this}},{key:"width",value:function i(){var i=0;return this._operation(function(e){i+=e.offsetWidth}),i}},{key:"height",value:function n(){var n=0;return this._operation(function(e){n+=e.offsetHeight}),n}},{key:"click",value:function(e,t){return this._bindEvent("click",e,t)}},{key:"change",value:function(e,t){return this._bindEvent("change",e,t)}},{key:"mouseenter",value:function(e,t){return this._bindEvent("mouseenter",e,t)}},{key:"mouseleave",value:function(e,t){return this._bindEvent("mouseleave",e,t)}},{key:"mousemove",value:function(e,t){return this._bindEvent("mousemove",e,t)}},{key:"mousewheel",value:function(e,t){return this._bindEvent("DOMMouseScroll",e,t)._bindEvent("mousewheel",e,t)}},{key:"keydown",value:function(e,t){return this._bindEvent("keydown",e,t)}},{key:"keyup",value:function(e,t){return this._bindEvent("keyup",e,t)}},{key:"keypress",value:function(e,t){return this._bindEvent("keypress",e,t)}},{key:"blur",value:function(e,t){return this._bindEvent("blur",e,t)}},{key:"focus",value:function(e,t){return this._bindEvent("focus",e,t)}},{key:"each",value:function(e,t){return this._operation(function(i,n){e.apply(t||e,[i,n])}),this}},{key:"forEach",value:function(e,t){return this.each(e,t)}},{key:"remove",value:function(){return this._operation(function(e){e.parentNode.removeChild(e)}),this}},{key:"append",value:function(e){return e=this._getElementsFromValue(e),e.length&&this._operation(function(t,i){var n=i?e[0].cloneNode(!0):e[0];t.appendChild(n)}),this}},{key:"prepend",value:function(e){return e=this._getElementsFromValue(e),e.length&&this._operation(function(t,i){var n=i?e[0].cloneNode(!0):e[0];t.insertBefore(n,t.firstChild)}),this}},{key:"insertBefore",value:function(e){e=this._getElementsFromValue(e);var t=this.getEl();return t&&e.length&&e[0].parentNode.insertBefore(t,e[0]),this}},{key:"empty",value:function(){return this._operation(function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}),this}},{key:"len",value:function(){return this._els.length}},{key:"parent",value:function(){var e=this.getEl();return e?new this(e):null}},{key:"children",value:function(){var e=this.getEl();return e?e.children:[]}},{key:"scrollTop",value:function(){var e=this.getEl(),t=document.body.scrollTop;return e?e.scrollTop+t:t+0}},{key:"scrollLeft",value:function(){var e=this.getEl(),t=document.body.scrollLeft;return e?e.scrollLeft+t:t+0}},{key:"bind",value:function(e,t,i){return e&&"function"==typeof t&&this._bindEvent(e,t,i),this}},{key:"unbind",value:function(e,t){if(e)for(var i=this._eventsCache[e]||[],n=i.length-1,s=n;s>=0;s--){var o=i[s];(!t||"function"==typeof t&&o.cb==t)&&(o.item.removeEventListener(e,o.bindFn),i.splice(s,1))}return this}}]),t}();return onix.element=function(e,i){return new t(e,i)},{get:function(e,i){return new t(e,i)}}}]),onix.run(["$myQuery",function(){}]),onix.factory("$promise",function(){var e=function(){function e(t){if(_classCallCheck(this,e),this._STATES={IDLE:0,RESOLVED:1,REJECTED:2},this._state=this._STATES.IDLE,this._thens=[],this._fulfillData=null,t&&"function"==typeof t)try{t.apply(t,[this._resolve.bind(this),this._reject.bind(this)])}catch(i){console.error("$promise exception "+i)}}return _createClass(e,[{key:"_resolve",value:function(e){this._fulfillData=e,this._state=this._STATES.RESOLVED,this._resolveFuncs()}},{key:"_reject",value:function(e){this._fulfillData=e,this._state=this._STATES.REJECTED,this._resolveFuncs()}},{key:"_resolveFuncs",value:function(){for(var t=this,i=this._thens.length,n=this._state==this._STATES.REJECTED,s=0;s<i;s++){var o=this._thens[s],r=n&&o.rejectCb?o.rejectCb:!n&&o.resolveCb?o.resolveCb:null;if(r)try{var a=r(this._fulfillData);if(a&&s!=i-1){var h=function(){var i=null,n=t._thens.slice(s+1),o=void 0;return o=a instanceof e?a:new e(function(e){i=e}),n.forEach(function(e){o.then(e.resolveCb,e.rejectCb)}),i&&i(a),"break"}();if("break"===h)break}}catch(c){console.error(c)}}this._thens.length=0}},{key:"_isAlreadyFinished",value:function(){this._state!=this._STATES.IDLE&&this._resolveFuncs()}},{key:"then",value:function(e,t){return this._thens.push({resolveCb:e&&"function"==typeof e?e:null,rejectCb:t&&"function"==typeof t?t:null}),this._isAlreadyFinished(),this}},{key:"catch",value:function(e){return this._thens.push({resolveCb:null,rejectCb:e&&"function"==typeof e?e:null}),this._isAlreadyFinished(),this}}],[{key:"_multiplePromises",value:function(t,i){return new e(function(e){Array.isArray(t)&&t.length?!function(){var n=i?1:t.length,s=function(t){n--,0==n&&e(i?t:null)};t.forEach(function(e){e.then(function(e){s(e)},function(e){s(e)})})}():e()})}},{key:"all",value:function(t){return e._multiplePromises(t)}},{key:"race",value:function(t){return e._multiplePromises(t,!0)}},{key:"resolve",value:function(t){return new e(function(e){e(t)})}},{key:"reject",value:function(t){return new e(function(e,i){i(t)})}}]),e}();return e}),onix.service("$route",["$location","$template","$di","$routeParams",function(e,t,i,n){this._routes=[],this._otherwise=null,this._setRouteParams=function(e){Object.keys(n).forEach(function(e){delete n[e]}),e=e||{},Object.keys(e).forEach(function(t){n[t]=e[t]})},this.when=function(e,t){return this._routes.push({url:e,config:t}),this},this.otherwise=function(e){return this._otherwise={config:e},this},this._runController=function(e,t){var n=i.parseParam(e);this._setRouteParams(t),i.run({fn:n.fn,inject:n.inject})},this.go=function(){var i=this,n=e.get(),s=!1,o=null;this._routes.every(function(e){return n!=e.url&&!n.match(new RegExp(e.url))||(o=e.config,s=!0,!1)}),!s&&this._otherwise&&(o=this._otherwise.config),o&&!function(){var e="",n=null,s=null,r={};Object.keys(o).forEach(function(t){var i=o[t];switch(t){case"templateId":e=i;break;case"templateUrl":n=i;break;case"controller":s=i;break;default:r[t]=i}});var a=function(){s&&i._runController(s,r)};n?t.load(o.templateId||o.templateUrl,o.templateUrl).then(a):a()}()}}]),onix.factory("$routeParams",function(){return{}}),onix.provider("$template",function(){var e={left:"{{",right:"}}",elEventPrefix:"data-event-",elDataBind:"data-bind"};this.setConfig=function(t){Object.keys(t).forEach(function(i){e[i]=t[i]})},this.$get=["$common","$promise","$http","$filter",function(t,i,n,s){var o=function(){function t(){_classCallCheck(this,t),this._cache={},this._RE={VARIABLE:/^[$_a-zA-Z][$_a-zA-Z0-9]+$/,NUMBERS:/^[-]?[0-9]+[.]?([0-9e]+)?$/,STRINGS:/^["'][^"']+[\"']$/},this._CONST={FILTER_DELIMETER:"|",FILTER_PARAM_DELIMETER:":",TEMPLATE_SCRIPT_SELECTOR:"script[type='text/template']"},this._init()}return _createClass(t,[{key:"_parseFnName",value:function(e){e=e||"";var t=e.match(/^\s*([a-zA-Z0-9_$]+)/);return t?t[1]:""}},{key:"_parseArgs",value:function(e,t){var i=this;e=e||"",t=t||{};var n=onix.match(e,"(",")"),s=n.length?n[0]:"",o=onix.split(s),r=[],a=[];return o.forEach(function(e){var n=e,o=null;if(e=e.trim(),e.match(i._RE.VARIABLE))switch(e){case"$event":o=t.event;break;case"$element":o=t.el;break;case"undefined":o=void 0;break;case"null":default:o=null}else e.match(i._RE.STRINGS)?o=e.substr(1,e.length-2):e.match(i._RE.NUMBERS)?o=parseFloat(e):!function(){var t=onix.match(e,"[","]"),i=onix.match(e,"{","}");if(t.length)try{o=JSON.parse("["+t[0]+"]")}catch(n){console.error(n)}else i.length&&(o=function(){return new Function(i[0])})}();a.push({value:o,pos:s.indexOf(n)})}),a.length&&a.sort(function(e,t){return e.pos-t.pos}).forEach(function(e){r.push(e.value)}),r}},{key:"_bindEvent",value:function(e,t,i){var n=this;if(e&&t&&i){var s=this._parseFnName(t.value);t.name&&s in i&&e.addEventListener(t.name,function(o){var r=n._parseArgs(t.value,{el:e,event:o});i[s].apply(i,r)})}}},{key:"_getAttributes",value:function(t){var i=[];return t&&"attributes"in t&&Object.keys(t.attributes).forEach(function(n){var s=t.attributes[n];if(s&&"object"===("undefined"==typeof s?"undefined":_typeof(s))&&s.name){var o=s.name==e.elDataBind,r=s.name.indexOf(e.elEventPrefix)!=-1;(o||r)&&i.push({isBind:o,name:r?s.name.replace(e.elEventPrefix,""):s.name,value:s.value})}}),i}},{key:"_init",value:function(){var e=this;onix.element(this._CONST.TEMPLATE_SCRIPT_SELECTOR).forEach(function(t){e.add(t.id||"",t.innerHTML)})}},{key:"add",value:function(e,t){this._cache[e]=t}},{key:"compile",value:function(t,i){var n=this;if(!t||!i)return"";var o=this.get(t),r=onix.match(o,e.left,e.right);return r.forEach(function(t){var r=e.left+t+e.right;if(t.indexOf(n._CONST.FILTER_DELIMETER)!=-1)!function(){var e=void 0;t.split(n._CONST.FILTER_DELIMETER).forEach(function(t,o){t=t.trim(),o?!function(){var i=[e],o=t.split(n._CONST.FILTER_PARAM_DELIMETER),r="";1==o.length?r=o[0].trim():o.forEach(function(e,t){e=e.trim(),t?i.push(e):r=e});var a=s(r);e=a.apply(a,i)}():t in i&&(e=i[t])}),o=o.replace(r,e||"")}();else{var a="";t=t.trim(),t in i&&(a=i[t]),o=o.replace(r,a)}}),o}},{key:"get",value:function(e){return this._cache[e]||""}},{key:"bindTemplate",value:function(e,t,i){var n=this,s=onix.element("*",e);s.len()&&!function(){var e={};s.forEach(function(i){var s=n._getAttributes(i);s.forEach(function(s){s.isBind?e[s.value]=i:n._bindEvent(i,s,t)})}),i&&"function"==typeof i&&i(e)}()}},{key:"load",value:function(e,t){var s=this;return new i(function(i,o){n.createRequest({url:t}).then(function(t){s.add(e,t.data),i()},function(e){o(e)})})}}]),t}();return new o}]}),onix.service("$features",function(){this.FILE_READER="FileReader"in window,this.CANVAS=!!document.createElement("canvas").getContext;var e=!0;try{window.localStorage}catch(t){e=!1}this.LOCAL_STORAGE=e,this.MEDIA_QUERY="matchMedia"in window&&"matches"in window.matchMedia("(min-width: 500px)");var i="DOMMouseScroll";"onwheel"in window?i="wheel":"onmousewheel"in window&&(i="mousewheel"),this.MOUSE_WHEEL_EVENT_NAME=i}),onix.factory("$anonymizer",["$math","$event","$loader","$promise","$common","$features",function(e,t,i,n,s,o){var r=function(t){function r(e,t){_classCallCheck(this,r);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this));if(!o.CANVAS)return console.error("Canvas is not available!"),_possibleConstructorReturn(n);n._parent=e,n._parent.classList.add("anonymizer"),n._opts={canWidth:e.offsetWidth||0,canHeight:e.offsetHeight||0,zoom:100,minZoom:20,maxZoom:100,zoomStep:10,zoomMoveStep:1,curEntity:r.ENTITES.CIRCLE,showPreview:!0,previewLeft:17,previewTop:17,previewWidth:200,entityPreview:null};for(var s in t)n._opts[s]=t[s];return n._canWidth=n._opts.canWidth,n._canHeight=n._opts.canHeight,n._zoom=n._opts.zoom,n._zoomStep=n._opts.zoomStep,n._zoomMoveStep=0,n._curWidth=0,n._curHeight=0,n._canvas=document.createElement("canvas"),n._canvas.width=n._canWidth,n._canvas.height=n._canHeight,n._ctx=n._canvas.getContext("2d"),n._img=null,n._imgWidth=0,n._imgHeight=0,n._lineCanvas=null,n._lineCanvasCtx=null,n._entityCanvas=null,n._entityCanvasCtx=null,n._entites=[],n._x=0,n._y=0,n._THRESHOLD={MIN:-1,MAX:1},n._mouse={startXSave:0,startYSave:0,startX:0,startY:0,bcr:null},n._flags={wasRightClick:!1,wasMove:!1,wasPreview:!1,wasLine:!1,wasImgMove:!1},n._binds={mouseWheel:n._mouseWheel.bind(n),mouseDown:n._mouseDown.bind(n),mouseMove:n._mouseMove.bind(n),mouseUp:n._mouseUp.bind(n),mouseMoveLine:n._mouseMoveLine.bind(n),mouseUpLine:n._mouseUpLine.bind(n),contextMenu:n._cancelEvents.bind(n)},n._canvas.addEventListener("DOMMouseScroll",n._binds.mouseWheel),n._canvas.addEventListener("mousewheel",n._binds.mouseWheel),n._canvas.addEventListener("mousedown",n._binds.mouseDown),n._canvas.addEventListener("contextmenu",n._binds.contextMenu),n._spinner=i.getSpinner(),e.appendChild(n._spinner),e.appendChild(n._canvas),n._opts.entityPreview&&(n._entityCanvas=document.createElement("canvas"),n._entityCanvas.width=300,n._entityCanvas.height=150,n._entityCanvasCtx=n._entityCanvas.getContext("2d"),n._opts.entityPreview.appendChild(n._entityCanvas)),n}return _inherits(r,t),_createClass(r,[{key:"_redraw",value:function(){var e=this;this._ctx.clearRect(0,0,this._canWidth,this._canHeight),this._ctx.drawImage(this._img,this._x,this._y,this._img.width,this._img.height,0,0,this._curWidth,this._curHeight),this._entites.length&&!function(){var t=e._zoom/100,i=e._x*t,n=e._y*t;e._entites.forEach(function(s){var o=void 0,a=void 0;switch(s.id){case r.ENTITES.CIRCLE.id:var h=Math.round(s.value*t);o=Math.round(e._curWidth*s.xRatio-i),a=Math.round(e._curHeight*s.yRatio-n),e._drawCircle(e._ctx,o,a,h);break;case r.ENTITES.LINE.id:var c=Math.round(s.value*t);o=Math.round(e._curWidth*s.xRatio-i),a=Math.round(e._curHeight*s.yRatio-n);var u=Math.round(e._curWidth*s.x2Ratio-i),l=Math.round(e._curHeight*s.y2Ratio-n);e._drawLine(e._ctx,o,a,u,l,c)}})}(),this._drawPreview()}},{key:"_setWhiteCanvas",value:function(){this._ctx.clearRect(0,0,this._canWidth,this._canHeight),this._drawFillRect(this._ctx,0,0,this._canWidth,this._canHeight,"#fff")}},{key:"_drawCircle",value:function(e,t,i,n){e.beginPath(),e.arc(t,i,n,0,2*Math.PI),e.fillStyle=r.ENTITES.CIRCLE.fillStyle,e.closePath(),e.fill()}},{key:"_drawLine",value:function(e,t,i,n,s,o){e.beginPath(),e.moveTo(t,i),e.lineTo(n,s),e.lineWidth=o,e.strokeStyle=r.ENTITES.LINE.strokeStyle,e.closePath(),e.stroke()}},{key:"_drawFillRect",value:function(e,t,i,n,s,o){e.beginPath(),e.fillStyle=o||"",e.fillRect(t,i,n,s),e.closePath()}},{key:"_drawRect",value:function(e,t,i,n,s,o,r){e.beginPath(),e.rect(t,i,n,s),e.lineWidth=r||1,e.strokeStyle=o||"",e.closePath(),e.stroke()}},{key:"_drawPreview",value:function(){if(this._opts.showPreview){var t=this._imgWidth/this._imgHeight,i=Math.round(this._opts.previewWidth/t);this._drawFillRect(this._ctx,this._opts.previewLeft-1,this._opts.previewTop-1,this._opts.previewWidth+2,i+2,"rgba(255, 255, 255, 0.5)"),this._ctx.drawImage(this._img,0,0,this._img.width,this._img.height,this._opts.previewLeft,this._opts.previewTop,this._opts.previewWidth,i);var n=this._zoom/100,s=this._x*n,o=this._y*n,r=s/this._curWidth,a=o/this._curHeight,h=(s+this._canWidth)/this._curWidth,c=(o+this._canHeight)/this._curHeight;r=e.setRange(r,0,1),a=e.setRange(a,0,1),h=e.setRange(h,0,1),c=e.setRange(c,0,1);var u=Math.round(this._opts.previewLeft+r*this._opts.previewWidth),l=Math.round(this._opts.previewTop+a*i),d=Math.round(this._opts.previewLeft+h*this._opts.previewWidth),_=Math.round(this._opts.previewTop+c*i);this._drawRect(this._ctx,u,l,d-u,_-l,"#C01",1)}}},{key:"_drawEntityPreview",value:function(){if(this._opts.entityPreview){var e=this._entityCanvas.width,t=this._entityCanvas.height;this._entityCanvasCtx.clearRect(0,0,e,t),this._drawFillRect(this._entityCanvasCtx,0,0,e,t,"#f9f9f9");var i=this._opts.curEntity,n=this._zoom/100;switch(i.id){case r.ENTITES.CIRCLE.id:var s=Math.round(i.value*n),o=Math.round(e/2),a=Math.round(t/2);this._drawCircle(this._entityCanvasCtx,o,a,s);break;case r.ENTITES.LINE.id:var h=Math.round(.2*e),c=Math.round(t/2),u=Math.round(.8*e),l=Math.round(i.value*n);this._drawLine(this._entityCanvasCtx,h,c,u,c,l)}}}},{key:"_getFromPoint",value:function(e,t){var i={x:e||Math.round(this._canWidth/2),y:t||Math.round(this._canHeight/2)},n=this._zoom/100,s=Math.round(this._x*n)+i.x,o=Math.round(this._y*n)+i.y;return i.xRatio=s/this._curWidth,i.yRatio=o/this._curHeight,i}},{key:"_postZoom",
value:function(){var e=this._zoom/100;this._curWidth=Math.round(this._img.width*e),this._curHeight=Math.round(this._img.height*e),this._zoom<100&&(this._zoomMoveStep=Math.max((100-this._zoom)/10*this._opts.zoomMoveStep/2,1))}},{key:"_setCenter",value:function(){this._setPosition(.5,.5)}},{key:"_setPosition",value:function(t,i,n,s){n=n||this._canWidth/2,s=s||this._canHeight/2,t=e.setRange(t,0,1),i=e.setRange(i,0,1);var o=this._zoom/100,r=this._curWidth*t-n,a=this._curHeight*i-s;this._x=Math.max(Math.round(r/o),0),this._y=Math.max(Math.round(a/o),0)}},{key:"_alignImgToCanvas",value:function(){var e=Math.max(this._curWidth-this._canWidth,0),t=Math.round(this._x*this._zoom/100);this._x<0?this._x=0:t>e&&(this._x=Math.round(100*e/this._zoom));var i=Math.max(this._curHeight-this._canHeight,0),n=Math.round(this._y*this._zoom/100);this._y<0?this._y=0:n>i&&(this._y=Math.round(100*i/this._zoom))}},{key:"_isRightClick",value:function(e){return!(!e||!(e.which&&3==e.which||e.button&&2==e.button))}},{key:"_cancelEvents",value:function(e){s.cancelEvents(e)}},{key:"_mouseWheel",value:function(e){if(this._imgWidth||this._imgHeight){var t=e.wheelDelta||-e.detail;if(t){this._cancelEvents(e),this._setBCR();var i=this._getMouseXY(e),n=this._getFromPoint(i.x,i.y);t>0?this._setZoom(this._zoom+this._zoomStep,n):this._setZoom(this._zoom-this._zoomStep,n)}}}},{key:"_getMouseXY",value:function(e){return{x:e.clientX-this._mouse.bcr.left,y:e.clientY-this._mouse.bcr.top}}},{key:"_setBCR",value:function(){this._mouse.bcr=this._canvas.getBoundingClientRect()}},{key:"_mouseDown",value:function(e){if(this._imgWidth||this._imgHeight){this._cancelEvents(e),this._setBCR();var t=this._getMouseXY(e);if(this._mouse.startXSave=t.x,this._mouse.startYSave=t.y,this._mouse.startX=this._mouse.startXSave,this._mouse.startY=this._mouse.startYSave,this._flags.wasMove=!1,this._flags.wasRightClick=this._isRightClick(e),this._opts.curEntity==r.ENTITES.CIRCLE)this._flags.wasImgMove=!1,this._flags.wasPreview=!1,document.addEventListener("mousemove",this._binds.mouseMove),document.addEventListener("mouseup",this._binds.mouseUp);else if(this._opts.curEntity==r.ENTITES.LINE){var i=document.createElement("canvas");i.width=this._canWidth,i.height=this._canHeight,i.classList.add("line-canvas"),this._flags.wasPreview=!1,this._flags.wasLine=!1,this._lineCanvas=i,this._lineCanvas.addEventListener("contextmenu",this._binds.contextMenu),document.addEventListener("mousemove",this._binds.mouseMoveLine),document.addEventListener("mouseup",this._binds.mouseUpLine),this._flags.wasRightClick&&this._lineCanvas.classList.add("is-dragged"),this._lineCanvasCtx=this._lineCanvas.getContext("2d"),this._parent.appendChild(i)}}}},{key:"_imgMove",value:function(e,t){var i=this._mouse.startX-e,n=this._mouse.startY-t;if(0!=i||0!=n){var s=this._zoomMoveStep>0?this._zoomMoveStep:1;this._x=i*s+this._x,this._y=n*s+this._y,this._alignImgToCanvas(),this._redraw()}}},{key:"_mouseMove",value:function(e){var t=this._getMouseXY(e);this._flags.wasMove||this._canvas.classList.add("is-dragged"),this._flags.wasMove=!0;var i=this._isPreview(t.x,t.y);this._flags.wasRightClick||this._flags.wasImgMove||!i?this._flags.wasPreview||(this._flags.wasImgMove=!0,this._imgMove(t.x,t.y)):(this._flags.wasPreview=!0,this._setPosition(i.xRatio,i.yRatio),this._alignImgToCanvas(),this._redraw()),this._mouse.startX=t.x,this._mouse.startY=t.y}},{key:"_isPreview",value:function(e,t){if(!this._opts.showPreview)return null;var i=this._imgWidth/this._imgHeight,n=this._opts.previewWidth,s=Math.round(this._opts.previewWidth/i),o=this._opts.previewLeft,r=this._opts.previewTop;this._zoom/100;return e=e||0,t=t||0,e>=o&&e<=o+n&&t>=r&&t<=r+s?{xRatio:(e-o)/n,yRatio:(t-r)/s}:null}},{key:"_mouseUp",value:function(e){var t=this._getMouseXY(e),i=!1;if(this._flags.wasMove){var n=this._mouse.startXSave-t.x,s=this._mouse.startYSave-t.y;n>=this._THRESHOLD.MIN&&n<=this._THRESHOLD.MAX&&s>=this._THRESHOLD.MIN&&s<=this._THRESHOLD.MAX&&(i=!0)}if(!this._flags.wasRightClick&&(!this._flags.wasMove||i)){var o=this._isPreview(t.x,t.y);if(o)this._setPosition(o.xRatio,o.yRatio),this._alignImgToCanvas(),this._redraw();else{var r=this._zoom/100,a=Math.round(this._x*r)+t.x,h=Math.round(this._y*r)+t.y;this._entites.push({id:this._opts.curEntity.id,value:this._opts.curEntity.value,xRatio:a/this._curWidth,yRatio:h/this._curHeight}),this._redraw()}}this._canvas.classList.remove("is-dragged"),document.removeEventListener("mousemove",this._binds.mouseMove),document.removeEventListener("mouseup",this._binds.mouseUp)}},{key:"_mouseMoveLine",value:function(e){var t=this._getMouseXY(e);if(this._flags.wasMove=!0,this._flags.wasRightClick)this._imgMove(t.x,t.y),this._mouse.startX=t.x,this._mouse.startY=t.y;else{var i=this._isPreview(t.x,t.y),n=this._flags.wasPreview;if(!this._flags.wasLine&&i)this._flags.wasPreview=!0,this._setPosition(i.xRatio,i.yRatio),this._alignImgToCanvas(),this._redraw();else if(!this._flags.wasPreview){this._flags.wasLine=!0;var s=Math.round(this._opts.curEntity.value*this._zoom/100);this._lineCanvasCtx.clearRect(0,0,this._canWidth,this._canHeight),this._drawLine(this._lineCanvasCtx,this._mouse.startX,this._mouse.startY,t.x,t.y,s)}!n&&this._flags.wasPreview&&this._lineCanvas.classList.add("is-dragged")}}},{key:"_mouseUpLine",value:function(e){var t=this._getMouseXY(e),i=null;if(this._flags.wasMove||(i=this._isPreview(t.x,t.y)),!this._flags.wasRightClick)if(i)this._setPosition(i.xRatio,i.yRatio),this._alignImgToCanvas(),this._redraw();else if(this._flags.wasLine){var n=this._zoom/100,s=Math.round(this._x*n),o=Math.round(this._y*n),r=s+this._mouse.startX,a=o+this._mouse.startY,h=s+t.x,c=o+t.y;this._entites.push({id:this._opts.curEntity.id,value:this._opts.curEntity.value,xRatio:r/this._curWidth,yRatio:a/this._curHeight,x2Ratio:h/this._curWidth,y2Ratio:c/this._curHeight}),this._redraw()}this._lineCanvas.classList.remove("is-dragged"),this._lineCanvas.removeEventListener("contextmenu",this._binds.contextMenu),document.removeEventListener("mousemove",this._binds.mouseMoveLine),document.removeEventListener("mouseup",this._binds.mouseUpLine),this._parent.removeChild(this._lineCanvas),this._lineCanvas=null}},{key:"_setZoom",value:function(t,i){i=i||this._getFromPoint();var n=this._zoom,s=e.setRange(t,this._opts.minZoom,this._opts.maxZoom);s!=n&&(this._zoom=s,this.trigger("zoom",this._zoom),this._postZoom(),this._setPosition(i.xRatio,i.yRatio,i.x,i.y),this._alignImgToCanvas(),this._drawEntityPreview(),this._redraw())}},{key:"loadImage",value:function(e){var t=this;return new n(function(i,n){t._setWhiteCanvas(),t._spinner.classList.remove("hide");var s=new Image;s.addEventListener("load",function(){t._spinner.classList.add("hide"),t._img=s,t._imgWidth=s.width,t._imgHeight=s.height,t._zoom=t._opts.zoom,t.trigger("zoom",t._zoom),t._postZoom(),t._setCenter(),t._alignImgToCanvas(),t._drawEntityPreview(),t._redraw(),i()}),s.addEventListener("error",function(){t._spinner.classList.add("hide"),t._img=null,t._imgWidth=0,t._imgHeight=0,n()}),s.src=e||""})}},{key:"zoomPlus",value:function(){this._setZoom(this._zoom+this._zoomStep)}},{key:"zoomMinus",value:function(){this._setZoom(this._zoom-this._zoomStep)}},{key:"setZoom",value:function(e){this._setZoom(e)}},{key:"getEntityId",value:function(){return this._opts.curEntity.id}},{key:"switchEntity",value:function(){var e=this,t=Object.keys(r.ENTITES),i=(this._opts.curEntity.priority,null),n=null;t.forEach(function(t){var s=r.ENTITES[t];!i&&s.priority>e._opts.curEntity.priority&&(i=s),(!n||s.priority<n.priority)&&(n=s)}),i||(i=n),this._opts.curEntity=i,this._drawEntityPreview()}},{key:"getEntity",value:function(){return this._opts.curEntity}},{key:"setEntityValue",value:function(e){return e=e||0,e>=this._opts.curEntity.min&&e<=this._opts.curEntity.max&&(this._opts.curEntity.value=e,this._drawEntityPreview(),!0)}},{key:"setCircleEntity",value:function(){this._opts.curEntity=r.ENTITES.CIRCLE,this._drawEntityPreview()}},{key:"setLineEntity",value:function(){this._opts.curEntity=r.ENTITES.LINE,this._drawEntityPreview()}},{key:"stepBack",value:function(){(this._imgWidth||this._imgHeight)&&(this._entites.pop(),this._redraw())}},{key:"removeAll",value:function(){(this._imgWidth||this._imgHeight)&&(this._entites=[],this._redraw())}},{key:"exportEntites",value:function(){var t=this,i={actions:[],image:{width:this._imgWidth,height:this._imgHeight}};return this._entites.forEach(function(n){switch(n.id){case r.ENTITES.CIRCLE.id:i.actions.push({type:n.id.toLowerCase(),x:e.setRange(Math.round(t._imgWidth*n.xRatio),0,t._imgWidth),y:e.setRange(Math.round(t._imgHeight*n.yRatio),0,t._imgHeight),r:n.value});break;case r.ENTITES.LINE.id:i.actions.push({type:n.id.toLowerCase(),x1:e.setRange(Math.round(t._imgWidth*n.xRatio),0,t._imgWidth),y1:e.setRange(Math.round(t._imgHeight*n.yRatio),0,t._imgHeight),x2:e.setRange(Math.round(t._imgWidth*n.x2Ratio),0,t._imgWidth),y2:e.setRange(Math.round(t._imgHeight*n.y2Ratio),0,t._imgHeight),width:n.value})}}),i}},{key:"syncPort",value:function(e,t){e=e||this._parent.offsetWidth,t=t||this._parent.offsetHeight,this._canWidth=e,this._canHeight=t,this._canvas.width=e,this._canvas.height=t,this._img&&(this._postZoom(),this._setCenter(),this._alignImgToCanvas(),this._drawEntityPreview(),this._redraw())}}]),r}(t);return r.ENTITES={CIRCLE:{min:10,value:50,max:100,id:"CIRCLE",fillStyle:"rgba(0, 0, 255, 0.5)",priority:1},LINE:{min:10,value:20,max:100,id:"LINE",strokeStyle:"rgba(0, 255, 0, 0.5)",priority:2}},r}]),onix.factory("$loader",["$dom",function(e){var t=function(){function t(){_classCallCheck(this,t),this._create()}return _createClass(t,[{key:"_create",value:function(){this._el=e.create({el:"div","class":"loader"}),document.body.insertBefore(this._el,document.body.firstChild)}},{key:"start",value:function(){this._el.classList.add("start")}},{key:"end",value:function(){var e=this;this._el.classList.remove("start"),this._el.classList.add("end"),setTimeout(function(){e._el.classList.remove("end"),e._el.classList.add("hide"),setTimeout(function(){e._el.classList.remove("hide")},350)},150)}},{key:"getSpinner",value:function(t){for(var i=[],n=1;n<6;n++)i.push({el:"div","class":"rect"+n});var s={el:"div","class":"spinner",child:i};return t?s:e.create(s)}}]),t}();return new t}]),onix.service("$notify",["$common","$promise",function(e,t){var i=function(){function i(e){return _classCallCheck(this,i),this._el=e,this._HIDE_TIMEOUT=1500,this._options={ok:"alert-success",error:"alert-danger",info:"alert-info",warn:"alert-warning"},this}return _createClass(i,[{key:"_setValue",value:function(t){e.isElement(t)?onix.element(this._el).empty().append(t):"string"==typeof t&&(this._el.innerHTML=t)}},{key:"reset",value:function(){var e=this;return Object.keys(this._options).forEach(function(t){e._el.classList.remove(e._options[t])}),this}},{key:"ok",value:function(e){return this._el.classList.add(this._options.ok),this._setValue(e),this}},{key:"error",value:function(e){return this._el.classList.add(this._options.error),this._setValue(e),this}},{key:"info",value:function(e){return this._el.classList.add(this._options.info),this._setValue(e),this}},{key:"warn",value:function(e){return this._el.classList.add(this._options.warn),this._setValue(e),this}},{key:"hide",value:function(e){var i=this;return new t(function(t){setTimeout(function(){i.reset(),t()},e||i._HIDE_TIMEOUT)})}}]),i}();this.get=function(e){return new i(e)}}]),onix.service("$previewImages",["$image","$dom","$job","$loader",function(e,t,i,n){this._createPreview=function(e,i){var s={},o=t.create({el:"span","class":["preview-item","preview-loading"],child:[{el:"span","class":"canvas-cover",child:n.getSpinner(!0),style:"height: "+(i||100)+"px",_exported:"canvasCover"},{el:"span","class":"title",innerHTML:e.name.replace(/\..*/g,"")}]},s);return{cont:o,canvasCover:s.canvasCover}},this._createPreviewHolders=function(e,i){if(e&&(4==i||7==i)){var n={};7==i&&e.appendChild(t.create({el:"div",child:{el:"span",_exported:"img_06"}},n));for(var s=[],o=7==i?6:4,r=0;r<o;r++)s.push({el:"span",_exported:"img_0"+r});e.appendChild(t.create({el:"div",child:s},n));for(var a=0;a<i;a++)this._dom["img_0"+a]=n["img_0"+a]}},this._jobTask=function(t,i,n){var s=t.file,o=t.previewID,r=this._createPreview(s,i);o in this._dom?this._dom[o].appendChild(r.cont):this._dom.previewItems.appendChild(r.cont),e.readFromFile(s,i).then(function(e){r.cont.classList.remove("preview-loading"),r.canvasCover.innerHTML="",r.canvasCover.appendChild(e.canvas),n()})},this.show=function(t,n,s){var o=this;t.innerHTML="",t.classList.add("preview-images");var r={maxSize:0,count:0,createHolder:!1};for(var a in s)r[a]=s[a];this._dom={previewItems:t};var h=e.getPictureFiles(n),c=h.length;if(!c)return!1;var u=function(){r.createHolder&&o._createPreviewHolders(t,c);var e=[];return h=h.sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}).forEach(function(t,i){e.push({task:o._jobTask,scope:o,args:[{file:t,previewID:"img_0"+i},r.maxSize]})}),i.multipleJobs(e,r.count),{v:!0}}();return"object"===("undefined"==typeof u?"undefined":_typeof(u))?u.v:void 0}}]),onix.factory("$select",["$common","$event","$dom",function(e,t,i){var n=function(e){function t(e,i){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this));n._opts={addCaption:!1};for(var s in i)n._opts[s]=i[s];return n._CONST={CAPTION_SEL:".dropdown-toggle",OPTIONS_SEL:".dropdown-menu a",CARET_SEL:".caret",OPEN_DROPDOWN_SEL:".dropdown.open",OPEN_CLASS:"open",ACTIVE_CLASS:"active"},n._el=e,n._optinsRef=[],n._captionEl=null,n.captionTextEl=null,n._binds={captionClick:n._captionClick.bind(n),choiceClick:n._choiceClick.bind(n),removeAllOpened:n._removeAllOpened.bind(n),click:n._click.bind(n)},n._bind(),n}return _inherits(t,e),_createClass(t,[{key:"_bind",value:function(){this._bindCaption(),this._bindChoices()}},{key:"_bindCaption",value:function(){var e=this._el.querySelector(this._CONST.CAPTION_SEL);if(e&&(e.addEventListener("click",this._binds.captionClick),this._opts.addCaption)){var t=e.querySelector(this._CONST.CARET_SEL);if(t){var n=i.create({el:"span","class":"add-caption"});e.insertBefore(n,t),this._captionTextEl=n}}this._captionEl=e}},{key:"_removeAllOpened",value:function(){var e=this;onix.element(this._CONST.OPEN_DROPDOWN_SEL).forEach(function(t){t.classList.remove(e._CONST.OPEN_CLASS)})}},{key:"_click",value:function(){this._removeAllOpened(),document.removeEventListener("click",this._binds.click)}},{key:"_captionClick",value:function(e){e.stopPropagation();var t=this._el.classList.contains(this._CONST.OPEN_CLASS);this._binds.removeAllOpened(),t?document.removeEventListener("click",this._binds.click):(document.addEventListener("click",this._binds.click),this._el.classList.add(this._CONST.OPEN_CLASS))}},{key:"_bindChoices",value:function(){var e=this;onix.element(this._CONST.OPTIONS_SEL,this._el).forEach(function(t){t.addEventListener("click",e._binds.choiceClick),e._optinsRef.push({el:t,event:"click",fn:e._binds.choiceClick})})}},{key:"_choiceClick",value:function(e){e.stopPropagation();var t=e.target||e.srcElement;if(t&&!t.parentNode.classList.contains(this._CONST.ACTIVE_CLASS)){var i=t.parentNode.parentNode.querySelector("."+this._CONST.ACTIVE_CLASS);i&&i.classList.remove(this._CONST.ACTIVE_CLASS),t.parentNode.classList.add(this._CONST.ACTIVE_CLASS),this._el.classList.remove(this._CONST.OPEN_CLASS),this._opts.addCaption&&this._captionTextEl&&(this._captionTextEl.innerHTML=t.innerHTML);var n=t.getAttribute("data-value")||"";this.trigger("change",n)}}},{key:"unbindChoices",value:function(){this._optinsRef.length&&(this._optinsRef.forEach(function(e){e.el.removeEventListener(e.event,e.fn)}),this._optinsRef=[])}},{key:"rebindChoices",value:function(){this.unbindChoices(),this._bindChoices()}},{key:"selectOption",value:function(e){e=e||0;var t=this._optinsRef.length;if(t>0&&e>=0&&e<t){var i=this._optinsRef[e].el,n=this._optinsRef[e].el.parentNode;if(!n.classList.contains(this._CONST.ACTIVE_CLASS)){n.classList.add(this._CONST.ACTIVE_CLASS),this._opts.addCaption&&this._captionTextEl&&(this._captionTextEl.innerHTML=i.innerHTML);var s=i.getAttribute("data-value")||"";this.trigger("change",s)}}}},{key:"setAddCaption",value:function(){var e=this;this._opts.addCaption&&this._optinsRef.every(function(t){var i=t.el.parentNode;return!i.classList.contains(e._CONST.ACTIVE_CLASS)||(e._captionTextEl.innerHTML=t.el.innerHTML,!1)})}}]),t}(t);return n}]),onix.factory("$slider",["$dom","$event","$common","$math",function(e,t,i,n){var s=function(t){function s(e,t){_classCallCheck(this,s);var i=_possibleConstructorReturn(this,Object.getPrototypeOf(s).call(this));i._parent=e,i._root=i._create(),i._opts={min:0,max:100,wheelStep:1,timeout:333};for(var n in t)i._opts[n]=t[n];return i._value=null,i._signalObj={id:null,lastValue:null},e.appendChild(i._root),i._binds={keyUp:i._keyUp.bind(i),click:i._click.bind(i),mouseDownCaret:i._mouseDownCaret.bind(i),mouseMove:i._mouseMove.bind(i),mouseWheel:i._mouseWheel.bind(i),mouseUp:i._mouseUp.bind(i),sendSignalInner:i._sendSignalInner.bind(i)},i._mouse={bcr:null},i._els.input.addEventListener("keyup",i._binds.keyUp),i._els.tube.addEventListener("click",i._binds.click),i._els.caret.addEventListener("mousedown",i._binds.mouseDownCaret),i._els.lineHolder.addEventListener("DOMMouseScroll",i._binds.mouseWheel),i._els.lineHolder.addEventListener("mousewheel",i._binds.mouseWheel),i.setValue(i._opts.max),i}return _inherits(s,t),_createClass(s,[{key:"_create",value:function(){return this._els={},e.create({el:"div","class":"slider",child:[{el:"input",type:"text",value:"",_exported:"input"},{el:"span","class":"line-holder",_exported:"lineHolder",child:[{el:"span","class":"lh-tube",_exported:"tube"},{el:"span","class":"lh-caret",_exported:"caret"}]}]},this._els)}},{key:"_setCaret",value:function(e){var t=this._els.lineHolder.offsetWidth;e<0?e=0:e>t&&(e=t),this._els.caret.style.left=e.toFixed(2)+"px"}},{key:"_getMouseXY",value:function(e){return{x:e.clientX-this._mouse.bcr.left,y:e.clientY-this._mouse.bcr.top}}},{key:"_setBCR",value:function(){this._mouse.bcr=this._els.lineHolder.getBoundingClientRect()}},{key:"_keyUp",value:function(){var e=this._els.input,t=parseFloat(e.value),i=!1;isNaN(t)||t<this._opts.min||t>this._opts.max?i=!0:(this.setValue(t),this._sendSignal(!0)),e.classList[i?"add":"remove"]("error")}},{key:"_click",value:function(e){i.cancelEvents(e),this._setBCR();var t=this._els.lineHolder.offsetWidth,n=this._getMouseXY(e).x,s=n/t;s<=.05?n=0:s>=.95&&(n=t),this._setCaret(n),this._setValue(n,!0)}},{key:"_mouseDownCaret",value:function(e){i.cancelEvents(e),this._setBCR(),document.addEventListener("mousemove",this._binds.mouseMove),document.addEventListener("mouseup",this._binds.mouseUp)}},{key:"_mouseMove",value:function(e){var t=(this._els.caret,this._getMouseXY(e).x);this._setCaret(t),this._setValue(t)}},{key:"_mouseUp",value:function(){document.removeEventListener("mousemove",this._binds.mouseMove),document.removeEventListener("mouseup",this._binds.mouseUp)}},{key:"_mouseWheel",value:function(e){var t=e.wheelDelta||-e.detail;t&&(i.cancelEvents(e),t>0?(this.setValue(this._value+this._opts.wheelStep),this._sendSignal()):(this.setValue(this._value-this._opts.wheelStep),this._sendSignal()))}},{key:"_getPosFromValue",value:function(e){e=e||this._value;var t=this._els.lineHolder.offsetWidth,i=this._opts.max-this._opts.min,n=(e-this._opts.min)/i*t;return n}},{key:"_setValue",value:function(e,t){e=e||0;var i=this._els.lineHolder.offsetWidth,n=this._opts.max-this._opts.min;e<0?e=0:e>i&&(e=i);var s=Math.round(e/i*n+this._opts.min);this._value=s,this._els.input.value=s,this._els.input.classList.remove("error"),this._sendSignal(!t)}},{key:"_sendSignal",value:function(e){this._signalObj.id&&(clearTimeout(this._signalObj.id),this._signalObj.id=null),e?this._signalObj.id=setTimeout(this._binds.sendSignalInner,this._opts.timeout):this._sendSignalInner()}},{key:"_sendSignalInner",value:function(){this._value!=this._signalObj.lastValue&&(this._signalObj.lastValue=this._value,this.trigger("change",this._value))}},{key:"setValue",value:function(e){return"number"==typeof e&&(e=n.setRange(e,this._opts.min,this._opts.max),this._value=e,this._els.input.value=e,this._els.input.classList.remove("error"),this._setCaret(this._getPosFromValue(e)),!0)}},{key:"getValue",value:function(){return this._value}},{key:"rewriteOpts",value:function(e){for(var t in e)this._opts[t]=e[t];this._value=n.setRange(this._value,this._opts.min,this._opts.max),this.setValue(this._value)}}]),s}(t);return s}]),onix.factory("$crop",["$dom","$math","$common",function(e,t,i){var n=function(){function n(e){_classCallCheck(this,n),this._CONST={HIDE_CLASS:"hide"},this._options={width:250,height:250,minWidth:10,minHeight:10,maxWidth:1/0,maxHeight:1/0,resizable:!0,aspectRatio:0};for(var t in e)this._options[t]=e[t];this._dim={areaWidth:0,areaHeight:0,width:this._options.width,height:this._options.height},this._changed=!1,this._backupData=null,this._groups={"point-nw":[{type:"nw",x:!0,y:!0},{type:"sw",x:!0},{type:"ne",y:!0}],"point-ne":[{type:"ne",x:!0,y:!0},{type:"se",x:!0},{type:"nw",y:!0}],"point-sw":[{type:"sw",x:!0,y:!0},{type:"nw",x:!0},{type:"se",y:!0}],"point-se":[{type:"se",x:!0,y:!0},{type:"ne",x:!0},{type:"sw",y:!0}]},this._points={nw:{x:0,y:0},ne:{x:0,y:0},sw:{x:0,y:0},se:{x:0,y:0}},this._type=null,this._mouse={startXSave:0,startYSave:0,startX:0,startY:0},this._binds={mouseDown:this._mouseDown.bind(this),mouseMove:this._mouseMove.bind(this),mouseUp:this._mouseUp.bind(this)},this._dom={},this._create(),this._dom.container.addEventListener("mousedown",this._binds.mouseDown),this.hide()}return _createClass(n,[{key:"_create",value:function(){var t=["crop"];this._options.resizable&&t.push("resizable"),e.create({el:"div","class":t,child:[{el:"div","class":"crop-top",child:[{el:"span","class":"point-nw"},{el:"span","class":"point-ne"}],_exported:"cropTop"},{el:"div","class":"crop-bottom",child:[{el:"span","class":"point-sw"},{el:"span","class":"point-se"}],_exported:"cropBottom"},{el:"div","class":"crop-left",_exported:"cropLeft"},{el:"div","class":"crop-right",_exported:"cropRight"},{el:"div","class":"crop-middle",_exported:"cropMiddle"}],_exported:"container"},this._dom)}},{key:"_setCenter",value:function(){var e=this._dim.width,t=this._dim.height,i=Math.round((this._dim.areaWidth-e)/2),n=Math.round((this._dim.areaHeight-t)/2),s=this._points;s.nw.x=i,s.nw.y=n,s.ne.x=s.nw.x+e,s.ne.y=s.nw.y+t,s.sw.x=this._dim.areaWidth-i,s.sw.y=this._dim.areaHeight-n,s.se.x=s.ne.x,s.se.y=s.ne.y}},{key:"_alignPoints",value:function(){var e=this._points,i=this._dim.areaWidth-this._dim.width,n=this._dim.areaHeight-this._dim.height;e.nw.x=t.setRange(e.nw.x,0,i),e.sw.x=t.setRange(e.sw.x,0,i),e.ne.x=t.setRange(e.ne.x,this._dim.width,this._dim.areaWidth),e.se.x=t.setRange(e.se.x,this._dim.width,this._dim.areaWidth),e.nw.y=t.setRange(e.nw.y,0,n),e.ne.y=t.setRange(e.ne.y,0,n),e.sw.y=t.setRange(e.sw.y,this._dim.height,this._dim.areaHeight),e.se.y=t.setRange(e.se.y,this._dim.height,this._dim.areaHeight)}},{key:"_redraw",value:function(){var e=this._points,t=e.nw.x,i=e.nw.y,n=this._getSize();this._dom.cropTop.style.left=t+"px",this._dom.cropTop.style.width=n.width+"px",this._dom.cropTop.style.height=i+"px",this._dom.cropBottom.style.left=t+"px",this._dom.cropBottom.style.width=n.width+"px",this._dom.cropBottom.style.height=this._dim.areaHeight-e.sw.y+"px",this._dom.cropLeft.style.width=t+"px",this._dom.cropLeft.style.height=this._dim.areaHeight+"px",this._dom.cropRight.style.width=this._dim.areaWidth-e.ne.x+"px",this._dom.cropRight.style.height=this._dim.areaHeight+"px",this._dom.cropMiddle.style.width=n.width+"px",this._dom.cropMiddle.style.height=n.height+"px",this._dom.cropMiddle.style.left=t+"px",this._dom.cropMiddle.style.top=i+"px"}},{key:"_mouseDown",value:function(e){i.cancelEvents(e);var t=e.target||e.srcElement;switch(this._type=t.getAttribute("class"),this._type){case"crop-top":case"crop-bottom":case"crop-left":case"crop-right":return}this._mouse.startX=e.clientX,this._mouse.startY=e.clientY,this._mouse.startXSave=e.clientX,this._mouse.startYSave=e.clientY,document.addEventListener("mousemove",this._binds.mouseMove),document.addEventListener("mouseup",this._binds.mouseUp)}},{key:"_mouseMove",value:function(e){var t=this;i.cancelEvents(e);var n=e.clientX-this._mouse.startX,s=e.clientY-this._mouse.startY;if("crop-middle"==this._type)Object.keys(this._points).forEach(function(e){t._points[e].x+=n,t._points[e].y+=s}),this._alignPoints(),this._redraw();else{var o=this._groups[this._type];if(this._options.aspectRatio&&(s=n/this._options.aspectRatio*("point-nw"==this._type||"point-se"==this._type?1:-1)),this._resizeTest(n,s,o)){o.forEach(function(e){var i=t._points[e.type];i.x+=e.x?n:0,i.y+=e.y?s:0});var r=this._getSize();this._dim.width=r.width,this._dim.height=r.height,this._redraw()}}this._mouse.startX=e.clientX,this._mouse.startY=e.clientY}},{key:"_mouseUp",value:function(e){i.cancelEvents(e),document.removeEventListener("mousemove",this._binds.mouseMove),document.removeEventListener("mouseup",this._binds.mouseUp),this._mouse.startXSave==e.clientX&&this._mouse.startYSave==e.clientY||(this._changed=!0)}},{key:"_getSize",value:function(e){return e=e||this._points,{width:Math.abs(e.ne.x-e.nw.x),height:Math.abs(e.sw.y-e.nw.y)}}},{key:"_resizeTest",value:function(e,t,i){var n=this;if(!this._options.aspectRatio)return!1;var s={nw:{x:this._points.nw.x,y:this._points.nw.y},ne:{x:this._points.ne.x,y:this._points.ne.y},sw:{x:this._points.sw.x,y:this._points.sw.y},se:{x:this._points.se.x,y:this._points.se.y}};i.forEach(function(i){var o=s[i.type];o.x=n._points[i.type].x+(i.x?e:0),o.y=n._points[i.type].y+(i.y?t:0)});var o=this._getSize(s);return!(o.width<this._options.minWidth||o.width>this._options.maxWidth||o.height<this._options.minHeight||o.height>this._options.maxHeight||s.nw.x<0||s.se.x>this._dim.areaWidth||s.nw.y<0||s.sw.y>this._dim.areaHeight)}},{key:"setCenter",value:function(){this._setCenter(),this._redraw()}},{key:"fitToArea",value:function(){var e=void 0,t=void 0;if(this._options.aspectRatio){var i=this._options.aspectRatio;e=this._dim.areaWidth,t=Math.round(e/i),t>this._dim.areaHeight&&(t=this._dim.areaHeight,e=Math.round(t*i))}else e=Math.min(this._options.maxWidth,this._dim.areaWidth),t=Math.min(this._options.maxHeight,this._dim.areaHeight);this._dim.width=e,this._dim.height=t,this.setCenter()}},{key:"destroy",value:function(){var e=this.getContainer();e.parentNode&&e.parentNode.removeChild(e),this._dom.container.removeEventListener("mousedown",this._binds.mouseDown)}},{key:"getContainer",value:function(){return this._dom.container}},{key:"setDim",value:function(e){e=e||{},e.areaWidth&&(this._dim.areaWidth=e.areaWidth,this._dom.container.style.width=this._dim.areaWidth+"px"),e.areaHeight&&(this._dim.areaHeight=e.areaHeight,this._dom.container.style.height=this._dim.areaHeight+"px")}},{key:"show",value:function(){this._dom.container.classList.remove(this._CONST.HIDE_CLASS)}},{key:"hide",value:function(){this._dom.container.classList.add(this._CONST.HIDE_CLASS)}},{key:"isVisible",value:function(){return!this._dom.container.classList.contains(this._CONST.HIDE_CLASS)}},{key:"isChanged",value:function(){return this._changed}},{key:"backup",value:function(){this._backupData={changed:this._changed,aabb:this.getAABB()}}},{key:"restore",value:function(){if(this._backupData){this._changed=this._backupData.changed;var e=this._backupData.aabb,t=this._points.nw,i=this._points.ne,n=this._points.sw,s=this._points.se;t.x=e[0],t.y=e[1],s.x=e[2],s.y=e[3],i.x=s.x,i.y=t.y,n.x=t.x,n.y=s.y;var o=this._getSize();this._dim.width=o.width,this._dim.height=o.height,this._redraw(),this._backupData=null}}},{key:"getAABB",value:function(e){var t=this._points.nw,i=this._points.se;return e=e||1,[Math.round(t.x*e),Math.round(t.y*e),Math.round(i.x*e),Math.round(i.y*e)]}}]),n}();return n}]),onix.factory("$jsonViewer",["$dom",function(e){var t=function(){function t(){_classCallCheck(this,t),this._const={HIDE_CLASS:"hide"},this._dom={container:e.create({el:"pre","class":"json-viewer"})}}return _createClass(t,[{key:"_processInput",value:function(e){if(e&&"object"===("undefined"==typeof e?"undefined":_typeof(e)))return e;throw"Input value is not object or array!"}},{key:"_walk",value:function(t,i,n,s){var o=this,r=document.createDocumentFragment(),a=i>=0&&s>=i,h=n>=0&&s>=n;switch("undefined"==typeof t?"undefined":_typeof(t)){case"object":if(t){var c=function(){var c=Array.isArray(t),u=c?t:Object.keys(t);if(0===s&&!function(){var e=o._createItemsCount(u.length),t=o._createLink(c?"[":"{");u.length?(t.addEventListener("click",function(i){a||(t.classList.toggle("collapsed"),e.classList.toggle("hide"),o._dom.container.querySelector("ul").classList.toggle("hide"))}),h&&(t.classList.add("collapsed"),e.classList.remove("hide"))):t.classList.add("empty"),t.appendChild(e),r.appendChild(t)}(),u.length&&!a)!function(){var a=u.length-1,h=e.create({el:"ul","class":"type-"+(c?"array":"object"),attrs:{"data-level":s}});u.forEach(function(r,u){var l=c?r:t[r],d=e.create({el:"li"});if("object"===("undefined"==typeof l?"undefined":_typeof(l))){if(!l||l instanceof Date)d.appendChild(o._createText(c?"":r+": ")),d.appendChild(o._createSimple(l?l:null));else{var _=Array.isArray(l),f=_?l.length:Object.keys(l).length;f?!function(){var e=("string"==typeof r?r+": ":"")+(_?"[":"{"),t=o._createLink(e),a=o._createItemsCount(f);i>=0&&s+1>=i?d.appendChild(o._createText(e)):(t.appendChild(a),d.appendChild(t)),d.appendChild(o._walk(l,i,n,s+1)),d.appendChild(o._createText(_?"]":"}"));var h=d.querySelector("ul"),c=function(){t.classList.toggle("collapsed"),a.classList.toggle("hide"),h.classList.toggle("hide")};t.addEventListener("click",c),n>=0&&s+1>=n&&c()}():d.appendChild(o._createText(r+": "+(_?"[]":"{}")))}}else c||d.appendChild(o._createText(r+": ")),d.appendChild(o._walk(l,i,n,s+1));u<a&&d.appendChild(o._createText(",")),h.appendChild(d)},o),r.appendChild(h)}();else if(u.length&&a){var l=o._createItemsCount(u.length);l.classList.remove("hide"),r.appendChild(l)}if(0===s){if(!u.length){var d=o._createItemsCount(0);d.classList.remove("hide"),r.appendChild(d)}r.appendChild(o._createText(c?"]":"}")),h&&r.querySelector("ul").classList.add("hide")}return"break"}();if("break"===c)break}default:r.appendChild(this._createSimple(t))}return r}},{key:"_createText",value:function(t){return e.create({el:"text",textContent:t||""})}},{key:"_createSimple",value:function(t){var i="undefined"==typeof t?"undefined":_typeof(t),n=t;return"string"===i?n='"'+t+'"':null===t?(i="null",n="null"):void 0===t?n="undefined":t instanceof Date&&(i="date",n=t.toString()),e.create({el:"span","class":"type-"+i,innerHTML:n})}},{key:"_createItemsCount",value:function(t){return e.create({el:"span","class":["items-ph",this._const.HIDE_CLASS],href:"javascript:void(0)",innerHTML:this._getItemsTitle(t)})}},{key:"_createLink",value:function(t){return e.create({el:"a","class":"list-link",href:"javascript:void(0)",innerHTML:t||""})}},{key:"_getItemsTitle",value:function(e){var t=e>1||0===e?"items":"item";return e+" "+t}},{key:"showJSON",value:function(e,t,i){t="number"==typeof t?t:-1,i="number"==typeof i?i:-1;var n=this._processInput(e),s=this._walk(n,t,i,0);this._dom.container.innerHTML="",this._dom.container.appendChild(s)}},{key:"getContainer",value:function(){return this._dom.container}}]),t}();return t}]),onix.factory("$lightbox",["$dom","$common","$resize","$event","$loader",function(e,t,i,n,s){var o=function(n){function o(e){_classCallCheck(this,o);var t=_possibleConstructorReturn(this,Object.getPrototypeOf(o).call(this));t._opts={fadeTime:20,loop:!0,dict:{close:"Close",noDesc:"Empty description",prev:"Prev",next:"Next"},hideClass:"hide",firstRunClass:"first-run"};for(var i in e)t._opts[i]=e[i];return t._data=[],t._ind=0,t._dom={},t._disableMouse=!0,t._binds={keyDown:t._keyDown.bind(t),mouseMove:t._mouseMove.bind(t)},t._firstOpen=!1,t._wasMove=!1,t._opened=!1,
t._fadeId=null,t._firstRunId=null,t._width=0,t._height=0,t}return _inherits(o,n),_createClass(o,[{key:"_showPrevBtn",value:function(){this._dom.prevBtn.classList.remove(this._opts.hideClass),this._dom.nextBtn.classList.add(this._opts.hideClass)}},{key:"_showNextBtn",value:function(){this._dom.prevBtn.classList.add(this._opts.hideClass),this._dom.nextBtn.classList.remove(this._opts.hideClass)}},{key:"_createCover",value:function(){var t=this;this._dom.cover=e.create({el:"div","class":"lightbox-cover",events:[{event:"click",fn:function(e){t.close()}},{event:"DOMMouseScroll",fn:function(e){t._mouseScroll(e)}},{event:"mousewheel",fn:function(e){t._mouseScroll(e)}}]}),document.body.appendChild(this._dom.cover)}},{key:"_create",value:function(){var i=this,n={};this._dom.container=e.create({el:"div","class":["lightbox",this._opts.firstRunClass],events:[{event:"DOMMouseScroll",fn:function(e){i._mouseScroll(e)}},{event:"mousewheel",fn:function(e){i._mouseScroll(e)}}],child:[{el:"div","class":"close-holder",child:{el:"button","class":"exit-btn",attrs:{type:"button",title:this._opts.dict.close},events:{event:"click",fn:function(e){i.close()}}},_exported:"closeHolder"},{el:"div","class":"img-holder",child:[{el:"div","class":"left-part",events:[{event:"click",fn:function(e){i.prev()}},{event:"mouseenter",fn:function(e){i._disableMouse||i._dom.prevBtn.classList.remove(i._opts.hideClass)}},{event:"mouseleave",fn:function(e){i._disableMouse||i._dom.prevBtn.classList.add(i._opts.hideClass)}}],child:{el:"button",attrs:{type:"button"},"class":["prev-btn",this._opts.hideClass],innerHTML:this._opts.dict.prev,_exported:"prevBtn"},_exported:"leftPart"},{el:"div","class":"right-part",events:[{event:"click",fn:function(e){i.next()}},{event:"mouseenter",fn:function(e){i._disableMouse||i._dom.nextBtn.classList.remove(i._opts.hideClass)}},{event:"mouseleave",fn:function(e){i._disableMouse||i._dom.nextBtn.classList.add(i._opts.hideClass)}}],child:{el:"button",attrs:{type:"button"},"class":["next-btn",this._opts.hideClass],innerHTML:this._opts.dict.next,_exported:"nextBtn"},_exported:"rightPart"}],_exported:"imgHolder"},{el:"div","class":"footer",child:[{el:"p","class":"desc",_exported:"desc"},{el:"p","class":"pos",_exported:"pos"}],_exported:"footer"}]},n),t.extend(this._dom,n),document.body.appendChild(this._dom.container)}},{key:"_show",value:function(e,t){var i=this;"string"==typeof e&&(e=parseFloat(e));var n=this._data.length;if(n){if(t=t||0,e=(e||0)+t,e<0){if(!this._opts.loop)return;e=n-1}else if(e>n-1){if(!this._opts.loop)return;e=0}this._ind=e;var o=this._data[e];this._clearFade(),this._clearFirstRun();var r=this._dom.img;r&&(this._dom.imgHolder.removeChild(r),this._dom.img=null),this._firstOpen&&(this._dom.loader=s.getSpinner(),this._dom.imgHolder.appendChild(this._dom.loader));var a=Date.now(),h=new Image,c=this._opts.fadeTime>0;c&&h.setAttribute("data-src",""),h.alt=o.desc,h.onload=function(e){if(i._width=h.width,i._height=h.height,i._firstOpen&&(i._firstOpen=!1,i._dom.loader&&i._dom.imgHolder.removeChild(i._dom.loader),i._firstRunId=setTimeout(function(){i._dom.container.classList.remove(i._opts.firstRunClass)},200)),i._dom.imgHolder.appendChild(h),i._dom.img=h,i._resize(),c){var t=Date.now()-a,n=t<i._opts.fadeTime?i._opts.fadeTime-t:0;i._fadeId=setTimeout(function(){h.removeAttribute("data-src"),i._fadeId=null},n)}},h.src=o.url,this._dom.desc.innerHTML=o.desc,this._dom.pos.innerHTML=e+1+" / "+n}}},{key:"_mouseScroll",value:function(e){e.preventDefault()}},{key:"_keyDown",value:function(e){var t=e.which||e.keyCode;37==t||38==t?(this.prev(!0),38==t&&e.preventDefault()):39==t||40==t?(this.next(!0),40==t&&e.preventDefault()):27==t&&this.close()}},{key:"_mouseMove",value:function(e){if(!this._wasMove)return void(this._wasMove=!0);this._disableMouse=!1;var t=e.target||e.srcElement;t==this._dom.leftPart?this._showPrevBtn():t==this._dom.rightPart&&this._showNextBtn(),document.removeEventListener("mousemove",this._binds.mouseMove)}},{key:"_resize",value:function(){if(this._width&&this._height){var e=this._dom.container.offsetTop,t=document.body.offsetWidth-2*e,i=window.innerHeight-2*e-this._dom.closeHolder.offsetHeight-this._dom.footer.offsetHeight,n=0,s=0,o=this._width/this._height;this._width>this._height?(n=Math.min(this._width,t),s=n/o,s>i&&(s=i,n=s*o)):(s=Math.min(this._height,i),n=s*o,n>t&&(n=t,s=n/o)),this._dom.imgHolder.style.width=n+"px",this._dom.imgHolder.style.height=s+"px"}}},{key:"_clearFade",value:function(){this._fadeId&&(clearTimeout(this._fadeId),this._fadeId=null)}},{key:"_clearFirstRun",value:function(){this._firstRunId&&(clearTimeout(this._firstRunId),this._firstRunId=null)}},{key:"add",value:function(e,t,i){e&&t&&this._data.push({url:e,preview:t,desc:i||this._opts.dict.noDesc})}},{key:"open",value:function(e){return this._opened?void this._show(e):(this._opened=!0,this._firstOpen=!0,this._createCover(),this._create(),this._show(e),document.addEventListener("keydown",this._binds.keyDown),document.addEventListener("mousemove",this._binds.mouseMove),i.on("resize",this._resize,this),void this.trigger("open"))}},{key:"close",value:function(){this._opened&&(this._opened=!1,this._firstOpen=!1,this._dom.cover&&document.body.removeChild(this._dom.cover),this._dom.container&&document.body.removeChild(this._dom.container),this._wasMove||document.removeEventListener("mousemove",this._binds.mouseMove),this._dom={},this._ind=0,this._disableMouse=!0,this._wasMove=!1,document.removeEventListener("keydown",this._binds.keyDown),i.off("resize",this._resize,this),this._clearFade(),this._clearFirstRun(),this.trigger("close"))}},{key:"prev",value:function(e){this._show(this._ind,-1),e&&this._showPrevBtn()}},{key:"next",value:function(e){this._show(this._ind,1),e&&this._showNextBtn()}},{key:"setDict",value:function(e){for(var t in e)this._opts.dict[t]=e[t]}}]),o}(n);return o}]),onix.factory("$popup",["$dom","$event","$resize",function(e,t,i){var n=function(t){function i(e){_classCallCheck(this,i);var t=_possibleConstructorReturn(this,Object.getPrototypeOf(i).call(this));t._const={ROOT_CLASS:"popup",CONTENT_CLASS:"content",CLOSE_BTN_CLASS:"close-btn",MOVE_COVER_CLASS:"popup-move-cover",DRAGGABLE_CLASS:"draggable",RESPONSIVE_CLASS:"responsive-mode",OVERFLOW_Y_CLASS:"overflow-y"},t._opts={maxWidth:null,draggable:!0,className:"",position:i.POSITIONS.CENTER_CENTER,padding:0};for(var n in e)t._opts[n]=e[n];return t._binds={},t._binds.mouseDown=t._mouseDown.bind(t),t._binds.mouseUp=t._mouseUp.bind(t),t._binds.mouseMove=t._mouseMove.bind(t),t._binds.click=t._click.bind(t),t._dom=t._create(),t._appendNode=document.body,t._isDraggedOut=!1,t._saved={width:0,height:0,x:0,y:0},t._screen={width:0,height:0},t._setScreenSize(),t.on("window-resize",t._resize,t),t._appendNode.appendChild(t._dom.root),t.setPosition(),t}return _inherits(i,t),_createClass(i,[{key:"_resize",value:function(){this._setScreenSize(),this.setPosition()}},{key:"_setScreenSize",value:function(){this._screen.width=Math.min(window.innerWidth,document.body.offsetWidth),this._screen.height=window.innerHeight}},{key:"_calculatePosition",value:function(e){var t=this._dom.root.offsetWidth,n=this._dom.root.offsetHeight,s=Math.floor((this._screen.width-t)/2),o=Math.floor((this._screen.height-n)/2);switch(e){case i.POSITIONS.TOP_LEFT:s=0+this._opts.padding,o=0+this._opts.padding;break;case i.POSITIONS.TOP_CENTER:s=Math.floor((this._screen.width-t)/2),o=0+this._opts.padding;break;case i.POSITIONS.TOP_RIGHT:s=this._screen.width-t-this._opts.padding,o=0+this._opts.padding;break;case i.POSITIONS.CENTER_LEFT:s=0+this._opts.padding,o=Math.floor((this._screen.height-n)/2);break;case i.POSITIONS.CENTER_RIGHT:s=this._screen.width-t-this._opts.padding,o=Math.floor((this._screen.height-n)/2);break;case i.POSITIONS.BOTTOM_LEFT:s=0+this._opts.padding,o=this._screen.height-n-this._opts.padding;break;case i.POSITIONS.BOTTOM_CENTER:s=Math.floor((this._screen.width-t)/2),o=this._screen.height-n-this._opts.padding;break;case i.POSITIONS.BOTTOM_RIGHT:s=this._screen.width-t-this._opts.padding,o=this._screen.height-n-this._opts.padding}return{left:s,top:o}}},{key:"_setPosition",value:function(e){var t=0,i=0;if(e||(e=this._opts.position),"number"==typeof e){var n=this._calculatePosition(e);t=n.left,i=n.top}else"object"===("undefined"==typeof e?"undefined":_typeof(e))&&(t=e.left||0,i=e.top||0);this._setRootPosition(t,i)}},{key:"_setPositionAfterDragged",value:function(){var e=this._dom.root.offsetWidth,t=this._dom.root.offsetHeight,i=this._dom.root.offsetLeft,n=this._dom.root.offsetTop;if(e+i>this._screen.width||t+n>this._screen.height){var s=this._calculatePosition(),o=this._calculatePosition(this._opts.position);s.left!=o.left&&s.top!=o.top?this._setRootPosition(o.left,o.top):this._setRootPosition(s.left,s.top),this._isDraggedOut=!1}}},{key:"_setRootPosition",value:function(e,t){var i=e||0,n=t||0,s=this._dom.root.offsetWidth,o=this._dom.root.offsetHeight;if(i<0?i=0:i+s>this._screen.width&&(i=this._screen.width-s),n<0?n=0:n+o>this._screen.height&&(n=this._screen.height-o),!this._saved.height&&o>this._screen.height?(this._dom.root.classList.add(this._const.OVERFLOW_Y_CLASS),this._saved.height=o):this._saved.height&&this._saved.height<this._screen.height&&(this._saved.height=0,this._dom.root.classList.remove(this._const.OVERFLOW_Y_CLASS)),!this._saved.width&&s>this._screen.width){if("getComputedStyle"in window){var r=window.getComputedStyle(this._dom.root);s=parseFloat(r.width)}this._saved.width=this._opts.maxWidth?Math.min(s,this._opts.maxWidth):s,this._dom.root.style.width=(this._opts.maxWidth?Math.min(this._screen.width,this._opts.maxWidth):this._screen.width)+"px",this._dom.root.classList.add(this._const.RESPONSIVE_CLASS)}else if(this._saved.width){this._saved.width<this._screen.width?(this._dom.root.classList.remove(this._const.RESPONSIVE_CLASS),this._dom.root.style.width=this._saved.width+"px",this._saved.width=0):this._dom.root.style.width=this._screen.width+"px";var a=this._calculatePosition();i=a.left>=0?a.left:0,n=a.top>=0?a.top:0}this._dom.root.style.left=i+"px",this._dom.root.style.top=n+"px"}},{key:"_mouseDown",value:function(e){e.target.classList.contains(this._const.ROOT_CLASS)&&(e.preventDefault(),e.stopPropagation(),this._saved.x=parseFloat(this._dom.root.style.left)-e.clientX,this._saved.y=parseFloat(this._dom.root.style.top)-e.clientY,this._dom.moveCover=this._createMoveCover(),this._dom.moveCover.addEventListener("mousemove",this._binds.mouseMove),this._dom.moveCover.addEventListener("mouseup",this._binds.mouseUp),this._appendNode.appendChild(this._dom.moveCover))}},{key:"_mouseMove",value:function(e){this._isDraggedOut=!0;var t=e.clientX+this._saved.x,i=e.clientY+this._saved.y;this._setRootPosition(t,i)}},{key:"_mouseUp",value:function(e){this._dom.moveCover.removeEventListener("mousemove",this._binds.mouseMove),this._dom.moveCover.removeEventListener("mouseup",this._binds.mouseUp),this._appendNode.removeChild(this._dom.moveCover),this._dom.moveCover=null}},{key:"_click",value:function(e){this.close()}},{key:"_create",value:function(){var t=this,i={},n=[],s=[this._const.ROOT_CLASS];return this._opts.className&&s.push(this._opts.className),this._opts.draggable&&(s.push(this._const.DRAGGABLE_CLASS),n={event:"mousedown",fn:this._binds.mouseDown}),e.create({el:"div","class":s,events:n,_exported:"root",child:[{el:"button",attrs:{type:"button"},"class":[this._const.CLOSE_BTN_CLASS,"notranslate"],innerHTML:"x",events:{event:"click",fn:function(e){t._click(e)}}},{el:"div","class":this._const.CONTENT_CLASS,_exported:"content"}]},i),i}},{key:"_createMoveCover",value:function(){return e.create({el:"div","class":this._const.MOVE_COVER_CLASS})}},{key:"getContainer",value:function(){return this._dom.root}},{key:"getContent",value:function(){return this._dom.content}},{key:"close",value:function(){this._dom.root&&(this._dom.root.parentNode.removeChild(this._dom.root),this._isDraggedOut=!1,this._dom.root=null,this.trigger("popup-close"))}},{key:"setPosition",value:function(e){this._isDraggedOut?this._setPositionAfterDragged():this._setPosition(e)}}]),i}(t);n.POSITIONS={TOP_LEFT:0,TOP_CENTER:1,TOP_RIGHT:2,CENTER_LEFT:3,CENTER_CENTER:4,CENTER_RIGHT:5,BOTTOM_LEFT:6,BOTTOM_CENTER:7,BOTTOM_RIGHT:8};var s=function(){function t(){_classCallCheck(this,t),this._popupList=[],this._binds={},this._binds.keyDown=this._keyDown.bind(this),this.captureResize(),i.on("resize",this._resize,this)}return _createClass(t,[{key:"_resize",value:function(){this._popupList.forEach(function(e){e.trigger("window-resize")})}},{key:"_keyDown",value:function(e){var t=e.which||e.keyCode;if(27==t){e.preventDefault(),e.stopPropagation();var i=this._popupList[this._popupList.length-1];i.close()}}},{key:"_register",value:function(e){var t=this;this._popupList.push(e),e.on("popup-close",function(){t._unRegister(e)}),1==this._popupList.length&&document.addEventListener("keydown",this._binds.keyDown)}},{key:"_unRegister",value:function(e){var t=this;this._popupList.every(function(i,n){return i!=e||(t._popupList.splice(n,1),!1)}),this._popupList.length||document.removeEventListener("keydown",this._binds.keyDown)}},{key:"captureResize",value:function(){i.start()}},{key:"create",value:function(e){var t=new n(e);return this._register(t),t}},{key:"alert",value:function(t){var i=new n({className:"alert",draggable:!1}),s=i.getContent();return s.appendChild(e.create({el:"p",innerHTML:t||""})),this._register(i),i}}]),t}(),o=new s;return o.POSITIONS=n.POSITIONS,o}]);