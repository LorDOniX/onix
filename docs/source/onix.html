<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">onix = (function() {
<span id='onix'>	/**
</span>	 * Main framework object.
	 * 
	 * @class onix
	 */
	var onix = function() {
<span id='onix-property-_allObj'>		/**
</span>		 * All objects
		 *
		 * @type {Array}
		 * @member onix
		 * @private
		 */
		this._allObj = [];

<span id='onix-property-_objects'>		/**
</span>		 * All processed objects
		 *
		 * @type {Object}
		 * @member onix
		 * @private
		 */
		this._objects = {};

<span id='onix-property-_CONFIG_NAME'>		/**
</span>		 * Config name
		 *
		 * @member onix
		 * @private
		 */
		this._CONFIG_NAME = &quot;$config&quot;;
	};

<span id='onix-property-TYPES'>	/**
</span>	 * App types
	 *
	 * @property {Object}
	 * @param {Number} SERVICE
	 * @param {Number} FACTORY
	 * @param {Number} CONSTANT
	 * @param {Number} RUN
	 * @member onix
	 */
	onix.TYPES = {
		SERVICE: 1,
		FACTORY: 2,
		CONSTANT: 3,
		RUN: 4
	};

<span id='onix-method-init'>	/**
</span>	 * Init function
	 *
	 * @member onix
	 */
	onix.prototype.init = function() {
		// pred DOM loadem
		this._objects[this._CONFIG_NAME] = {};

		document.addEventListener(&quot;DOMContentLoaded&quot;, this._domLoad.bind(this));
	};


<span id='onix-method-bindDI'>	/**
</span>	 * Dependency injection bind
	 *
	 * @param  {Function|Array} param
	 * @param  {Object} [replace]
	 * @return {Object}
	 * @member onix
	 */
	onix.prototype.bindDI = function(param, replace) {
		var fn;
		var args = [];

		replace = replace || {};

		if (Array.isArray(param)) {
			param.every(function(item) {
				if (typeof item === &quot;function&quot;) {
					fn = item;
					return false;
				}
				else {
					args.push(item in replace ? replace[item] : this._objects[item]);
				}

				return true;
			}, this);
		}
		else {
			fn = param;
		}

<span id='onix-method-'>		/**
</span>		 * Run new binded function - with the new
		 * 
		 * @param  {Function|Object} [scope] 
		 * @param  {Boolean} [callWithNew] 
		 * @return {Function}
		 */
		return function(scope, callWithNew) {
			if (callWithNew) {
				var obj = Object.create(fn.prototype);
				fn.apply(obj, args);
				return obj;
			}
			else {
				return fn.apply(scope || fn, args);
			}
		};
	};

<span id='onix-method-_domLoad'>	/**
</span>	 * Event - Dom LOAD
	 *
	 * @member onix
	 * @private
	 */
	onix.prototype._domLoad = function() {
		var runs = [];

		// process all inner items
		this._allObj.forEach(function(item) {
			// only 2 types
			switch (item.type) {
				case onix.TYPES.SERVICE:
					this._objects[item.name] = this.bindDI(item.param)(null, true);
					break;

				case onix.TYPES.FACTORY:
					this._objects[item.name] = this.bindDI(item.param)();
					break;

				case onix.TYPES.CONSTANT:
					this._objects[item.name] = item.param;
					break;

				case onix.TYPES.RUN:
					runs.push(item.param);
					break;
			}
		}, this);

		// delete them
		this._allObj.length = 0;

		// onix main run
		this.bindDI(this._run)(this);

		// run all runs
		runs.forEach(function(run) {
			this.bindDI(run)();
		}, this);

		//testTempl
	};

<span id='onix-property-_run'>	/**
</span>	 * Main access point in the framework
	 *
	 * @member onix
	 * @private
	 */
	onix.prototype._run = [
		&quot;$i18n&quot;,
		&quot;$template&quot;,
		&quot;$loader&quot;,
		&quot;$route&quot;,
		&quot;$myQuery&quot;,
	function(
		$i18n,
		$template,
		$loader,
		$route,
		$myQuery
	) {
<span id='onix-property-element'>		/**
</span>		 * Quick acces to myQuery and DOM manipulation
		 *
		 * @param  {String|HTMLElement|Array} value
		 * @param {HTMLElement} [parent]
		 * @return {$myQuery}
		 * @member onix
		 * @property {Function}
		 */
		this.element = function(value, parent) {
			return new $myQuery.get(value, parent);
		};

		// inits
		$loader.init();
		$template.init();

<span id='window-property-_'>		/**
</span>		 * Get text function. Translate for the current language and the key.
		 *
		 * @param  {String} key
		 * @param  {Object} [replace] Replace all {} in the string
		 * @return {String}
		 * @member window
		 * @property {Function}
		 */
		window._ = $i18n._.bind($i18n);
	}];

<span id='onix-method-config'>	/**
</span>	 * Read/add config to the onix application.
	 *
	 * @param  {Object|String} obj
	 * @member onix
	 */
	onix.prototype.config = function(obj) {
		if (typeof obj === &quot;string&quot;) {
			// obj is key
			return this._objects[this._CONFIG_NAME][obj];
		}
		else if (typeof obj === &quot;object&quot;) {
			Object.keys(obj).forEach(function(key) {
				this._objects[this._CONFIG_NAME][key] = obj[key];
			}.bind(this));
		}
	};

<span id='onix-method-service'>	/**
</span>	 * Add service to the application.
	 *
	 * @param  {String} name 
	 * @param  {Function|Array} param
	 * @member onix
	 */
	onix.prototype.service = function(name, param) {
		this._allObj.push({
			name: name,
			param: param,
			type: onix.TYPES.SERVICE
		});
	};

<span id='onix-method-factory'>	/**
</span>	 * Add factory to the application.
	 *
	 * @param  {String} name 
	 * @param  {Function|Array} param
	 * @member onix
	 */
	onix.prototype.factory = function(name, param) {
		this._allObj.push({
			name: name,
			param: param,
			type: onix.TYPES.FACTORY
		});
	};

<span id='onix-method-constant'>	/**
</span>	 * Add new constant
	 * 
	 * @param  {String} name
	 * @param  {Object} param
	 * @member onix
	 */
	onix.prototype.constant = function(name, obj) {
		this._allObj.push({
			name: name,
			param: obj,
			type: onix.TYPES.CONSTANT
		});
	};

<span id='onix-method-run'>	/**
</span>	 * Add a new run
	 * 
	 * @param  {Array|Function} param With DI
	 * @member onix
	 */
	onix.prototype.run = function(param) {
		this._allObj.push({
			param: param,
			type: onix.TYPES.RUN
		});
	};

<span id='onix-method-getObject'>	/**
</span>	 * Get object
	 *
	 * @param  {String} name
	 * @return {Function|Object} 
	 * @member onix
	 */
	onix.prototype.getObject = function(name) {
		name = name || &quot;&quot;;

		return this._objects[name];
	};

<span id='onix-method-noop'>	/**
</span>	 * Empty function
	 *
	 * @member onix
	 */
	onix.prototype.noop = function() {

	};

<span id='onix-method-info'>	/**
</span>	 * Framework info.
	 *
	 * @member onix
	 */
	onix.prototype.info = function() {
		console.log(
			&quot;Onix JS Framework\n&quot; +
			&quot;Version: 2.2.0\n&quot; +
			&quot;Date: 18. 4. 2016&quot;
		);
	};

	var onixInst = new onix();

	// init app
	onixInst.init();

	return onixInst;
})();
</pre>
</body>
</html>
