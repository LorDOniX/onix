<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">onix.factory(&quot;$$shadowDomParser&quot;, function() {
<span id='$$shadowDomParser'>	/**
</span>	 * TODO - not completed yet!
	 * 
	 * @class $$shadowDomParser
	 */
	var $$shadowDomParser = function() {
	};

	$$shadowDomParser.prototype._getData = function() {
		return &#39;&lt;div&gt;&#39; +
			&#39;&lt;h1&gt;Test template - &lt;strong&gt;{{ name }}&lt;/strong&gt;&lt;/h1&gt;&#39; +
			&#39;&lt;onixik&gt;&lt;/onixik&gt;&#39; +
			&#39;&lt;button type=&quot;button&quot; class=&quot;btn btn-success&quot;&gt;Click on me&lt;/button&gt;&#39;+
			&#39;&lt;p&gt;&#39;+
				&#39;&lt;span&gt;obsah p&lt;/span&gt;&#39; +
			&#39;&lt;/p&gt;&#39; +
			&#39;&lt;ul&gt;&#39; +
				&#39;&lt;li&gt;hodnota x&lt;/li&gt;&#39; +
				&#39;&lt;li&gt;hodnota x&lt;/li&gt;&#39; +
				&#39;&lt;li&gt;hodnota x&lt;/li&gt;&#39; +
				&#39;&lt;li&gt;hodnota x&lt;/li&gt;&#39; +
				&#39;&lt;li&gt;hodnota x&lt;/li&gt;&#39; +
				&#39;&lt;li&gt;hodnota x&lt;/li&gt;&#39; +
				&#39;&lt;li&gt;hodnota x&lt;/li&gt;&#39; +
				&#39;&lt;li&gt;hodnota x&lt;/li&gt;&#39; +
				&#39;&lt;li&gt;hodnota x&lt;/li&gt;&#39; +
				&#39;&lt;li&gt;hodnota x&lt;/li&gt;&#39; +
				&#39;&lt;li&gt;hodnota x&lt;/li&gt;&#39; +
				&#39;&lt;li&gt;hodnota x&lt;/li&gt;&#39; +
				&#39;&lt;li&gt;hodnota x&lt;/li&gt;&#39; +
				&#39;&lt;li&gt;hodnota x&lt;/li&gt;&#39; +
				&#39;&lt;li&gt;hodnota x&lt;/li&gt;&#39; +
				&#39;&lt;li&gt;hodnota x&lt;/li&gt;&#39; +
				&#39;&lt;li&gt;hodnota x&lt;/li&gt;&#39; +
				&#39;&lt;li&gt;hodnota x&lt;/li&gt;&#39; +
				&#39;&lt;li&gt;hodnota x&lt;/li&gt;&#39; +
				&#39;&lt;li&gt;hodnota x&lt;/li&gt;&#39; +
				&#39;&lt;li&gt;hodnota x&lt;/li&gt;&#39; +
				&#39;&lt;li&gt;hodnota x&lt;/li&gt;&#39; +
				&#39;&lt;li&gt;hodnota x&lt;/li&gt;&#39; +
				&#39;&lt;li&gt;hodnota x&lt;/li&gt;&#39; +
				&#39;&lt;li&gt;hodnota x&lt;/li&gt;&#39; +
				&#39;&lt;li&gt;hodnota x&lt;/li&gt;&#39; +
				&#39;&lt;li&gt;hodnota x&lt;/li&gt;&#39; +
				&#39;&lt;li&gt;hodnota x&lt;/li&gt;&#39; +
				&#39;&lt;li&gt;hodnota x&lt;/li&gt;&#39; +
				&#39;&lt;li&gt;hodnota x&lt;/li&gt;&#39; +
				&#39;&lt;li&gt;hodnota x&lt;/li&gt;&#39; +
				&#39;&lt;li&gt;hodnota x&lt;/li&gt;&#39; +
				&#39;&lt;li&gt;hodnota x&lt;/li&gt;&#39; +
				&#39;&lt;li&gt;hodnota x&lt;/li&gt;&#39; +
				&#39;&lt;li&gt;hodnota x&lt;/li&gt;&#39; +
				&#39;&lt;li&gt;hodnota x&lt;/li&gt;&#39; +
				&#39;&lt;li&gt;hodnota x&lt;/li&gt;&#39; +
				&#39;&lt;li&gt;hodnota x&lt;/li&gt;&#39; +
			&#39;&lt;/ul&gt;&#39; +
		&#39;&lt;/div&gt;&#39;;
	};

	$$shadowDomParser.prototype._getStates = function() {
		// parsovani
		return {
			start: 0,
			element_start: 1,
			element_name: 2,
			element_end: 3,
			element_attr_start: 4,
			element_attr_name: 5,
			element_attr_value_start: 6,
			element_attr_value_end: 7
		};
	};

	$$shadowDomParser.prototype._getRoot = function() {
		return {
			el: &quot;body&quot;,
			child: [],
			parent: null,
			level: 0,
			attrs: {
			}
		};
	};

	$$shadowDomParser.prototype._getScope = function() {
		return {
			name: &quot;Template name&quot;,
			_aaa: &quot;Roman&quot;,

			tmplBtn: function() {
				alert(&quot;tmplBtn +&quot; + this._aaa);
			}
		};
	};

	$$shadowDomParser.prototype._nameTest = function(c) {
		return /[a-zA-Z1-9_]/.test(c);
	};

	$$shadowDomParser.prototype._wsTest = function(c) {
		return /\s/.test(c);
	};

	$$shadowDomParser.prototype._templateBind = function(data, scope) {
		data = data || &quot;&quot;;
		scope = scope || {};

		var allExp = data.match(/[{]\s*[{][^}]*[}]\s*[}]/);

		if (allExp) {
			allExp.forEach(function(expr) {
				var clear = expr.replace(/[{}]/g, &quot;&quot;).trim();
				var value = &quot;&quot;;

				if (clear in scope) {
					value = scope[clear];
				}

				data = data.replace(expr, value);
			});
		}

		return data;
	};

	$$shadowDomParser.prototype.parse = function() {
		var currentTree = this._getRoot();
		var currentEl = null;
		var lastAttribute = &quot;&quot;;
		var level = 0;
		var lastElement = &quot;&quot;;
		var states = this._getStates();
		var state = states.start;
		var data = &quot;&quot;;

		for (var i = 0; i &lt; tmplData.length; i++) {
			var c = tmplData[i];

			switch(state) {
				case states.start:
					if (c == &quot;&lt;&quot;) {
						if (data) {
							currentTree.child.push({
								el: &quot;#text&quot;,
								text: this._templateBind(data, this._getScope()),
								parent: currentTree,
								child: [],
								attrs: {}
							});
						}
						state = states.element_start;
					}
					else {
						data += c;
						continue;
					}
					break;
				case states.element_start:
					if (this._nameTest(c)) {
						state = states.element_name;
						data = c;
					}
					else if (c == &quot;/&quot;) {
						state = states.element_end;
						data = &quot;&quot;;
					}
					else if (this._wsTest(c)) {
						continue;
					}
					break;
				case states.element_name:
					if (this._nameTest(c)) {
						data += c;
					}
					else if (this._wsTest(c)) {
						state = states.element_attr_start;
					}
					else if (c == &quot;&gt;&quot;) {
						level++;
						currentEl = {
							el: data,
							child: [],
							attrs: {},
							parent: currentTree,
							level: level
						};
						lastElement = data;
						currentTree.child.push(currentEl);
						currentTree = currentEl;
						data = &quot;&quot;;
						state = states.start;
					}
					break;
				case states.element_end:
					if (this._nameTest(c)) {
						data += c;
					}
					else if (this._wsTest(c)) {
						continue;
					}
					else if (c == &quot;&gt;&quot;) {
						level--;
						lastElement = data;
						data = &quot;&quot;;
						state = states.start;
						currentTree = currentTree.parent;
					}
					break;
				case states.element_attr_start:
					if (this._wsTest(c)) {
						continue;
					}
					else if (c == &quot;&gt;&quot;) {
						data = &quot;&quot;;
						state = states.start;
					}
					else {
						if (data) {
							level++;
							currentEl = {
								el: data,
								child: [],
								attrs: {},
								parent: currentTree,
								level: level
							};
							lastElement = data;
							currentTree.child.push(currentEl);
							currentTree = currentEl;
						}
						state = states.element_attr_name;
						data = c;
					}
					break;
				case states.element_attr_name:
					if (this._wsTest(c)) {
						state = states.element_attr_start;
					}
					else if (c == &quot;=&quot;) {
						currentEl.attrs[data] = null;
						lastAttribute = data;
						data = &quot;&quot;;
						state = states.element_attr_value_start;
					}
					else {
						data += c;
					}
					break;
				case states.element_attr_value_start:
					if (c == &#39;&quot;&#39; || c == &quot;&#39;&quot;) {
						data = &quot;&quot;;
						state = states.element_attr_value_end;
					}
					else if (this._wsTest(c)) {
						continue;
					}
					break;
				case states.element_attr_value_end:
					if (c == &#39;&quot;&#39; || c == &quot;&#39;&quot;) {
						currentEl.attrs[lastAttribute] = data;
						data = &quot;&quot;;
						state = states.element_attr_start;
					}
					else {
						data += c;
					}
					break;
			}
		}
	};

	return $$shadowDomParser;
});
</pre>
</body>
</html>
