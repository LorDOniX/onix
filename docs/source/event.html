<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">onix.factory(&quot;$event&quot;, function() {
<span id='$event'>	/**
</span>	 * This class is used for extending existing objects and brings signal functionality.
	 * 
 	 * @class $event
 	 */
	var $event = function() {
	};

<span id='$event-method-_eventInit'>	/**
</span>	 * Init event functionality.
	 * 
	 * @member $event
	 * @private
	 */
	$event.prototype._eventInit = function() {
<span id='$event-property-_allEvents'>		/**
</span>		 * All events. { name: name, event: function, scope, [once] }
		 * 
		 * @type {Array}
		 * @member $event
		 * @private
		 */
		this._allEvents = [];
	};

<span id='$event-method-on'>	/**
</span>	 * Add new event to the stack.
	 * 
	 * @param  {String} name 
	 * @param  {Function} fn
	 * @param  {Object|Function} [scope]
	 * @member $event
	 */
	$event.prototype.on = function (name, fn, scope) {
		if (arguments.length &lt; 2) return;

		this._allEvents.push({ 
			name: name,
			fn: fn,
			scope: scope
		});
	};

<span id='$event-method-off'>	/**
</span>	 * Remove event from the stack.
	 * 
	 * @param  {String} name 
	 * @param  {Function} [fn]
	 * @member $event
	 */
	$event.prototype.off = function (name, fn) {
		if (!name) return;

		var len = this._allEvents.length - 1;

		for (var i = len; i &gt;= 0; i--) {
			var item = this._allEvents[i];

			if (item.name != name) continue;

			if (!fn || (fn &amp;&amp; item.fn == fn)) {
				this._allEvents.splice(i, 1);
			}
		}
	};

<span id='$event-method-once'>	/**
</span>	 * Add one time event to the stack.
	 * 
	 * @param  {String} name
	 * @param  {Function} [fn]
	 * @param  {Object|Function} [scope]
	 * @member $event
	 */
	$event.prototype.once = function (name, fn, scope) {
		if (arguments.length &lt; 2) return;

		this._allEvents.push({ 
			name: name,
			fn: fn,
			scope: scope,
			once: true
		});
	};

<span id='$event-method-trigger'>	/**
</span>	 * Trigger event with arguments 0..n.
	 * 
	 * @param  {String} name
	 * @member $event
	 */
	$event.prototype.trigger = function (name) {
		if (!name) return;
		
		var args = Array.prototype.slice.call(arguments, 1);
		var len = this._allEvents.length - 1;

		for (var i = len; i &gt;= 0; i--) {
			var item = this._allEvents[i];

			if (item.name != name) continue;

			// call fn
			item.fn.apply(item.scope || this, args);

			// once event
			if (item.once) {
				this._allEvents.splice(i, 1);
			}
		}
	};

	return $event;
});
</pre>
</body>
</html>
